/* This file was generated by the Hex-Rays decompiler version 9.0.0.240807.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>



//----- (0000000140001000) ----------------------------------------------------
__int64 __fastcall WPP2RelatedMacro(char a1, const char *a2, int a3, __int64 a4)
{
  __int64 result; // rax
  __int64 v5; // [rsp+30h] [rbp-18h]

  result = a4;
  if ( !a1 && off_14000D008 != &off_14000D008 )
  {
    LODWORD(v5) = a3;
    return WPP2Related(WPP_GLOBAL_Control->DeviceExtension, 2u, 1u, 0xAu, &unk_14000B1B0, a2, v5, a4);
  }
  return result;
}
// 14000104C: variable 'v5' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140001058) ----------------------------------------------------
__int64 __fastcall WPP2Related(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        const char *a6,
        __int64 a7,
        __int64 a8)
{
  __int64 v8; // r10
  const char *v9; // r15
  __int64 v10; // rbx
  __int64 v11; // rdi
  unsigned int v13; // r13d
  unsigned __int64 v14; // r9
  unsigned __int16 v15; // r8
  unsigned int v16; // r12d
  int v17; // eax
  __int64 v18; // rax
  __int64 v19; // r8
  __int64 v20; // r8
  const char *v21; // rdx
  __int64 v22; // rax
  __int64 v23; // rbx
  int v25; // [rsp+20h] [rbp-A8h]
  unsigned int v26; // [rsp+60h] [rbp-68h]

  v8 = a5;
  v9 = "NULL";
  v10 = -1LL;
  v11 = a8;
  v13 = a4;
  v14 = a3 >> 16;
  v15 = a3 - 1;
  v26 = a3;
  v16 = a2;
  v17 = *(&WPP_GLOBAL_Control->Timer + 20 * v14 + (v15 >> 5) + 1);
  if ( _bittest(&v17, v15 & 0x1F) )
  {
    if ( *(&WPP_GLOBAL_Control->Timer + 80 * v14 + 1) >= a2 )
    {
      if ( a8 )
      {
        v18 = -1LL;
        do
          ++v18;
        while ( *(a8 + 2 * v18) );
      }
      if ( a6 )
      {
        v19 = -1LL;
        do
          ++v19;
        while ( a6[v19] );
        v20 = v19 + 1;
      }
      else
      {
        v20 = 5LL;
      }
      v21 = "NULL";
      if ( a6 )
        v21 = a6;
      pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v14), 43LL, a5, v13, v21, v20, &a7);
    }
    v8 = a5;
  }
  if ( v11 )
  {
    v22 = -1LL;
    do
      ++v22;
    while ( *(v11 + 2 * v22) );
  }
  if ( a6 )
  {
    do
      ++v10;
    while ( a6[v10] );
    v23 = v10 + 1;
  }
  else
  {
    v23 = 5LL;
  }
  if ( a6 )
    v9 = a6;
  LOWORD(v25) = v13;
  return WppAutoLogTrace(a1, v16, v26, v8, v25, v9, v23, &a7);
}
// 140001227: variable 'v25' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140001240) ----------------------------------------------------
void *__fastcall FreeHidPDeviceDesc(PHIDP_DEVICE_DESC DeviceDescription)
{
  void *result; // rax

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xEu, &unk_14000B1C0);
  HidP_FreeCollectionDescription(DeviceDescription);
  result = memset(DeviceDescription, 0, sizeof(struct _HIDP_DEVICE_DESC));
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xFu, &unk_14000B1C0);
  }
  return result;
}
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (00000001400012E8) ----------------------------------------------------
__int64 __fastcall FillNewSurfaceDialHidDeviceDescriptorWithSizeData(
        __int16 a1,
        __int16 a2,
        __int16 a3,
        __int16 a4,
        PHIDP_DEVICE_DESC DeviceDescription)
{
  NTSTATUS CollectionDescription; // eax
  unsigned int v10; // ebx
  __int64 v12; // [rsp+28h] [rbp-D8h]
  UCHAR ReportDesc[4]; // [rsp+30h] [rbp-D0h] BYREF
  int v14; // [rsp+34h] [rbp-CCh]
  int v15; // [rsp+38h] [rbp-C8h]
  int v16; // [rsp+3Ch] [rbp-C4h]
  int v17; // [rsp+40h] [rbp-C0h]
  int v18; // [rsp+44h] [rbp-BCh]
  int v19; // [rsp+48h] [rbp-B8h]
  int v20; // [rsp+4Ch] [rbp-B4h]
  int v21; // [rsp+50h] [rbp-B0h]
  int v22; // [rsp+54h] [rbp-ACh]
  int v23; // [rsp+58h] [rbp-A8h]
  int v24; // [rsp+5Ch] [rbp-A4h]
  int v25; // [rsp+60h] [rbp-A0h]
  int v26; // [rsp+64h] [rbp-9Ch]
  int v27; // [rsp+68h] [rbp-98h]
  int v28; // [rsp+6Ch] [rbp-94h]
  int v29; // [rsp+70h] [rbp-90h]
  int v30; // [rsp+74h] [rbp-8Ch]
  int v31; // [rsp+78h] [rbp-88h]
  int v32; // [rsp+7Ch] [rbp-84h]
  __int16 v33; // [rsp+80h] [rbp-80h]
  char v34; // [rsp+82h] [rbp-7Eh]
  __int16 v35; // [rsp+83h] [rbp-7Dh]
  int v36; // [rsp+85h] [rbp-7Bh]
  _BYTE v37[6]; // [rsp+89h] [rbp-77h] BYREF
  __int16 v38; // [rsp+8Fh] [rbp-71h]
  int v39; // [rsp+91h] [rbp-6Fh]
  int v40; // [rsp+95h] [rbp-6Bh]
  int v41; // [rsp+99h] [rbp-67h]
  int v42; // [rsp+9Dh] [rbp-63h]
  int v43; // [rsp+A1h] [rbp-5Fh]
  int v44; // [rsp+A5h] [rbp-5Bh]
  int v45; // [rsp+A9h] [rbp-57h]
  int v46; // [rsp+ADh] [rbp-53h]
  int v47; // [rsp+B1h] [rbp-4Fh]
  int v48; // [rsp+B5h] [rbp-4Bh]
  int v49; // [rsp+B9h] [rbp-47h]
  int v50; // [rsp+BDh] [rbp-43h]
  int v51; // [rsp+C1h] [rbp-3Fh]
  int v52; // [rsp+C5h] [rbp-3Bh]
  int v53; // [rsp+C9h] [rbp-37h]
  int v54; // [rsp+CDh] [rbp-33h]
  int v55; // [rsp+D1h] [rbp-2Fh]
  int v56; // [rsp+D5h] [rbp-2Bh]
  int v57; // [rsp+D9h] [rbp-27h]
  int v58; // [rsp+DDh] [rbp-23h]
  int v59; // [rsp+E1h] [rbp-1Fh]
  int v60; // [rsp+E5h] [rbp-1Bh]
  int v61; // [rsp+E9h] [rbp-17h]
  int v62; // [rsp+EDh] [rbp-13h]
  int v63; // [rsp+F1h] [rbp-Fh]
  int v64; // [rsp+F5h] [rbp-Bh]
  int v65; // [rsp+F9h] [rbp-7h]
  int v66; // [rsp+FDh] [rbp-3h]
  int v67; // [rsp+101h] [rbp+1h]
  int v68; // [rsp+105h] [rbp+5h]
  int v69; // [rsp+109h] [rbp+9h]
  int v70; // [rsp+10Dh] [rbp+Dh]
  int v71; // [rsp+111h] [rbp+11h]
  int v72; // [rsp+115h] [rbp+15h]
  int v73; // [rsp+119h] [rbp+19h]
  int v74; // [rsp+11Dh] [rbp+1Dh]
  int v75; // [rsp+121h] [rbp+21h]
  int v76; // [rsp+125h] [rbp+25h]
  int v77; // [rsp+129h] [rbp+29h]
  int v78; // [rsp+12Dh] [rbp+2Dh]
  int v79; // [rsp+131h] [rbp+31h]
  int v80; // [rsp+135h] [rbp+35h]
  int v81; // [rsp+139h] [rbp+39h]
  int v82; // [rsp+13Dh] [rbp+3Dh]
  int v83; // [rsp+141h] [rbp+41h]

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xAu, &unk_14000B1C0);
  v33 = a1;
  v35 = a2;
  *&v37[3] = a3;
  v38 = a4;
  *ReportDesc = 235471109;
  v14 = 25493921;
  v15 = 554241285;
  v16 = 1376929;
  v17 = 24445221;
  v18 = 10551701;
  v19 = 17369349;
  v20 = 218432129;
  v21 = 42021641;
  v22 = 58787477;
  v23 = 17105569;
  v24 = 18233097;
  v25 = 2147427968;
  v26 = 26546293;
  v27 = 3475073;
  v28 = 353243206;
  v29 = 235939328;
  v30 = 45172745;
  v31 = 1438646341;
  v32 = 1175545102;
  v34 = 38;
  v36 = 1115762697;
  qmemcpy(v37, "\t1F", 3);
  v37[5] = 38;
  v39 = 218448513;
  v40 = 974473225;
  v41 = 141900325;
  v42 = 976555861;
  v43 = 58800709;
  v44 = 6619221;
  v45 = 4522037;
  v46 = 17370629;
  v47 = 1376929;
  v48 = 151060262;
  v49 = 155365668;
  v50 = 356684068;
  v51 = 151463169;
  v52 = 155365664;
  v53 = 625119521;
  v54 = -1322776310;
  v55 = 638612802;
  v56 = 621348816;
  v57 = 621363889;
  v58 = 42287761;
  v59 = 924262517;
  v60 = 654311680;
  v61 = 65591;
  v62 = 45163017;
  v63 = 44110089;
  v64 = 60099077;
  v65 = 67699465;
  v66 = 141886729;
  v67 = -14352363;
  v68 = 96469681;
  v69 = -1592784626;
  v70 = -1794505470;
  v71 = 620958977;
  v72 = 268645891;
  v73 = 152044358;
  v74 = 352497923;
  v75 = 906241284;
  v76 = 71700484;
  v77 = -1325135600;
  v78 = 621090050;
  v79 = 268711429;
  v80 = 152044614;
  v81 = 889368837;
  v82 = -1073724160;
  v83 = -1061109568;
  CollectionDescription = HidP_GetCollectionDescription(ReportDesc, 0x115u, NonPagedPool, DeviceDescription);
  v10 = CollectionDescription;
  if ( CollectionDescription >= 0 )
  {
    if ( DeviceDescription->Dbg.ErrorCode )
    {
      _mm_lfence();
      if ( off_14000D008 != &off_14000D008 )
      {
        _mm_lfence();
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 2u, 0xCu, &unk_14000B1C0, DeviceDescription->Dbg.ErrorCode);
      }
      v10 = -1073741823;
      FreeHidPDeviceDesc(DeviceDescription);
    }
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v10;
    _mm_lfence();
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 2u, 0xBu, &unk_14000B1C0, CollectionDescription);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v12) = v10;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xDu, &unk_14000B1C0, v12);
  }
  return v10;
}
// 140001680: variable 'v12' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (00000001400016A8) ----------------------------------------------------
__int64 __fastcall WPP_RECORDER_SF_(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5)
{
  unsigned __int64 v7; // rdi
  unsigned int v9; // esi
  int v10; // eax
  int v12; // [rsp+20h] [rbp-28h]
  __int64 v13; // [rsp+30h] [rbp-18h]
  __int64 v14; // [rsp+38h] [rbp-10h]

  v7 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v7 + (((a3 - 1) >> 5) & 0x7FF) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v7 + 1) >= a2 )
    (pfnWppTraceMessage)(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v7), 43LL, a5, a4, 0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, 0LL, v13, v14);
}
// 14000174D: variable 'v12' is possibly undefined
// 14000174D: variable 'v13' is possibly undefined
// 14000174D: variable 'v14' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000014000176C) ----------------------------------------------------
__int64 WPP_SF_D(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-48h]
  va_list va; // [rsp+98h] [rbp+30h] BYREF

  va_start(va, a5);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8), 43LL, a5, v7, va, 4LL, 0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 4LL, 0LL);
}
// 140001830: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140001840) ----------------------------------------------------
_UNKNOWN **__fastcall sub_140001840(__int64 a1)
{
  _UNKNOWN **result; // rax
  _UNKNOWN *retaddr; // [rsp+38h] [rbp+0h] BYREF

  result = &retaddr;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    result = WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x90u, &unk_14000B2C0);
  if ( *(a1 + 16) )
  {
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    *(a1 + 16) = 0LL;
    *(a1 + 24) = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x91u, &unk_14000B2C0);
  }
  return result;
}
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (000000014000190C) ----------------------------------------------------
_UNKNOWN **__fastcall sub_14000190C(__int64 a1, __int64 a2)
{
  _UNKNOWN **result; // rax
  __int64 v5; // rdx
  __int32 v6; // eax
  __int32 v7; // [rsp+28h] [rbp-20h]
  _UNKNOWN *retaddr; // [rsp+48h] [rbp+0h] BYREF

  result = &retaddr;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    result = WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Bu, &unk_14000B2C0);
  if ( *a1 )
  {
    KeClearEvent((a1 + 112));
    v5 = *(a1 + 8);
    if ( v5 )
    {
      (*(WdfFunctions_01015[0] + 420))(WdfDriverGlobals, v5, 1LL);
      (*(WdfFunctions_01015[0] + 170))(WdfDriverGlobals, *(a1 + 8));
    }
    (*(WdfFunctions_01015[0] + 310))(WdfDriverGlobals, a2);
    KeClearEvent((a1 + 112));
    *a1 = 0;
    sub_140001840(a1 + 16);
    if ( *(a1 + 144) )
    {
      (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
      *(a1 + 144) = 0LL;
    }
    if ( *(a1 + 152) )
    {
      (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
      *(a1 + 152) = 0LL;
    }
    v6 = _InterlockedExchange((a1 + 136), 0);
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v7 = v6;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Du, &unk_14000B2C0, v7);
    }
    if ( *(a1 + 8) )
    {
      (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
      *(a1 + 8) = 0LL;
    }
    result = (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, a2);
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return result;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      result = WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Cu, &unk_14000B2C0);
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Eu, &unk_14000B2C0);
  }
  return result;
}
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140001B58) ----------------------------------------------------
void *__fastcall UnregisterIOCallBacksAndFreeRelatedResources(__int64 a1)
{
  NTSTATUS v2; // esi
  __int64 DeviceContext; // rdi
  void *pIoPlugPlayNotificationEntry; // rcx
  void *result; // rax
  __int64 v6; // rdx
  __int64 v7; // rbx
  int v8; // eax
  __int64 v9; // rdx
  NTSTATUS v10; // [rsp+28h] [rbp-20h]

  v2 = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x5Fu, &unk_14000B2C0);
  DeviceContext = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a1, DeviceContextTypeInfo);
  pIoPlugPlayNotificationEntry = *(DeviceContext + 288);
  if ( pIoPlugPlayNotificationEntry )
  {
    v2 = IoUnregisterPlugPlayNotification(pIoPlugPlayNotificationEntry);
    if ( v2 < 0 && off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x60u, &unk_14000B2C0);
    *(DeviceContext + 288) = 0LL;
    (*(WdfFunctions_01015[0] + 206))(WdfDriverGlobals, a1, 0LL, 1112LL, "REPOSITORYDIR\\sys\\Device.cpp");
  }
  if ( off_14000D008 != &off_14000D008 )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x61u, &unk_14000B2C0);
  sub_14000190C(DeviceContext + 296, a1);
  if ( off_14000D008 != &off_14000D008 )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x62u, &unk_14000B2C0);
  result = sub_14000190C(DeviceContext + 456, a1);
  if ( *(DeviceContext + 160) )
  {
    (*(WdfFunctions_01015[0] + 164))(WdfDriverGlobals);
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, *(DeviceContext + 160));
    *(DeviceContext + 160) = 0LL;
  }
  if ( *(DeviceContext + 152) )
  {
    (*(WdfFunctions_01015[0] + 164))(WdfDriverGlobals);
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, *(DeviceContext + 152));
    *(DeviceContext + 152) = 0LL;
  }
  v6 = *(DeviceContext + 136);
  if ( v6 )
  {
    while ( 1 )
    {
      v8 = (*(WdfFunctions_01015[0] + 14))(WdfDriverGlobals, v6);
      v9 = *(DeviceContext + 136);
      if ( !v8 )
        break;
      v7 = (*(WdfFunctions_01015[0] + 19))(WdfDriverGlobals, v9);
      (*(WdfFunctions_01015[0] + 16))(WdfDriverGlobals, *(DeviceContext + 136), v7);
      (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v7);
      v6 = *(DeviceContext + 136);
    }
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v9);
    *(DeviceContext + 136) = 0LL;
  }
  if ( *(DeviceContext + 144) )
  {
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    *(DeviceContext + 144) = 0LL;
  }
  if ( *(DeviceContext + 168) )
  {
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    *(DeviceContext + 168) = 0LL;
  }
  if ( *(DeviceContext + 8) )
  {
    result = FreeHidPDeviceDesc(DeviceContext);
    *(DeviceContext + 64) = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v10 = v2;
      return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x63u, &unk_14000B2C0, v10);
    }
  }
  return result;
}
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140001EE4) ----------------------------------------------------
__int64 __fastcall CreateDevice(__int64 DeviceInit)
{
  __int64 v1; // rdx
  int v2; // eax
  unsigned int v3; // ebx
  unsigned __int16 v4; // r9
  __int64 v6; // [rsp+28h] [rbp-D8h]
  __int64 DeviceInit_; // [rsp+30h] [rbp-D0h] BYREF
  __int64 Device; // [rsp+38h] [rbp-C8h] BYREF
  _QWORD FileObjectAttributes[8]; // [rsp+40h] [rbp-C0h] BYREF
  _QWORD PnpPowerEventCallbacks[18]; // [rsp+80h] [rbp-80h] BYREF
  int FileObjectConfig; // [rsp+110h] [rbp+10h] BYREF
  __int64 (__fastcall *v12)(__int64, __int64, __int64); // [rsp+118h] [rbp+18h]
  __int64 v13; // [rsp+120h] [rbp+20h]
  __int64 (__fastcall *v14)(__int64); // [rsp+128h] [rbp+28h]
  int v15; // [rsp+130h] [rbp+30h]
  int v16; // [rsp+134h] [rbp+34h]

  v1 = DeviceInit;
  DeviceInit_ = DeviceInit;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xAu, &unk_14000B2C0);
    v1 = DeviceInit_;
  }
  (*(WdfFunctions_01015[0] + 129))(WdfDriverGlobals, v1);
  (*(WdfFunctions_01015[0] + 74))(WdfDriverGlobals, DeviceInit_, EvtIoInCallerContext);
  FileObjectAttributes[3] = 0x100000001LL;
  memset(FileObjectAttributes, 0, 24);
  FileObjectAttributes[6] = DeviceContextTypeInfo;
  *&FileObjectAttributes[4] = 0LL;
  LODWORD(FileObjectAttributes[0]) = 56;
  memset(PnpPowerEventCallbacks, 0, sizeof(PnpPowerEventCallbacks));
  PnpPowerEventCallbacks[5] = EvtDevicePrepareHardware;
  PnpPowerEventCallbacks[6] = EvtDeviceReleaseHardware;
  LODWORD(PnpPowerEventCallbacks[0]) = 144;
  (*(WdfFunctions_01015[0] + 55))(WdfDriverGlobals, DeviceInit_, PnpPowerEventCallbacks);
  v12 = sub_140002950;
  FileObjectConfig = 40;
  v14 = sub_140002FE0;
  v13 = 0LL;
  v16 = 4;
  v15 = 2;
  (*(WdfFunctions_01015[0] + 71))(WdfDriverGlobals, DeviceInit_, &FileObjectConfig, FileObjectAttributes);
  v2 = (*(WdfFunctions_01015[0] + 75))(WdfDriverGlobals, &DeviceInit_, FileObjectAttributes, &Device);
  v3 = v2;
  if ( v2 < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    v4 = 11;
    goto LABEL_10;
  }
  (*(WdfFunctions_01015[0] + 0xCA))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
  v2 = QueueInitialize(Device);
  v3 = v2;
  if ( v2 < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    v4 = 12;
LABEL_10:
    _mm_lfence();
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v4, &unk_14000B2C0, v2);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v6) = v3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xDu, &unk_14000B2C0, v6);
  }
  return v3;
}
// 140002156: variable 'v6' is possibly undefined
// 140003290: using guessed type __int64 __fastcall EvtIoInCallerContext();
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002830) ----------------------------------------------------
_UNKNOWN **__fastcall sub_140002830(__int64 a1)
{
  __int64 v2; // rbx
  _DWORD *v3; // rdi
  _UNKNOWN **result; // rax

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA0u, &unk_14000B2C0);
  v2 = (*(WdfFunctions_01015[0] + 174))(WdfDriverGlobals, a1);
  v3 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, v2, DeviceContextTypeInfo);
  result = sub_14000190C((v3 + 114), v2);
  v3[154] = -1;
  *(v3 + 638) = -1;
  v3[155] = 0x7FFFFFFF;
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA1u, &unk_14000B2C0);
  }
  return result;
}
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002950) ----------------------------------------------------
__int64 __fastcall sub_140002950(__int64 a1, __int64 a2, __int64 a3)
{
  unsigned int v4; // ebx
  __int64 v7; // rax
  __int64 v8; // rbp
  __int64 v9; // rax
  int v10; // eax
  unsigned __int16 v11; // r9
  PDEVICE_OBJECT v12; // rcx
  unsigned __int8 v13; // dl
  __int64 result; // rax
  __int64 v15; // [rsp+28h] [rbp-90h]
  _OWORD v16[2]; // [rsp+40h] [rbp-78h] BYREF
  __int64 v17; // [rsp+60h] [rbp-58h]
  _DWORD v18[2]; // [rsp+68h] [rbp-50h] BYREF
  __int64 v19; // [rsp+70h] [rbp-48h]

  v4 = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x17u, &unk_14000B2C0);
  v7 = (*(WdfFunctions_01015[0] + 140))(WdfDriverGlobals, a3);
  v8 = v7;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPPRelated3(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x18u, &unk_14000B2C0, a3, v7);
  (*(WdfFunctions_01015[0] + 251))(WdfDriverGlobals, a2);
  v19 = 0LL;
  v18[0] = 16;
  v18[1] = 2;
  v9 = (*(WdfFunctions_01015[0] + 42))(WdfDriverGlobals, a1);
  if ( !(*(WdfFunctions_01015[0] + 253))(WdfDriverGlobals, a2, v9, v18) )
  {
    v10 = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, a2);
    v4 = v10;
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_23;
    v11 = 25;
    goto LABEL_21;
  }
  v17 = 0LL;
  memset(v16, 0, sizeof(v16));
  LOWORD(v16[0]) = 40;
  (*(WdfFunctions_01015[0] + 266))(WdfDriverGlobals, a2, v16);
  v10 = DWORD1(v16[0]);
  if ( DWORD1(v16[0]) )
  {
    if ( off_14000D008 != &off_14000D008 )
    {
      v12 = WPP_GLOBAL_Control;
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        v11 = 26;
        v13 = 5;
LABEL_22:
        LODWORD(v15) = v10;
        WPP_SF_D(v12->DeviceExtension, v13, 3u, v11, &unk_14000B2C0, v15);
      }
    }
  }
  else if ( (*(*(&v16[0] + 1) + 16LL) & 0x120089) != 0 )
  {
    v10 = sub_1400046A4(a1, v8);
    v4 = v10;
    if ( v10 < 0 && off_14000D008 != &off_14000D008 )
    {
      _mm_lfence();
      v11 = 28;
LABEL_21:
      v12 = WPP_GLOBAL_Control;
      v13 = 2;
      goto LABEL_22;
    }
  }
  else if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v15) = *(*(&v16[0] + 1) + 16LL);
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Bu, &unk_14000B2C0, v15);
  }
LABEL_23:
  result = (*(WdfFunctions_01015[0] + 263))(WdfDriverGlobals, a2, v4);
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v15) = v4;
      return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Du, &unk_14000B2C0, v15);
    }
  }
  return result;
}
// 140002B8A: variable 'v15' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140002C50) ----------------------------------------------------
__int64 __fastcall EvtDevicePrepareHardware(PVOID Device)
{
  int status; // eax
  unsigned int v3; // ebx
  unsigned __int16 v4; // r9
  __int16 v5; // dx
  __int64 v6; // rax
  __int64 v8; // [rsp+28h] [rbp-20h]
  int v9; // [rsp+28h] [rbp-20h]

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xEu, &unk_14000B2C0);
  (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
  status = DoScreenSave(Device);
  v3 = status;
  if ( status >= 0 )
  {
    _mm_lfence();
    status = RegisterCallBackForGuidDevInterfaceHidArrival(Device);
    v3 = status;
    if ( status >= 0 )
    {
      _mm_lfence();
      status = GenerateNewSurfaceDialHidDescriptor(Device, v5);
      v3 = status;
      if ( status >= 0 )
      {
        _mm_lfence();
        v6 = (*(WdfFunctions_01015[0] + 92))(WdfDriverGlobals, Device);
        (*(WdfFunctions_01015[0] + 154))(WdfDriverGlobals, v6);
        goto LABEL_15;
      }
      if ( off_14000D008 == &off_14000D008 )
        return v3;
      v4 = 17;
    }
    else
    {
      if ( off_14000D008 == &off_14000D008 )
        return v3;
      v4 = 16;
    }
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    v4 = 15;
  }
  _mm_lfence();
  v9 = status;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v4, &unk_14000B2C0, v9);
LABEL_15:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v8) = v3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x12u, &unk_14000B2C0, v8);
  }
  return v3;
}
// 140002D43: variable 'v5' is possibly undefined
// 140002DCF: variable 'v8' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002DF0) ----------------------------------------------------
__int64 __fastcall EvtDeviceReleaseHardware(__int64 Device)
{
  unsigned int v2; // ebx
  __int64 v3; // rdi
  __int64 v4; // rax
  void *v5; // rcx
  NTSTATUS v6; // eax
  void *v7; // rcx
  NTSTATUS v8; // eax
  __int64 v10; // [rsp+28h] [rbp-20h]
  NTSTATUS v11; // [rsp+28h] [rbp-20h]

  v2 = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x13u, &unk_14000B2C0);
  v3 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
  v4 = (*(WdfFunctions_01015[0] + 92))(WdfDriverGlobals, Device);
  (*(WdfFunctions_01015[0] + 164))(WdfDriverGlobals, v4);
  KeSetEvent((v3 + 224), 0, 0);
  v5 = *(v3 + 272);
  if ( v5 )
  {
    v6 = KeWaitForSingleObject(v5, Executive, 0, 0, 0LL);
    v2 = v6;
    if ( v6 < 0 && off_14000D008 != &off_14000D008 )
    {
      _mm_lfence();
      v11 = v6;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x14u, &unk_14000B2C0, v11);
    }
    ObfDereferenceObject(*(v3 + 272));
  }
  v7 = *(v3 + 280);
  if ( v7 )
  {
    v8 = KeWaitForSingleObject(v7, Executive, 0, 0, 0LL);
    v2 = v8;
    if ( v8 < 0 && off_14000D008 != &off_14000D008 )
    {
      _mm_lfence();
      LODWORD(v10) = v8;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x15u, &unk_14000B2C0, v10);
    }
    ObfDereferenceObject(*(v3 + 280));
  }
  UnregisterIOCallBacksAndFreeRelatedResources(Device);
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x16u, &unk_14000B2C0, v10);
  }
  return v2;
}
// 140002F74: variable 'v10' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002FE0) ----------------------------------------------------
__int64 __fastcall sub_140002FE0(__int64 a1)
{
  __int64 v2; // rbx
  __int64 v3; // rsi
  __int64 v4; // rax
  __int64 v5; // rbp
  __int64 result; // rax
  PDEVICE_OBJECT v7; // rcx
  unsigned __int16 v8; // r9
  bool v9; // zf
  void (__fastcall *v10)(PWDF_DRIVER_GLOBALS, __int64); // rax
  __int64 v11; // [rsp+28h] [rbp-40h]

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Eu, &unk_14000B2C0);
  v2 = (*(WdfFunctions_01015[0] + 139))(WdfDriverGlobals, a1);
  v3 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, v2, DeviceContextTypeInfo);
  v4 = (*(WdfFunctions_01015[0] + 140))(WdfDriverGlobals, a1);
  v5 = v4;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPPRelated3(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Fu, &unk_14000B2C0, a1, v4);
  (*(WdfFunctions_01015[0] + 310))(WdfDriverGlobals, v2);
  if ( !*(v3 + 296) )
  {
    result = (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, v2);
    if ( off_14000D008 == &off_14000D008 )
      return result;
    v7 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_23;
    v8 = 32;
    goto LABEL_11;
  }
  if ( !*(v3 + 304) )
  {
    result = (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, v2);
    if ( off_14000D008 == &off_14000D008 )
      return result;
    v7 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_23;
    v8 = 33;
    goto LABEL_11;
  }
  v9 = (*(WdfFunctions_01015[0] + 180))(WdfDriverGlobals) == v5;
  v10 = *(WdfFunctions_01015[0] + 311);
  if ( v9 )
  {
    v10(WdfDriverGlobals, v2);
    if ( off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x23u, &unk_14000B2C0);
    result = sub_14000190C(v3 + 296, v2);
    goto LABEL_23;
  }
  result = (v10)(WdfDriverGlobals, v2);
  if ( off_14000D008 == &off_14000D008 )
    return result;
  v7 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    v8 = 34;
LABEL_11:
    result = WPP_RECORDER_SF_(v7->DeviceExtension, 5u, 3u, v8, &unk_14000B2C0);
  }
LABEL_23:
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v11) = 0;
      return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x24u, &unk_14000B2C0, v11);
    }
  }
  return result;
}
// 14000326D: variable 'v11' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140003290) ----------------------------------------------------
__int64 __fastcall EvtIoInCallerContext(__int64 a1, __int64 a2)
{
  __int64 result; // rax
  int v5; // ebx
  unsigned __int16 v6; // r9
  unsigned __int8 v7; // dl
  unsigned __int16 v8; // r9
  __int64 v9; // [rsp+28h] [rbp-71h]
  _OWORD *v10; // [rsp+30h] [rbp-69h] BYREF
  __int64 v11; // [rsp+38h] [rbp-61h] BYREF
  __int64 v12; // [rsp+40h] [rbp-59h] BYREF
  __int128 v13; // [rsp+48h] [rbp-51h] BYREF
  __int64 v14; // [rsp+58h] [rbp-41h]
  __int64 v15; // [rsp+60h] [rbp-39h]
  __int128 v16; // [rsp+68h] [rbp-31h]
  void *v17; // [rsp+78h] [rbp-21h]
  __int64 v18; // [rsp+80h] [rbp-19h] BYREF
  __int64 v19; // [rsp+88h] [rbp-11h] BYREF
  __int128 v20; // [rsp+90h] [rbp-9h] BYREF
  __int128 v21; // [rsp+A0h] [rbp+7h]
  __int64 v22; // [rsp+B0h] [rbp+17h]

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x25u, &unk_14000B2C0);
  result = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, a2);
  v5 = result;
  if ( result < 0 )
  {
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v6 = 38;
      v7 = 5;
LABEL_8:
      _mm_lfence();
      result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, v7, 3u, v6, &unk_14000B2C0, result);
    }
LABEL_61:
    if ( v5 < 0 )
    {
      _mm_lfence();
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        LODWORD(v9) = v5;
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x35u, &unk_14000B2C0, v9);
      }
      result = (*(WdfFunctions_01015[0] + 265))(WdfDriverGlobals, a2, v5, 0LL);
    }
    goto LABEL_66;
  }
  _mm_lfence();
  if ( (*(WdfFunctions_01015[0] + 280))(WdfDriverGlobals, a2) == 1 )
  {
    _mm_lfence();
    v22 = 0LL;
    v20 = 0LL;
    LOWORD(v20) = 40;
    v21 = 0LL;
    (*(WdfFunctions_01015[0] + 266))(WdfDriverGlobals, a2, &v20);
    if ( DWORD1(v20) == 14 && (BYTE8(v21) & 3) == 3 )
    {
      _mm_lfence();
      result = (*(WdfFunctions_01015[0] + 273))(WdfDriverGlobals, a2, 0LL, &v11, &v18);
      v5 = result;
      if ( result >= 0 )
      {
        _mm_lfence();
        result = (*(WdfFunctions_01015[0] + 274))(WdfDriverGlobals, a2, 0LL, &v12, &v19);
        v5 = result;
        if ( result >= 0 )
        {
          _mm_lfence();
          v14 = 0LL;
          v15 = 0x100000001LL;
          v17 = off_14000D050;
          v13 = 0LL;
          LODWORD(v13) = 56;
          v16 = 0LL;
          result = (*(WdfFunctions_01015[0] + 203))(WdfDriverGlobals, a2, &v13, &v10);
          v5 = result;
          if ( result >= 0 )
          {
            *v10 = 0LL;
            if ( v18
              && v11
              && (_mm_lfence(),
                  result = (*(WdfFunctions_01015[0] + 278))(WdfDriverGlobals, a2, v11, v18, v10),
                  v5 = result,
                  result < 0) )
            {
              if ( off_14000D008 == &off_14000D008 )
                goto LABEL_61;
              v6 = 48;
            }
            else
            {
              if ( !v19
                || !v12
                || (_mm_lfence(),
                    result = (*(WdfFunctions_01015[0] + 279))(WdfDriverGlobals, a2, v12, v19, v10 + 8),
                    v5 = result,
                    result >= 0) )
              {
                _mm_lfence();
                if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
                  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x32u, &unk_14000B2C0);
                result = (*(WdfFunctions_01015[0] + 91))(WdfDriverGlobals, a1, a2);
                v5 = result;
                if ( result < 0 )
                {
                  if ( off_14000D008 != &off_14000D008 )
                  {
                    _mm_lfence();
                    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x33u, &unk_14000B2C0, result);
                  }
                  if ( v5 != -1071644156 )
                    goto LABEL_61;
                  if ( off_14000D008 == &off_14000D008 )
                    goto LABEL_60;
                  v8 = 52;
                  goto LABEL_59;
                }
                goto LABEL_66;
              }
              if ( off_14000D008 == &off_14000D008 )
                goto LABEL_61;
              v6 = 49;
            }
          }
          else
          {
            if ( off_14000D008 == &off_14000D008 )
              goto LABEL_61;
            v6 = 47;
          }
        }
        else
        {
          if ( off_14000D008 == &off_14000D008 )
            goto LABEL_61;
          v6 = 46;
        }
      }
      else
      {
        if ( off_14000D008 == &off_14000D008 )
          goto LABEL_61;
        v6 = 45;
      }
      v7 = 2;
      goto LABEL_8;
    }
    _mm_lfence();
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x2Au, &unk_14000B2C0);
    result = (*(WdfFunctions_01015[0] + 91))(WdfDriverGlobals, a1, a2);
    v5 = result;
    if ( result < 0 )
    {
      if ( off_14000D008 != &off_14000D008 )
      {
        _mm_lfence();
        result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x2Bu, &unk_14000B2C0, result);
      }
      if ( v5 != -1071644156 )
        goto LABEL_61;
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_60;
      v8 = 44;
LABEL_59:
      result = WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, v8, &unk_14000B2C0);
LABEL_60:
      v5 = -1073741536;
      goto LABEL_61;
    }
  }
  else
  {
    _mm_lfence();
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x27u, &unk_14000B2C0);
    result = (*(WdfFunctions_01015[0] + 91))(WdfDriverGlobals, a1, a2);
    v5 = result;
    if ( result < 0 )
    {
      if ( off_14000D008 != &off_14000D008 )
      {
        _mm_lfence();
        result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x28u, &unk_14000B2C0, result);
      }
      if ( v5 != -1071644156 )
        goto LABEL_61;
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_60;
      v8 = 41;
      goto LABEL_59;
    }
  }
LABEL_66:
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v9) = v5;
      return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x36u, &unk_14000B2C0, v9);
    }
  }
  return result;
}
// 140003827: variable 'v9' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D050: using guessed type _UNKNOWN *off_14000D050;

//----- (00000001400038AC) ----------------------------------------------------
__int64 __fastcall HidGetSomethingInfoFromDevice(unsigned __int64 a1, unsigned int *a2)
{
  int Caps; // eax
  int v5; // ebx
  unsigned __int16 v6; // r9
  __int64 v7; // rsi
  int v8; // eax
  __int64 v9; // r8
  __int64 v10; // rdx
  struct _HIDP_PREPARSED_DATA *v11; // rax
  __int64 v13; // [rsp+28h] [rbp-30h]
  int v14; // [rsp+28h] [rbp-30h]
  int v15; // [rsp+28h] [rbp-30h]
  __int64 v16; // [rsp+70h] [rbp+18h] BYREF

  v16 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x83u, &unk_14000B2C0);
  memset(a2, 0, 0x60uLL);
  Caps = SendHIDIoctlToDevice(a1, 0xB01A8u, 12LL, &v16);
  v5 = Caps;
  if ( Caps >= 0 )
  {
    v7 = v16;
    v8 = (*(WdfFunctions_01015[0] + 196))(WdfDriverGlobals, v16, 0LL, a2, 12LL);
    v5 = v8;
    if ( v8 >= 0 )
    {
      _mm_lfence();
      (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v16);
      v9 = *a2;
      v16 = 0LL;
      Caps = SendHIDIoctlToDevice(a1, 0xB0193u, v9, &v16);
      v5 = Caps;
      if ( Caps < 0 )
      {
        if ( off_14000D008 == &off_14000D008 )
          goto LABEL_20;
        v6 = 134;
        goto LABEL_7;
      }
      _mm_lfence();
      v10 = v16;
      *(a2 + 2) = v16;
      v11 = (*(WdfFunctions_01015[0] + 194))(WdfDriverGlobals, v10, 0LL);
      *(a2 + 3) = v11;
      v7 = 0LL;
      Caps = HidP_GetCaps(v11, (a2 + 8));
      v5 = Caps;
      if ( Caps < 0 )
      {
        if ( off_14000D008 == &off_14000D008 )
          goto LABEL_20;
        v6 = 135;
        goto LABEL_7;
      }
      v5 = 0;
    }
    else if ( off_14000D008 != &off_14000D008 )
    {
      _mm_lfence();
      v15 = v8;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x85u, &unk_14000B2C0, v15);
      v7 = v16;
    }
    if ( v7 )
      (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v7);
  }
  else if ( off_14000D008 != &off_14000D008 )
  {
    v6 = 132;
LABEL_7:
    _mm_lfence();
    v14 = Caps;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v6, &unk_14000B2C0, v14);
  }
LABEL_20:
  if ( v5 < 0 && *(a2 + 2) )
  {
    _mm_lfence();
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, *(a2 + 2));
    *(a2 + 2) = 0LL;
    *(a2 + 3) = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v13) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x88u, &unk_14000B2C0, v13);
  }
  return v5;
}
// 140003B28: variable 'v13' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140003B4C) ----------------------------------------------------
__int64 __fastcall SendHIDIoctlToDevice(unsigned __int64 a1, unsigned int a2, __int64 a3, _QWORD *a4)
{
  int v8; // ebx
  int v9; // eax
  unsigned __int16 v10; // r9
  int v11; // eax
  __int64 v13; // [rsp+28h] [rbp-71h]
  __int64 v14; // [rsp+50h] [rbp-49h] BYREF
  __int64 v15; // [rsp+58h] [rbp-41h] BYREF
  __int128 v16; // [rsp+60h] [rbp-39h] BYREF
  __int64 v17; // [rsp+70h] [rbp-29h]
  __int64 v18; // [rsp+78h] [rbp-21h]
  __int128 v19; // [rsp+80h] [rbp-19h]
  __int64 v20; // [rsp+90h] [rbp-9h]
  _DWORD v21[2]; // [rsp+98h] [rbp-1h] BYREF
  __int64 v22; // [rsp+A0h] [rbp+7h]

  v15 = 0LL;
  v14 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x89u, &unk_14000B2C0);
  if ( !a3 )
  {
    if ( off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x8Au, &unk_14000B2C0);
    v8 = -1073741789;
    goto LABEL_24;
  }
  v20 = 0LL;
  v17 = 0LL;
  v18 = 0x100000001LL;
  v16 = 0LL;
  LODWORD(v16) = 56;
  v19 = a1;
  v9 = (*(WdfFunctions_01015[0] + 192))(WdfDriverGlobals, &v16, 512LL, 1145455699LL, a3, &v15, 0LL);
  v8 = v9;
  if ( v9 < 0 )
  {
    v15 = 0LL;
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_26;
    v10 = 139;
    goto LABEL_11;
  }
  v20 = 0LL;
  v17 = 0LL;
  v18 = 0x100000001LL;
  v16 = 0LL;
  LODWORD(v16) = 56;
  v19 = a1;
  v9 = (*(WdfFunctions_01015[0] + 247))(WdfDriverGlobals, &v16, a1, &v14);
  v8 = v9;
  if ( v9 >= 0 )
  {
    _mm_lfence();
    v9 = (*(WdfFunctions_01015[0] + 187))(WdfDriverGlobals, a1, v14, a2, 0LL, 0LL, v15, 0LL);
    v8 = v9;
    if ( v9 >= 0 )
    {
      _mm_lfence();
      v22 = 0LL;
      v21[0] = 16;
      v21[1] = 2;
      if ( (*(WdfFunctions_01015[0] + 253))(WdfDriverGlobals, v14, a1, v21) )
      {
        *a4 = v15;
        v15 = 0LL;
      }
      else
      {
        v11 = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, v14);
        v8 = v11;
        if ( off_14000D008 != &off_14000D008 )
        {
          LODWORD(v13) = v11;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x8Eu, &unk_14000B2C0, v13);
        }
        if ( v8 >= 0 )
          v8 = -1073741823;
      }
      goto LABEL_24;
    }
    v14 = 0LL;
    if ( off_14000D008 != &off_14000D008 )
    {
      v10 = 141;
      goto LABEL_11;
    }
  }
  else
  {
    v14 = 0LL;
    if ( off_14000D008 != &off_14000D008 )
    {
      v10 = 140;
LABEL_11:
      _mm_lfence();
      LODWORD(v13) = v9;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v10, &unk_14000B2C0, v13);
    }
  }
LABEL_24:
  if ( v15 )
  {
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    v15 = 0LL;
  }
LABEL_26:
  if ( v14 )
  {
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    v14 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v13) = v8;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x8Fu, &unk_14000B2C0, v13);
  }
  return v8;
}
// 140003CB4: variable 'v13' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140003EF0) ----------------------------------------------------
__int64 __fastcall HIDDeviceArrivalCallbackRoutine(_QWORD *NotificationStructure, __int64 Context)
{
  int status; // ebx
  int v5; // eax
  unsigned __int16 v6; // r9
  __int128 *v7; // rax
  __int128 v8; // xmm0
  int v9; // edx
  __int64 v11; // [rsp+28h] [rbp-D8h]
  __int64 v12; // [rsp+50h] [rbp-B0h] BYREF
  unsigned int Dst[24]; // [rsp+60h] [rbp-A0h] BYREF
  _OWORD v14[9]; // [rsp+C0h] [rbp-40h] BYREF

  v12 = 0LL;
  status = 0;
  memset(Dst, 0, sizeof(Dst));
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x78u, &unk_14000B2C0);
  (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, Context, DeviceContextTypeInfo);
  if ( *(NotificationStructure + 4) == *&GUID_DEVICE_INTERFACE_ARRIVAL.Data1
    && *(NotificationStructure + 12) == *GUID_DEVICE_INTERFACE_ARRIVAL.Data4 )
  {
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPPRelated4(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        3LL,
        0x7Au,
        &unk_14000B2C0,
        *(NotificationStructure[5] + 8LL));
    v5 = (*(WdfFunctions_01015[0] + 167))(WdfDriverGlobals, Context, 0LL, &v12);
    status = v5;
    if ( v5 < 0 )
    {
      v12 = 0LL;
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_40;
      v6 = 123;
      goto LABEL_12;
    }
    memset(v14, 0, 0x88uLL);
    v7 = NotificationStructure[5];
    *&v14[0] = 0x200000088LL;
    v8 = *v7;
    *&v14[4] = 0x700000000LL;
    v14[3] = v8;
    LODWORD(v14[5]) = 64;
    status = (*(WdfFunctions_01015[0] + 168))(WdfDriverGlobals, v12, v14);
    if ( status == 0xC0000043 )
    {
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        LODWORD(v11) = 0xC0000043;
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x7Cu, &unk_14000B2C0, v11);
      }
      status = 0;
      goto LABEL_40;
    }
    if ( status < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_40;
      v6 = 125;
      goto LABEL_22;
    }
    status = HidGetSomethingInfoFromDevice(v12, Dst);
    if ( status < 0 )
    {
      memset(Dst, 0, sizeof(Dst));
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_40;
      v6 = 126;
LABEL_22:
      LODWORD(v11) = status;
      goto LABEL_13;
    }
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v9 = HIWORD(Dst[8]);
      LOBYTE(v9) = 5;
      WPPRelated5(
        WPP_GLOBAL_Control->DeviceExtension,
        v9,
        3,
        127,
        &unk_14000B2C0,
        SBYTE2(Dst[1]),
        Dst[2],
        SBYTE2(Dst[8]),
        Dst[8]);
    }
    if ( HIWORD(Dst[1]) == 0x45E && Dst[8] == 0xFF090100 )
    {
      _mm_lfence();
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x80u, &unk_14000B2C0);
      v5 = DoSomethingWithValidatedOfInterestWdfHidDevice(Context, NotificationStructure[5], Dst);
      status = v5;
      if ( v5 < 0 && off_14000D008 != &off_14000D008 )
      {
        v6 = 129;
LABEL_12:
        LODWORD(v11) = v5;
LABEL_13:
        _mm_lfence();
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v6, &unk_14000B2C0, v11);
      }
    }
  }
  else if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPPRelated6(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x79u, &unk_14000B2C0, NotificationStructure + 4);
  }
LABEL_40:
  sub_140001840(Dst);
  if ( v12 )
  {
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    v12 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v11) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x82u, &unk_14000B2C0, v11);
  }
  return 0LL;
}
// 140004062: variable 'v11' is possibly undefined
// 140005B40: using guessed type __int64 __fastcall WPPRelated5(_DWORD, _DWORD, _DWORD, _DWORD, __int64, char, char, char, char);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140004314) ----------------------------------------------------
__int64 __fastcall GenerateNewSurfaceDialHidDescriptor(__int64 a1)
{
  __int64 v2; // rdi
  int CoordinateValuesFromRegistry; // eax
  unsigned int v4; // ebx
  unsigned __int16 v5; // r9
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  __int16 v8; // ax
  __int16 v9; // cx
  __int16 v10; // dx
  __int16 v11; // r8
  __int64 v12; // rcx
  __int64 v14; // [rsp+28h] [rbp-28h]
  int v15; // [rsp+30h] [rbp-20h] BYREF
  int v16; // [rsp+34h] [rbp-1Ch] BYREF
  int v17; // [rsp+38h] [rbp-18h] BYREF
  int v18; // [rsp+3Ch] [rbp-14h] BYREF
  union _LARGE_INTEGER Timeout; // [rsp+40h] [rbp-10h] BYREF

  v15 = 0;
  Timeout.QuadPart = 0LL;
  v16 = 0;
  v17 = 0;
  v18 = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x49u, &unk_14000B2C0);
  v2 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a1, DeviceContextTypeInfo);
  if ( *(v2 + 628) )
  {
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_15;
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x4Au, &unk_14000B2C0);
  }
  else
  {
    CoordinateValuesFromRegistry = GetCoordinateValuesFromRegistry(&v15, &v16, &v17, &v18);
    v4 = CoordinateValuesFromRegistry;
    if ( CoordinateValuesFromRegistry >= 0 )
      goto LABEL_36;
    if ( CoordinateValuesFromRegistry != -1073741772 )
    {
      if ( off_14000D008 == &off_14000D008 )
        return v4;
      _mm_lfence();
      v5 = 84;
      goto LABEL_19;
    }
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x4Bu, &unk_14000B2C0);
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPPRelated7(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x4Cu, &unk_14000B2C0, *(v2 + 632));
  }
LABEL_15:
  Timeout.QuadPart = -10000LL * *(v2 + 632);
  CoordinateValuesFromRegistry = KeWaitForSingleObject((v2 + 248), Executive, 0, 0, &Timeout);
  v4 = CoordinateValuesFromRegistry;
  if ( CoordinateValuesFromRegistry )
  {
    if ( CoordinateValuesFromRegistry != 258 )
    {
      if ( off_14000D008 == &off_14000D008 )
        return v4;
      v5 = 80;
      goto LABEL_19;
    }
    if ( off_14000D008 != &off_14000D008 )
    {
      v6 = WPP_GLOBAL_Control;
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        v7 = 79;
LABEL_26:
        WPP_RECORDER_SF_(v6->DeviceExtension, 5u, 3u, v7, &unk_14000B2C0);
      }
    }
  }
  else if ( off_14000D008 != &off_14000D008 )
  {
    v6 = WPP_GLOBAL_Control;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v7 = 78;
      goto LABEL_26;
    }
  }
  CoordinateValuesFromRegistry = GetCoordinateValuesFromRegistry(&v15, &v16, &v17, &v18);
  v4 = CoordinateValuesFromRegistry;
  if ( CoordinateValuesFromRegistry < 0 )
  {
    if ( CoordinateValuesFromRegistry != -1073741772 )
    {
      if ( off_14000D008 == &off_14000D008 )
        return v4;
      _mm_lfence();
      v5 = 83;
      goto LABEL_19;
    }
    if ( off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x52u, &unk_14000B2C0);
    v8 = 0;
    v9 = 0;
    v10 = 0;
    v11 = 0;
    goto LABEL_37;
  }
LABEL_36:
  v8 = v15;
  v9 = v16;
  v10 = v17;
  v11 = v18;
LABEL_37:
  CoordinateValuesFromRegistry = FillNewSurfaceDialHidDeviceDescriptorWithSizeData(v8, v9, v10, v11, v2);
  v4 = CoordinateValuesFromRegistry;
  if ( CoordinateValuesFromRegistry >= 0 )
  {
    _mm_lfence();
    v12 = *v2;
    *(v2 + 64) = *v2;
    CoordinateValuesFromRegistry = HidP_GetCaps(*(v12 + 32), (v2 + 72));
    v4 = CoordinateValuesFromRegistry;
    if ( CoordinateValuesFromRegistry >= 0 )
    {
      v4 = 0;
      goto LABEL_44;
    }
    if ( off_14000D008 == &off_14000D008 )
      return v4;
    _mm_lfence();
    v5 = 87;
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v4;
    _mm_lfence();
    v5 = 86;
  }
LABEL_19:
  LODWORD(v14) = CoordinateValuesFromRegistry;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v5, &unk_14000B2C0, v14);
LABEL_44:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v14) = v4;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x58u, &unk_14000B2C0, v14);
  }
  return v4;
}
// 1400044EC: variable 'v14' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (00000001400046A4) ----------------------------------------------------
__int64 __fastcall sub_1400046A4(__int64 a1, __int64 a2)
{
  __int64 v4; // rsi
  int v5; // eax
  unsigned int v6; // ebx
  unsigned __int16 v7; // r9
  __int64 v8; // rbx
  __int64 v10; // [rsp+28h] [rbp-91h]
  __int64 v11; // [rsp+30h] [rbp-89h] BYREF
  _QWORD Dst[18]; // [rsp+40h] [rbp-79h] BYREF

  v11 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Fu, &unk_14000B2C0);
  v4 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a1, DeviceContextTypeInfo);
  v5 = (*(WdfFunctions_01015[0] + 167))(WdfDriverGlobals, a1, 0LL, &v11);
  v6 = v5;
  if ( v5 >= 0 )
  {
    _mm_lfence();
    v8 = (*(WdfFunctions_01015[0] + 32))(WdfDriverGlobals, a1);
    memset(Dst, 0, 0x88uLL);
    Dst[0] = 0x100000088LL;
    Dst[4] = v8;
    Dst[5] = a2;
    v5 = (*(WdfFunctions_01015[0] + 168))(WdfDriverGlobals, v11, Dst);
    v6 = v5;
    if ( v5 >= 0 )
    {
      _mm_lfence();
      if ( off_14000D008 != &off_14000D008 )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x72u, &unk_14000B2C0);
      v5 = sub_140004E78(a1, v11, v4 + 296);
      v6 = v5;
      if ( v5 >= 0 )
      {
        v11 = 0LL;
        goto LABEL_18;
      }
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_18;
      v7 = 115;
    }
    else
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_18;
      v7 = 113;
    }
  }
  else
  {
    v11 = 0LL;
    if ( off_14000D008 == &off_14000D008 )
      return v6;
    v7 = 112;
  }
  _mm_lfence();
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v7, &unk_14000B2C0, v5);
LABEL_18:
  if ( v11 )
  {
    (*(WdfFunctions_01015[0] + 170))(WdfDriverGlobals);
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v11);
    v11 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v6;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x74u, &unk_14000B2C0, v10);
  }
  return v6;
}
// 140004928: variable 'v10' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140004958) ----------------------------------------------------
__int64 __fastcall DoSomethingWithValidatedOfInterestWdfHidDevice(__int64 a1, __int128 *a2, __int64 a3)
{
  __int64 v5; // r13
  int status; // eax
  NTSTATUS SpecificValueCaps; // ebx
  unsigned __int16 v8; // r9
  LONG PhysicalMax; // r14d
  LONG LogicalMax; // r15d
  int v11; // edx
  LONG v12; // edi
  LONG v13; // esi
  __int128 v14; // xmm0
  PUSHORT ValueCapsLength; // [rsp+28h] [rbp-D8h]
  __int64 v18; // [rsp+58h] [rbp-A8h] BYREF
  _OWORD v19[9]; // [rsp+60h] [rbp-A0h] BYREF
  USHORT v20[8]; // [rsp+F0h] [rbp-10h] BYREF
  struct _HIDP_VALUE_CAPS Dst; // [rsp+100h] [rbp+0h] BYREF

  v18 = 0LL;
  v20[0] = 1;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x92u, &unk_14000B2C0);
  v5 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a1, DeviceContextTypeInfo);
  memset(&Dst, 0, sizeof(Dst));
  status = HidP_GetSpecificValueCaps(HidP_Input, 1u, 0, 0x30u, &Dst, v20, *(a3 + 24));
  SpecificValueCaps = status;
  if ( status >= 0 )
  {
    PhysicalMax = Dst.PhysicalMax;
    LogicalMax = Dst.LogicalMax;
    memset(&Dst, 0, sizeof(Dst));
    SpecificValueCaps = HidP_GetSpecificValueCaps(HidP_Input, 1u, 0, 0x31u, &Dst, v20, *(a3 + 24));
    if ( SpecificValueCaps < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 148;
      LODWORD(ValueCapsLength) = SpecificValueCaps;
      goto LABEL_8;
    }
    v12 = Dst.PhysicalMax;
    v13 = Dst.LogicalMax;
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LOBYTE(v11) = 5;
      WPPRelated5(
        WPP_GLOBAL_Control->DeviceExtension,
        v11,
        3,
        149,
        &unk_14000B2C0,
        PhysicalMax,
        LogicalMax,
        Dst.PhysicalMax,
        Dst.LogicalMax);
    }
    status = WriteDriverRegistryValue(&XPhysicalMaxStruct, PhysicalMax);
    SpecificValueCaps = status;
    if ( status < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 150;
      goto LABEL_7;
    }
    status = WriteDriverRegistryValue(&XLogicalMaxStruct, LogicalMax);
    SpecificValueCaps = status;
    if ( status < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 151;
      goto LABEL_7;
    }
    status = WriteDriverRegistryValue(&YPhysicalMaxStruct, v12);
    SpecificValueCaps = status;
    if ( status < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 152;
      goto LABEL_7;
    }
    status = WriteDriverRegistryValue(&YLogicalMaxStruct, v13);
    SpecificValueCaps = status;
    if ( status < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 153;
      goto LABEL_7;
    }
    KeSetEvent((v5 + 248), 0, 0);
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x9Au, &unk_14000B2C0);
    status = (*(WdfFunctions_01015[0] + 167))(WdfDriverGlobals, a1, 0LL, &v18);
    SpecificValueCaps = status;
    if ( status < 0 )
    {
      v18 = 0LL;
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 155;
      goto LABEL_7;
    }
    memset(v19, 0, 0x88uLL);
    *&v19[0] = 0x200000088LL;
    v14 = *a2;
    *(&v19[1] + 1) = sub_140002830;
    v19[3] = v14;
    *&v19[4] = 0x780000000LL;
    LODWORD(v19[5]) = 64;
    status = (*(WdfFunctions_01015[0] + 168))(WdfDriverGlobals, v18, v19);
    SpecificValueCaps = status;
    if ( status < 0 )
    {
      v18 = 0LL;
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 156;
      goto LABEL_7;
    }
    _mm_lfence();
    if ( off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x9Du, &unk_14000B2C0);
    status = sub_140004E78(a1, v18, v5 + 456);
    SpecificValueCaps = status;
    if ( status >= 0 )
    {
      v18 = 0LL;
      goto LABEL_42;
    }
    if ( off_14000D008 != &off_14000D008 )
    {
      v8 = 158;
      goto LABEL_7;
    }
  }
  else if ( off_14000D008 != &off_14000D008 )
  {
    v8 = 147;
LABEL_7:
    LODWORD(ValueCapsLength) = status;
LABEL_8:
    _mm_lfence();
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v8, &unk_14000B2C0, ValueCapsLength);
  }
LABEL_42:
  if ( SpecificValueCaps < 0 && v18 )
  {
    (*(WdfFunctions_01015[0] + 170))(WdfDriverGlobals);
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v18);
    v18 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(ValueCapsLength) = SpecificValueCaps;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x9Fu, &unk_14000B2C0, ValueCapsLength);
  }
  return SpecificValueCaps;
}
// 140004A78: variable 'ValueCapsLength' is possibly undefined
// 140004B46: variable 'v11' is possibly undefined
// 140005B40: using guessed type __int64 __fastcall WPPRelated5(_DWORD, _DWORD, _DWORD, _DWORD, __int64, char, char, char, char);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140004E78) ----------------------------------------------------
__int64 __fastcall sub_140004E78(__int64 a1, unsigned __int64 a2, __int64 a3)
{
  int SomethingInfoFromDevice; // edi
  __int128 v7; // xmm1
  __int128 v8; // xmm0
  __int128 v9; // xmm1
  __int128 v10; // xmm0
  __int128 v11; // xmm1
  unsigned __int16 v12; // r9
  __int64 v13; // rcx
  __int64 v15; // [rsp+28h] [rbp-A1h]
  int v16; // [rsp+28h] [rbp-A1h]
  __int128 v17; // [rsp+40h] [rbp-89h] BYREF
  __int64 v18; // [rsp+50h] [rbp-79h]
  __int64 v19; // [rsp+58h] [rbp-71h]
  __int128 v20; // [rsp+60h] [rbp-69h]
  __int64 v21; // [rsp+70h] [rbp-59h]
  _OWORD Dst[6]; // [rsp+80h] [rbp-49h] BYREF

  memset(Dst, 0, sizeof(Dst));
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x64u, &unk_14000B2C0);
  SomethingInfoFromDevice = HidGetSomethingInfoFromDevice(a2, Dst);
  if ( SomethingInfoFromDevice < 0 )
  {
    memset(Dst, 0, sizeof(Dst));
    if ( off_14000D008 != &off_14000D008 )
    {
      _mm_lfence();
      v16 = SomethingInfoFromDevice;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x65u, &unk_14000B2C0, v16);
    }
    goto LABEL_23;
  }
  (*(WdfFunctions_01015[0] + 310))(WdfDriverGlobals, a1);
  if ( *a3 )
  {
    (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, a1);
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x66u, &unk_14000B2C0);
LABEL_23:
    if ( SomethingInfoFromDevice >= 0 )
      goto LABEL_30;
    goto LABEL_24;
  }
  _mm_lfence();
  v7 = Dst[1];
  *(a3 + 16) = Dst[0];
  *(a3 + 8) = a2;
  v8 = Dst[2];
  *(a3 + 32) = v7;
  v21 = 0LL;
  v9 = Dst[3];
  *(a3 + 48) = v8;
  v10 = Dst[4];
  *(a3 + 64) = v9;
  v11 = Dst[5];
  *(a3 + 80) = v10;
  v18 = 0LL;
  LODWORD(v19) = 1;
  *(a3 + 96) = v11;
  HIDWORD(v19) = 1;
  v17 = 0LL;
  LODWORD(v17) = 56;
  v20 = a2;
  SomethingInfoFromDevice = (*(WdfFunctions_01015[0] + 247))(WdfDriverGlobals, &v17, a2, a3 + 144);
  if ( SomethingInfoFromDevice < 0 )
  {
    (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, a1);
    *(a3 + 144) = 0LL;
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_23;
    v12 = 103;
    goto LABEL_14;
  }
  if ( *(a3 + 52) )
  {
    _mm_lfence();
    v13 = *(a3 + 52);
    v21 = 0LL;
    v18 = 0LL;
    v20 = a2;
    v17 = 0LL;
    LODWORD(v17) = 56;
    v19 = 0x100000001LL;
    SomethingInfoFromDevice = (*(WdfFunctions_01015[0] + 192))(
                                WdfDriverGlobals,
                                &v17,
                                512LL,
                                1145455699LL,
                                v13,
                                a3 + 152,
                                0LL);
    if ( SomethingInfoFromDevice >= 0 )
    {
      _mm_lfence();
      *a3 = 1;
      KeSetEvent((a3 + 112), 0, 0);
      (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, a1);
      goto LABEL_23;
    }
    (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, a1);
    *(a3 + 152) = 0LL;
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_23;
    v12 = 105;
LABEL_14:
    _mm_lfence();
    LODWORD(v15) = SomethingInfoFromDevice;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v12, &unk_14000B2C0, v15);
    goto LABEL_23;
  }
  (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, a1);
  if ( off_14000D008 != &off_14000D008 )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x68u, &unk_14000B2C0);
  SomethingInfoFromDevice = -1073741789;
LABEL_24:
  *a3 = 0;
  *(a3 + 8) = 0LL;
  if ( *(a3 + 144) )
  {
    _mm_lfence();
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, *(a3 + 144));
    *(a3 + 144) = 0LL;
  }
  if ( *(a3 + 152) )
  {
    _mm_lfence();
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, *(a3 + 152));
    *(a3 + 152) = 0LL;
  }
  if ( *(a3 + 32) )
  {
    _mm_lfence();
    (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, *(a3 + 32));
    *(a3 + 32) = 0LL;
    *(a3 + 40) = 0LL;
  }
LABEL_30:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v15) = SomethingInfoFromDevice;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Au, &unk_14000B2C0, v15);
  }
  return SomethingInfoFromDevice;
}
// 1400050DA: variable 'v15' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140005350) ----------------------------------------------------
__int64 __fastcall WriteDriverRegistryValue(__int64 a1, unsigned int a2)
{
  int v4; // eax
  int v5; // ebx
  __int64 v7; // [rsp+28h] [rbp-50h]
  int v8; // [rsp+28h] [rbp-50h]

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA8u, &unk_14000B2C0);
  v4 = (*(WdfFunctions_01015[0] + 119))(WdfDriverGlobals, WdfDriverGlobals->Driver, 2LL);
  v5 = v4;
  if ( v4 >= 0 )
  {
    v5 = (*(WdfFunctions_01015[0] + 246))(WdfDriverGlobals, 0LL, a1, a2);
    if ( v5 >= 0 )
    {
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        _mm_lfence();
        WPPRelated8(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xABu, &unk_14000B2C0, a1);
      }
    }
    else if ( off_14000D008 != &off_14000D008 )
    {
      _mm_lfence();
      WPPRelated9(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0xAAu, &unk_14000B2C0, a1);
    }
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v5;
    _mm_lfence();
    v8 = v4;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0xA9u, &unk_14000B2C0, v8);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v7) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xACu, &unk_14000B2C0, v7);
  }
  return v5;
}
// 140005535: variable 'v7' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140005564) ----------------------------------------------------
__int64 __fastcall ReadDriverRegistryValue(__int64 a1, _DWORD *a2)
{
  int v4; // eax
  unsigned int v5; // ebx
  int v6; // eax
  int v7; // edx
  int v8; // r9d
  void *v10; // [rsp+20h] [rbp-58h]
  __int64 v11; // [rsp+28h] [rbp-50h]
  __int64 v12; // [rsp+28h] [rbp-50h]
  char v13; // [rsp+30h] [rbp-48h]
  __int64 v14; // [rsp+40h] [rbp-38h] BYREF

  v14 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA2u, &unk_14000B2C0);
  v4 = (*(WdfFunctions_01015[0] + 119))(WdfDriverGlobals, WdfDriverGlobals->Driver, 131097LL, 0LL, &v14);
  v5 = v4;
  if ( v4 >= 0 )
  {
    v6 = (*(WdfFunctions_01015[0] + 240))(WdfDriverGlobals, v14, a1, a2);
    v5 = v6;
    if ( v6 >= 0 )
    {
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        _mm_lfence();
        LOBYTE(v7) = 5;
        WPPRelated8(WPP_GLOBAL_Control->DeviceExtension, v7, 3, 166, &unk_14000B2C0, a1, *a2);
      }
      goto LABEL_18;
    }
    if ( v6 == -1073741772 )
    {
      if ( off_14000D008 == &off_14000D008 || !LOWORD(WPP_GLOBAL_Control->DeviceType) )
        goto LABEL_18;
      v8 = 164;
      v13 = 52;
      LOBYTE(v7) = 5;
    }
    else
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_18;
      v8 = 165;
      v13 = v6;
      LOBYTE(v7) = 2;
    }
    v12 = a1;
    v10 = &unk_14000B2C0;
    _mm_lfence();
    WPPRelated8(WPP_GLOBAL_Control->DeviceExtension, v7, 3, v8, v10, v12, v13);
    goto LABEL_18;
  }
  v14 = 0LL;
  if ( off_14000D008 == &off_14000D008 )
    return v5;
  _mm_lfence();
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0xA3u, &unk_14000B2C0, v4);
LABEL_18:
  if ( v14 )
  {
    (*(WdfFunctions_01015[0] + 231))(WdfDriverGlobals);
    v14 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v11) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA7u, &unk_14000B2C0, v11);
  }
  return v5;
}
// 1400056DC: variable 'v7' is possibly undefined
// 14000577F: variable 'v11' is possibly undefined
// 140005E90: using guessed type __int64 __fastcall WPPRelated8(_DWORD, _DWORD, _DWORD, _DWORD, __int64, __int64, char);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (00000001400057AC) ----------------------------------------------------
__int64 __fastcall GetCoordinateValuesFromRegistry(_DWORD *a1, _DWORD *a2, _DWORD *a3, _DWORD *a4)
{
  int v8; // eax
  unsigned int v9; // ebx
  unsigned __int16 v10; // r9
  __int64 v12; // [rsp+28h] [rbp-30h]
  int v13; // [rsp+28h] [rbp-30h]
  int v14; // [rsp+30h] [rbp-28h] BYREF
  int v15; // [rsp+34h] [rbp-24h] BYREF
  int v16; // [rsp+38h] [rbp-20h] BYREF
  int v17; // [rsp+3Ch] [rbp-1Ch] BYREF

  v14 = 0;
  v15 = 0;
  v16 = 0;
  v17 = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x59u, &unk_14000B2C0);
  v8 = ReadDriverRegistryValue(&XPhysicalMaxStruct, &v14);
  v9 = v8;
  if ( v8 >= 0 )
  {
    v8 = ReadDriverRegistryValue(&XLogicalMaxStruct, &v15);
    v9 = v8;
    if ( v8 >= 0 )
    {
      v8 = ReadDriverRegistryValue(&YPhysicalMaxStruct, &v16);
      v9 = v8;
      if ( v8 >= 0 )
      {
        v8 = ReadDriverRegistryValue(&YLogicalMaxStruct, &v17);
        v9 = v8;
        if ( v8 >= 0 )
        {
          *a1 = v14;
          *a2 = v15;
          *a3 = v16;
          *a4 = v17;
          goto LABEL_18;
        }
        if ( off_14000D008 == &off_14000D008 )
          return v9;
        v10 = 93;
      }
      else
      {
        if ( off_14000D008 == &off_14000D008 )
          return v9;
        v10 = 92;
      }
    }
    else
    {
      if ( off_14000D008 == &off_14000D008 )
        return v9;
      v10 = 91;
    }
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v9;
    v10 = 90;
  }
  _mm_lfence();
  v13 = v8;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v10, &unk_14000B2C0, v13);
LABEL_18:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v12) = v9;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x5Eu, &unk_14000B2C0, v12);
  }
  return v9;
}
// 140005955: variable 'v12' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (000000014000597C) ----------------------------------------------------
__int64 __fastcall RegisterCallBackForGuidDevInterfaceHidArrival(PVOID Context)
{
  __int64 v2; // rsi
  __int64 v3; // rax
  NTSTATUS v4; // eax
  unsigned int v5; // ebx
  PVOID Contexta; // [rsp+28h] [rbp-40h]
  PVOID NotificationEntry; // [rsp+40h] [rbp-28h] BYREF

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x75u, &unk_14000B2C0);
  v2 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, Context, DeviceContextTypeInfo);
  v3 = (*(WdfFunctions_01015[0] + 31))(WdfDriverGlobals, Context);
  v4 = IoRegisterPlugPlayNotification(
         EventCategoryDeviceInterfaceChange,
         1u,
         &GUID_DEVINTERFACE_HID,
         *(v3 + 8),
         HIDDeviceArrivalCallbackRoutine,
         Context,
         &NotificationEntry);
  v5 = v4;
  if ( v4 >= 0 )
  {
    _mm_lfence();
    (*(WdfFunctions_01015[0] + 205))(WdfDriverGlobals, Context, 0LL, 1501LL, "REPOSITORYDIR\\sys\\Device.cpp");
    *(v2 + 288) = NotificationEntry;
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v5;
    _mm_lfence();
    LODWORD(Contexta) = v4;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x76u, &unk_14000B2C0, Contexta);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(Contexta) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x77u, &unk_14000B2C0, Contexta);
  }
  return v5;
}
// 140005A97: variable 'Contexta' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140005B40) ----------------------------------------------------
__int64 WPPRelated5(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-88h]
  __int64 v13; // [rsp+D8h] [rbp+30h] BYREF
  va_list va; // [rsp+D8h] [rbp+30h]
  __int64 v15; // [rsp+E0h] [rbp+38h] BYREF
  va_list va1; // [rsp+E0h] [rbp+38h]
  __int64 v17; // [rsp+E8h] [rbp+40h] BYREF
  va_list va2; // [rsp+E8h] [rbp+40h]
  va_list va3; // [rsp+F0h] [rbp+48h] BYREF

  va_start(va3, a5);
  va_start(va2, a5);
  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  v15 = va_arg(va2, _QWORD);
  va_copy(va3, va2);
  v17 = va_arg(va3, _QWORD);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    (pfnWppTraceMessage)(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8),
      43LL,
      a5,
      v7,
      va,
      4LL,
      va1,
      4LL,
      va2,
      4LL,
      va3,
      4LL,
      0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 4LL, va1);
}
// 140005C5E: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140005C70) ----------------------------------------------------
__int64 WPPRelated7(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-48h]
  va_list va; // [rsp+98h] [rbp+30h] BYREF

  va_start(va, a5);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8), 43LL, a5, v7, va, 8LL, 0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 8LL, 0LL);
}
// 140005D34: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140005D44) ----------------------------------------------------
__int64 __fastcall WPPRelated4(
        __int64 a1,
        unsigned __int8 a2,
        __int64 a3,
        unsigned __int16 a4,
        __int64 a5,
        const wchar_t *a6)
{
  const wchar_t *v6; // r14
  unsigned __int64 v7; // rsi
  __int64 v9; // rdi
  unsigned int v10; // r12d
  int v11; // eax
  __int64 v12; // rbp
  __int64 v13; // rax
  __int64 v14; // rdx
  const wchar_t *v15; // rcx
  bool v16; // zf
  int v18; // [rsp+20h] [rbp-58h]
  __int64 v19; // [rsp+80h] [rbp+8h]
  unsigned int v20; // [rsp+90h] [rbp+18h]

  v20 = a3;
  v19 = a1;
  v6 = L"NULL";
  v7 = a3 >> 16;
  v9 = -1LL;
  v10 = a2;
  v11 = *(&WPP_GLOBAL_Control->Timer + 20 * v7 + (((a3 - 1) >> 5) & 0x7FF) + 1);
  v12 = 10LL;
  if ( _bittest(&v11, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v7 + 1) >= a2 )
  {
    if ( a6 )
    {
      v13 = -1LL;
      do
        ++v13;
      while ( a6[v13] );
      v14 = 2 * v13 + 2;
    }
    else
    {
      v14 = 10LL;
    }
    v15 = L"NULL";
    if ( a6 )
      v15 = a6;
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v7), 43LL, a5, a4, v15, v14, 0LL);
    a3 = v20;
    a1 = v19;
  }
  v16 = a6 == 0LL;
  if ( a6 )
  {
    do
      ++v9;
    while ( a6[v9] );
    v12 = 2 * v9 + 2;
    v16 = a6 == 0LL;
  }
  if ( !v16 )
    v6 = a6;
  LOWORD(v18) = a4;
  return WppAutoLogTrace(a1, v10, a3, a5, v18, v6, v12, 0LL);
}
// 140005E73: variable 'v18' is possibly undefined
// 14000A870: using guessed type wchar_t aNull[5];
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140005E90) ----------------------------------------------------
__int64 __fastcall WPPRelated8(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6)
{
  const wchar_t *v6; // rsi
  __int64 *v7; // rbp
  __int64 v8; // r10
  unsigned int v10; // r15d
  unsigned __int64 v11; // r9
  unsigned int v12; // r14d
  int v13; // eax
  const wchar_t *v14; // rdx
  __int64 *v15; // rcx
  bool v16; // zf
  int v18; // [rsp+20h] [rbp-98h]

  v6 = L"NULL";
  v7 = qword_14000A890;
  v8 = a1;
  v10 = a4;
  v11 = a3 >> 16;
  v12 = a2;
  v13 = *(&WPP_GLOBAL_Control->Timer + 20 * v11 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v13, (a3 - 1) & 0x1F) )
  {
    if ( *(&WPP_GLOBAL_Control->Timer + 80 * v11 + 1) >= a2 )
    {
      if ( a6 && *a6 )
        v14 = *(a6 + 8);
      else
        v14 = L"NULL";
      v15 = qword_14000A890;
      if ( a6 )
        v15 = a6;
      pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v11), 43LL, a5, v10, v15, 2LL, v14);
    }
    v8 = a1;
  }
  v16 = a6 == 0;
  if ( a6 )
  {
    if ( *a6 )
      v6 = *(a6 + 8);
    v16 = a6 == 0;
  }
  if ( !v16 )
    v7 = a6;
  LOWORD(v18) = v10;
  return WppAutoLogTrace(v8, v12, a3, a5, v18, v7, 2LL, v6);
}
// 140005FFF: variable 'v18' is possibly undefined
// 14000A870: using guessed type wchar_t aNull[5];
// 14000A890: using guessed type __int64 qword_14000A890[2];
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140006018) ----------------------------------------------------
__int64 __fastcall WPPRelated9(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6)
{
  const wchar_t *v6; // rsi
  __int64 *v7; // rbp
  __int64 v8; // r10
  unsigned int v10; // r15d
  unsigned __int64 v11; // r9
  unsigned int v12; // r14d
  int v13; // eax
  const wchar_t *v14; // rdx
  __int64 *v15; // rcx
  bool v16; // zf
  int v18; // [rsp+20h] [rbp-A8h]

  v6 = L"NULL";
  v7 = qword_14000A890;
  v8 = a1;
  v10 = a4;
  v11 = a3 >> 16;
  v12 = a2;
  v13 = *(&WPP_GLOBAL_Control->Timer + 20 * v11 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v13, (a3 - 1) & 0x1F) )
  {
    if ( *(&WPP_GLOBAL_Control->Timer + 80 * v11 + 1) >= a2 )
    {
      if ( a6 && *a6 )
        v14 = *(a6 + 8);
      else
        v14 = L"NULL";
      v15 = qword_14000A890;
      if ( a6 )
        v15 = a6;
      pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v11), 43LL, a5, v10, v15, 2LL, v14);
    }
    v8 = a1;
  }
  v16 = a6 == 0;
  if ( a6 )
  {
    if ( *a6 )
      v6 = *(a6 + 8);
    v16 = a6 == 0;
  }
  if ( !v16 )
    v7 = a6;
  LOWORD(v18) = v10;
  return WppAutoLogTrace(v8, v12, a3, a5, v18, v7, 2LL, v6);
}
// 1400061BA: variable 'v18' is possibly undefined
// 14000A870: using guessed type wchar_t aNull[5];
// 14000A890: using guessed type __int64 qword_14000A890[2];
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000001400061D4) ----------------------------------------------------
__int64 __fastcall WPPRelated6(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6)
{
  unsigned __int64 v8; // rdi
  unsigned int v9; // esi
  int v11; // eax
  int v13; // [rsp+20h] [rbp-38h]

  v8 = a3 >> 16;
  v9 = a2;
  v11 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + (((a3 - 1) >> 5) & 0x7FF) + 1);
  if ( _bittest(&v11, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8), 43LL, a5, a4, a6, 16LL, 0LL);
  LOWORD(v13) = a4;
  return WppAutoLogTrace(a1, v9, a3, a5, v13, a6, 16LL, 0LL);
}
// 1400062A5: variable 'v13' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000001400062C4) ----------------------------------------------------
__int64 __fastcall WPPRelated3(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6,
        __int64 a7)
{
  unsigned int v9; // edi
  unsigned __int64 v10; // r9
  unsigned __int16 v11; // r8
  unsigned __int64 v12; // r9
  unsigned int v13; // ebx
  int v14; // eax
  int v16; // [rsp+20h] [rbp-88h]
  __int64 v17; // [rsp+50h] [rbp-58h] BYREF
  __int64 v18; // [rsp+58h] [rbp-50h] BYREF

  v18 = a6;
  v17 = a7;
  v9 = a4;
  v10 = a3;
  v11 = a3 - 1;
  v12 = v10 >> 16;
  v13 = a2;
  v14 = *(&WPP_GLOBAL_Control->Timer + 20 * v12 + (v11 >> 5) + 1);
  if ( _bittest(&v14, v11 & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v12 + 1) >= a2 )
    (pfnWppTraceMessage)(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v12), 43LL, a5, v9, &v18, 8LL, &v17, 8LL, 0LL);
  LOWORD(v16) = v9;
  return WppAutoLogTrace(a1, v13, a3, a5, v16, &v18, 8LL, &v17);
}
// 1400063C7: variable 'v16' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000001400063F0) ----------------------------------------------------
__int64 __fastcall WppClassicProviderCallback(__int64 a1, unsigned __int8 a2, __int64 *a3, __int64 a4)
{
  __int64 result; // rax
  __int64 v5; // rdx

  if ( a2 <= 1u )
  {
    result = 0LL;
    if ( a2 )
    {
      *(a4 + 44) = *(a3 + 1);
      *(a4 + 41) = *(a3 + 2);
      v5 = *a3;
      *(a4 + 24) = *a3;
      LOBYTE(a4) = *(a3 + 2);
      return imp_WppRecorderReplay(WPP_GLOBAL_Control, v5, *(a3 + 1), a4);
    }
    else
    {
      *(a4 + 41) = 0;
      *(a4 + 44) = 0;
      *(a4 + 24) = 0LL;
    }
  }
  return result;
}
// 14000A446: using guessed type __int64 __fastcall imp_WppRecorderReplay(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140006434) ----------------------------------------------------
__int64 __fastcall QueueInitialize(__int64 a1)
{
  int v2; // eax
  unsigned int v3; // ebx
  __int64 v5; // [rsp+28h] [rbp-90h]
  _BYTE v6[16]; // [rsp+30h] [rbp-88h] BYREF
  _QWORD Dst[12]; // [rsp+40h] [rbp-78h] BYREF

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xAu, &WPP3TraceGuidRelated);
  (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a1, DeviceContextTypeInfo);
  memset(Dst, 0, sizeof(Dst));
  LODWORD(Dst[10]) = -1;
  Dst[3] = EvtIoRead;
  Dst[0] = 0x200000060LL;
  Dst[5] = EvtIoDeviceControl;
  LODWORD(Dst[1]) = 2;
  BYTE5(Dst[1]) = 1;
  v2 = (*(WdfFunctions_01015[0] + 152))(WdfDriverGlobals, a1, Dst, 0LL, v6);
  v3 = v2;
  if ( v2 < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    _mm_lfence();
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0xBu, &WPP3TraceGuidRelated, v2);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v5) = v3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xCu, &WPP3TraceGuidRelated, v5);
  }
  return v3;
}
// 1400065AC: variable 'v5' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (00000001400065E0) ----------------------------------------------------
int __fastcall CompletionRoutine1_sub_1400065E0(__int64 a1, __int64 a2, _QWORD *a3)
{
  __int64 v6; // r13
  __int64 v7; // rdi
  struct _HIDP_PREPARSED_DATA *v8; // r12
  signed __int32 v9; // eax
  int result; // eax
  int v11; // edx
  int v12; // ebx
  unsigned __int16 v13; // r9
  unsigned __int8 v14; // dl
  __int64 v15; // r15
  __int64 v16; // r14
  CHAR *v17; // rsi
  unsigned __int16 v18; // r9
  ULONG v19; // r8d
  ULONG i; // edx
  ULONG v21; // edx
  ULONG j; // ecx
  signed __int32 v23; // edx
  int v24; // eax
  PHIDP_PREPARSED_DATA PreparsedData; // [rsp+28h] [rbp-61h]
  signed __int32 PreparsedDataa; // [rsp+28h] [rbp-61h]
  PCHAR Report; // [rsp+30h] [rbp-59h]
  PCHAR Reporta; // [rsp+30h] [rbp-59h]
  __int64 ReportLength; // [rsp+38h] [rbp-51h]
  __int64 v30; // [rsp+40h] [rbp-49h] BYREF
  __int64 v31; // [rsp+48h] [rbp-41h] BYREF
  __int128 v32; // [rsp+50h] [rbp-39h] BYREF
  __int64 v33; // [rsp+60h] [rbp-29h]
  __int64 v34; // [rsp+68h] [rbp-21h]
  __int128 v35; // [rsp+70h] [rbp-19h]
  __int64 v36; // [rsp+80h] [rbp-9h]
  ULONG UsageLength; // [rsp+88h] [rbp-1h] BYREF
  ULONG UsageValue; // [rsp+8Ch] [rbp+3h] BYREF
  USHORT UsageList[4]; // [rsp+90h] [rbp+7h] BYREF
  __int16 v40; // [rsp+98h] [rbp+Fh]

  v31 = 0LL;
  *UsageList = 0LL;
  v40 = 0;
  v30 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x47u, &WPP3TraceGuidRelated);
  v6 = (*(WdfFunctions_01015[0] + 174))(WdfDriverGlobals, a2);
  v7 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, v6, DeviceContextTypeInfo);
  v8 = *(v7 + 336);
  v9 = _InterlockedDecrement((v7 + 432));
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    PreparsedDataa = v9;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x48u, &WPP3TraceGuidRelated, PreparsedDataa);
  }
  result = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, a1);
  v12 = result;
  if ( result < 0 )
  {
    if ( off_14000D008 == &off_14000D008 || !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_61;
    v13 = 73;
    LODWORD(PreparsedData) = result;
    v14 = 5;
    goto LABEL_11;
  }
  v15 = a3[3];
  v16 = a3[4];
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LOBYTE(v11) = 5;
    WPP3Related5(WPP_GLOBAL_Control->DeviceExtension, v11, 5, 74, &WPP3TraceGuidRelated, v16, a3[5]);
  }
  v36 = 0LL;
  v33 = 0LL;
  v32 = 0LL;
  LODWORD(v32) = 56;
  v34 = 0x100000001LL;
  v35 = v6;
  result = (*(WdfFunctions_01015[0] + 192))(WdfDriverGlobals, &v32, 512LL, 1145455699LL, 8LL, &v31, &v30);
  v12 = result;
  if ( result < 0 )
  {
    v31 = 0LL;
    v30 = 0LL;
    if ( off_14000D008 == &off_14000D008 )
      return result;
    v13 = 75;
    goto LABEL_18;
  }
  *v30 = 0LL;
  *v30 = 1;
  v17 = (*(WdfFunctions_01015[0] + 194))(WdfDriverGlobals, v15, 0LL);
  result = HidP_GetUsageValue(HidP_Input, 1u, 0, 0x37u, &UsageValue, v8, v17, v16);
  v12 = result;
  if ( result < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_61;
    v13 = 76;
    goto LABEL_23;
  }
  *(v30 + 6) = UsageValue;
  result = *(v7 + 390);
  if ( result > 5u )
  {
    if ( off_14000D008 == &off_14000D008 )
    {
LABEL_28:
      v12 = -1073741789;
      goto LABEL_61;
    }
    v18 = 77;
LABEL_27:
    LODWORD(Report) = result;
    LODWORD(PreparsedData) = 5;
    result = WPP3Related(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v18, &WPP3TraceGuidRelated, PreparsedData, Report);
    goto LABEL_28;
  }
  _mm_lfence();
  memset(UsageList, 0, 2LL * *(v7 + 390));
  UsageLength = *(v7 + 390);
  result = HidP_GetUsages(HidP_Input, 9u, 0, UsageList, &UsageLength, v8, v17, v16);
  v12 = result;
  if ( result < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_61;
    v13 = 78;
    goto LABEL_23;
  }
  v19 = UsageLength;
  for ( i = 0; i < v19; ++i )
  {
    if ( UsageList[i] == 1 )
    {
      *(v30 + 4) = 1;
      v19 = UsageLength;
    }
  }
  result = *(v7 + 390);
  if ( result > 5u )
  {
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_28;
    v18 = 79;
    goto LABEL_27;
  }
  _mm_lfence();
  memset(UsageList, 0, 2LL * *(v7 + 390));
  UsageLength = *(v7 + 390);
  result = HidP_GetUsages(HidP_Input, 0xDu, 0, UsageList, &UsageLength, v8, v17, v16);
  v12 = result;
  if ( result < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_61;
    v13 = 80;
LABEL_23:
    LODWORD(PreparsedData) = result;
    goto LABEL_19;
  }
  v21 = UsageLength;
  for ( j = 0; j < v21; ++j )
  {
    if ( UsageList[j] == 51 )
    {
      *(v30 + 5) = 1;
      v21 = UsageLength;
    }
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(ReportLength) = *(v30 + 5);
    LODWORD(Reporta) = *(v30 + 4);
    LODWORD(PreparsedData) = *(v30 + 6);
    WPP3Related2(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      5u,
      0x51u,
      &WPP3TraceGuidRelated,
      PreparsedData,
      Reporta,
      ReportLength);
  }
  v23 = _InterlockedCompareExchange((v7 + 620), 0, 0);
  if ( v23 < *(v7 + 624) )
  {
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      _mm_lfence();
      LODWORD(Reporta) = *(v7 + 624);
      LODWORD(PreparsedData) = v23;
      WPP3Related(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x52u, &WPP3TraceGuidRelated, PreparsedData, Reporta);
    }
    *(v30 + 6) = 0;
  }
  (*(WdfFunctions_01015[0] + 316))(WdfDriverGlobals, *(v7 + 144));
  v12 = (*(WdfFunctions_01015[0] + 15))(WdfDriverGlobals, *(v7 + 136), v31);
  result = (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v7 + 144));
  if ( v12 >= 0 )
  {
    v31 = 0LL;
    v30 = 0LL;
    v24 = (*(WdfFunctions_01015[0] + 14))(WdfDriverGlobals, *(v7 + 136));
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(PreparsedData) = v24;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x54u, &WPP3TraceGuidRelated, PreparsedData);
    }
    KeSetEvent((v7 + 200), 0, 0);
    result = KeSetEvent((v7 + 408), 0, 0);
    goto LABEL_61;
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    v13 = 83;
LABEL_18:
    LODWORD(PreparsedData) = v12;
LABEL_19:
    v14 = 2;
LABEL_11:
    _mm_lfence();
    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, v14, 5u, v13, &WPP3TraceGuidRelated, PreparsedData);
  }
LABEL_61:
  if ( v31 )
  {
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    v31 = 0LL;
    v30 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(PreparsedData) = v12;
      return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x55u, &WPP3TraceGuidRelated, PreparsedData);
    }
  }
  return result;
}
// 14000677D: variable 'PreparsedData' is possibly undefined
// 1400067D9: variable 'v11' is possibly undefined
// 14000697B: variable 'Report' is possibly undefined
// 140006B63: variable 'Reporta' is possibly undefined
// 140006B63: variable 'ReportLength' is possibly undefined
// 14000984C: using guessed type __int64 __fastcall WPP3Related5(_DWORD, _DWORD, _DWORD, _DWORD, __int64, char, char);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140006D60) ----------------------------------------------------
int __fastcall CompletionRoutine1_sub_140006D60(__int64 a1, __int64 a2, _QWORD *a3)
{
  __int64 v6; // rdi
  struct _HIDP_PREPARSED_DATA *v7; // r14
  signed __int32 v8; // eax
  int result; // eax
  int v10; // edx
  int v11; // ebx
  unsigned __int16 v12; // r9
  __int64 v13; // rbx
  __int64 ReportLength; // r12
  CHAR *v15; // r13
  unsigned __int16 v16; // r9
  __int16 v17; // r14
  __int16 v18; // si
  unsigned __int8 v19; // r12
  char v20; // r13
  USHORT *v21; // rax
  __int64 v22; // rdx
  int v23; // edx
  signed __int32 v24; // eax
  __int32 v25; // ecx
  __int32 v26; // ecx
  int v27; // eax
  PHIDP_PREPARSED_DATA PreparsedData; // [rsp+28h] [rbp-91h]
  PCHAR Report; // [rsp+30h] [rbp-89h]
  __int64 v30; // [rsp+58h] [rbp-61h]
  struct _HIDP_PREPARSED_DATA *v31; // [rsp+60h] [rbp-59h]
  __int64 v32; // [rsp+68h] [rbp-51h]
  __int64 v33; // [rsp+70h] [rbp-49h] BYREF
  _QWORD *v34; // [rsp+78h] [rbp-41h] BYREF
  __int128 v35; // [rsp+80h] [rbp-39h] BYREF
  __int64 v36; // [rsp+90h] [rbp-29h]
  __int64 v37; // [rsp+98h] [rbp-21h]
  __int128 v38; // [rsp+A0h] [rbp-19h]
  __int64 v39; // [rsp+B0h] [rbp-9h]
  ULONG UsageValue; // [rsp+B8h] [rbp-1h] BYREF
  ULONG UsageLength; // [rsp+BCh] [rbp+3h] BYREF
  USHORT UsageList[4]; // [rsp+C0h] [rbp+7h] BYREF
  __int16 v43; // [rsp+C8h] [rbp+Fh]

  v33 = 0LL;
  *UsageList = 0LL;
  v43 = 0;
  v34 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x56u, &WPP3TraceGuidRelated);
  v32 = (*(WdfFunctions_01015[0] + 174))(WdfDriverGlobals, a2);
  v6 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, v32, DeviceContextTypeInfo);
  v7 = *(v6 + 496);
  v31 = v7;
  v8 = _InterlockedDecrement((v6 + 592));
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x57u, &WPP3TraceGuidRelated, v8);
  result = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, a1);
  v11 = result;
  if ( result >= 0 )
  {
    v13 = a3[3];
    ReportLength = a3[4];
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LOBYTE(v10) = 5;
      WPP3Related5(WPP_GLOBAL_Control->DeviceExtension, v10, 5, 89, &WPP3TraceGuidRelated, ReportLength, a3[5]);
    }
    LODWORD(v30) = 2;
    v15 = (*(WdfFunctions_01015[0] + 194))(WdfDriverGlobals, v13, 0LL);
    result = HidP_GetUsageValue(HidP_Input, 1u, 0, 0x30u, &UsageValue, v7, v15, ReportLength);
    v11 = result;
    if ( result >= 0 )
    {
      _mm_lfence();
      v17 = UsageValue;
      WORD2(v30) = UsageValue;
      result = HidP_GetUsageValue(HidP_Input, 1u, 0, 0x31u, &UsageValue, v31, v15, ReportLength);
      v11 = result;
      if ( result >= 0 )
      {
        result = *(v6 + 550);
        v18 = UsageValue;
        HIWORD(v30) = UsageValue;
        if ( result > 5u )
        {
          if ( off_14000D008 != &off_14000D008 )
          {
            LODWORD(Report) = *(v6 + 550);
            LODWORD(PreparsedData) = 5;
            result = WPP3Related(
                       WPP_GLOBAL_Control->DeviceExtension,
                       2u,
                       5u,
                       0x5Cu,
                       &WPP3TraceGuidRelated,
                       PreparsedData,
                       Report);
          }
          v11 = -1073741789;
          goto LABEL_19;
        }
        _mm_lfence();
        memset(UsageList, 0, 2LL * *(v6 + 550));
        UsageLength = *(v6 + 550);
        result = HidP_GetUsages(HidP_Input, 0xDu, 0, UsageList, &UsageLength, v31, v15, ReportLength);
        v11 = result;
        if ( result < 0 )
        {
          if ( off_14000D008 == &off_14000D008 )
            goto LABEL_19;
          v12 = 93;
          goto LABEL_10;
        }
        v11 = 0;
        v19 = 0;
        v20 = 0;
        if ( UsageLength )
        {
          v21 = UsageList;
          v22 = UsageLength;
          do
          {
            if ( *v21 == 66 )
            {
              v19 = 1;
            }
            else if ( *v21 == 71 )
            {
              v20 = 1;
            }
            ++v21;
            --v22;
          }
          while ( v22 );
        }
        if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
        {
          v23 = v19;
          LOBYTE(v23) = 5;
          WPPRelated5(WPP_GLOBAL_Control->DeviceExtension, v23, 5, 94, &WPP3TraceGuidRelated, v17, v18, v19, v20);
        }
        if ( !v19 )
        {
          if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
            WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x5Fu, &WPP3TraceGuidRelated);
          HIDWORD(v30) = -1;
          v17 = -1;
          v18 = -1;
        }
        if ( v20 )
        {
          if ( *(v6 + 616) == v17 && *(v6 + 618) == v18 )
          {
            if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
              WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x60u, &WPP3TraceGuidRelated);
            _InterlockedExchangeAdd((v6 + 620), 1u);
            v24 = _InterlockedCompareExchange((v6 + 620), 120, 121);
            if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
            {
              LODWORD(PreparsedData) = v24;
              WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x61u, &WPP3TraceGuidRelated, PreparsedData);
            }
          }
          else
          {
            *(v6 + 616) = v17;
            *(v6 + 618) = v18;
            if ( v17 != -1 || (v25 = 120, v18 != -1) )
              v25 = 0;
            v26 = _InterlockedExchange((v6 + 620), v25);
            if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
            {
              LODWORD(PreparsedData) = v26;
              WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x62u, &WPP3TraceGuidRelated, PreparsedData);
            }
            v39 = 0LL;
            v36 = 0LL;
            v38 = v32;
            v35 = 0LL;
            LODWORD(v35) = 56;
            v37 = 0x100000001LL;
            result = (*(WdfFunctions_01015[0] + 192))(WdfDriverGlobals, &v35, 512LL, 1145455699LL, 8LL, &v33, &v34);
            v11 = result;
            if ( result < 0 )
            {
              v33 = 0LL;
              v34 = 0LL;
              if ( off_14000D008 == &off_14000D008 )
                return result;
              v12 = 99;
              goto LABEL_10;
            }
            *v34 = 0LL;
            *v34 = v30;
            (*(WdfFunctions_01015[0] + 316))(WdfDriverGlobals, *(v6 + 144));
            v11 = (*(WdfFunctions_01015[0] + 15))(WdfDriverGlobals, *(v6 + 136), v33);
            result = (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v6 + 144));
            if ( v11 < 0 )
            {
              if ( off_14000D008 == &off_14000D008 )
                goto LABEL_19;
              v12 = 100;
              LODWORD(PreparsedData) = v11;
              goto LABEL_11;
            }
            v33 = 0LL;
            v34 = 0LL;
            v27 = (*(WdfFunctions_01015[0] + 14))(WdfDriverGlobals, *(v6 + 136));
            if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
            {
              LODWORD(PreparsedData) = v27;
              WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x65u, &WPP3TraceGuidRelated, PreparsedData);
            }
            KeSetEvent((v6 + 200), 0, 0);
          }
        }
        else if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
        {
          WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x66u, &WPP3TraceGuidRelated);
        }
        result = KeSetEvent((v6 + 568), 0, 0);
        goto LABEL_19;
      }
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_19;
      v16 = 91;
    }
    else
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_19;
      v16 = 90;
    }
    _mm_lfence();
    LODWORD(PreparsedData) = result;
    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v16, &WPP3TraceGuidRelated, PreparsedData);
    goto LABEL_19;
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    v12 = 88;
LABEL_10:
    LODWORD(PreparsedData) = result;
LABEL_11:
    _mm_lfence();
    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v12, &WPP3TraceGuidRelated, PreparsedData);
  }
LABEL_19:
  if ( v33 )
  {
    result = (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals);
    v33 = 0LL;
    v34 = 0LL;
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(PreparsedData) = v11;
      return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x67u, &WPP3TraceGuidRelated, PreparsedData);
    }
  }
  return result;
}
// 140006EE3: variable 'PreparsedData' is possibly undefined
// 140006F35: variable 'v10' is possibly undefined
// 14000712F: variable 'Report' is possibly undefined
// 140005B40: using guessed type __int64 __fastcall WPPRelated5(_DWORD, _DWORD, _DWORD, _DWORD, __int64, char, char, char, char);
// 14000984C: using guessed type __int64 __fastcall WPP3Related5(_DWORD, _DWORD, _DWORD, _DWORD, __int64, char, char);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140007610) ----------------------------------------------------
int __fastcall EvtIoDeviceControl(__int64 a1, __int64 a2, char a3, char a4, unsigned int a5)
{
  int v5; // edi
  PDEVICE_OBJECT v10; // rbx
  const char *HIDIoControlCodeString; // rax
  int v12; // edx
  __int64 v13; // rbx
  __int64 v14; // rbp
  __int64 v15; // rbx
  int result; // eax
  const char *v17; // rax
  int v18; // edx
  unsigned __int16 v19; // r9
  __int64 v20; // rax
  __int64 v21; // rdx
  __int64 v22; // r9
  __int64 v23; // rbx
  __int64 v24; // [rsp+28h] [rbp-90h]
  __int64 v25; // [rsp+60h] [rbp-58h] BYREF
  _DWORD v26[2]; // [rsp+68h] [rbp-50h] BYREF
  __int64 v27; // [rsp+70h] [rbp-48h]

  v5 = 0;
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x11u, &WPP3TraceGuidRelated);
    if ( off_14000D008 != &off_14000D008 )
    {
      v10 = WPP_GLOBAL_Control;
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        HIDIoControlCodeString = GetHIDIoControlCodeString(a5);
        LOBYTE(v12) = 5;
        WPP3Related7(
          v10->DeviceExtension,
          v12,
          5,
          18,
          &WPP3TraceGuidRelated,
          a1,
          a2,
          a3,
          a4,
          HIDIoControlCodeString,
          a5);
      }
    }
  }
  v13 = (*(WdfFunctions_01015[0] + 157))(WdfDriverGlobals, a1);
  v14 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, v13, DeviceContextTypeInfo);
  v15 = (*(WdfFunctions_01015[0] + 42))(WdfDriverGlobals, v13);
  if ( a5 != 721299 )
  {
    if ( a5 != 721314 )
    {
      (*(WdfFunctions_01015[0] + 251))(WdfDriverGlobals, a2);
      v27 = 0LL;
      v26[0] = 16;
      v26[1] = 8;
      result = (*(WdfFunctions_01015[0] + 253))(WdfDriverGlobals, a2, v15, v26);
      if ( result )
        goto LABEL_38;
      result = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, a2);
      v5 = result;
      if ( off_14000D008 != &off_14000D008 )
      {
        v17 = GetHIDIoControlCodeString(a5);
        LOBYTE(v18) = 2;
        result = WPP3Related8(WPP_GLOBAL_Control->DeviceExtension, v18, 5, 23, &WPP3TraceGuidRelated, v17, a5, v5);
      }
LABEL_36:
      if ( v5 >= 0 )
        goto LABEL_38;
      goto LABEL_37;
    }
    if ( !*(v14 + 152) )
      WPP2RelatedMacro(0, "EvtIoDeviceControl", 253, L"pDeviceContext->hIncomingQueue != NULL");
    (*(WdfFunctions_01015[0] + 316))(WdfDriverGlobals, *(v14 + 168));
    v5 = (*(WdfFunctions_01015[0] + 281))(WdfDriverGlobals, a2, *(v14 + 152));
    result = (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v14 + 168));
    if ( v5 >= 0 )
    {
      result = KeSetEvent((v14 + 176), 0, 0);
      goto LABEL_36;
    }
    if ( off_14000D008 == &off_14000D008 )
      goto LABEL_36;
    v19 = 22;
    LODWORD(v24) = v5;
LABEL_28:
    _mm_lfence();
    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v19, &WPP3TraceGuidRelated, v24);
    goto LABEL_36;
  }
  v25 = 0LL;
  if ( (*(WdfFunctions_01015[0] + 280))(WdfDriverGlobals, a2) != 1 )
  {
    result = (*(WdfFunctions_01015[0] + 268))(WdfDriverGlobals, a2, &v25);
    v5 = result;
    if ( result < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_36;
      v19 = 20;
LABEL_27:
      LODWORD(v24) = result;
      goto LABEL_28;
    }
    v21 = v25;
LABEL_30:
    v22 = *(v14 + 64);
    if ( *(v22 + 26) )
    {
      v23 = *(v22 + 26);
      result = (*(WdfFunctions_01015[0] + 197))(WdfDriverGlobals, v21, 0LL, *(v22 + 32), v23);
      v5 = result;
      if ( result < 0 )
      {
        if ( off_14000D008 == &off_14000D008 )
          goto LABEL_36;
        v19 = 21;
        goto LABEL_27;
      }
    }
    else
    {
      v23 = 0LL;
    }
    result = (*(WdfFunctions_01015[0] + 265))(WdfDriverGlobals, a2, v5, v23);
    goto LABEL_36;
  }
  v20 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a2, off_14000D050);
  v21 = *(v20 + 8);
  if ( v21 )
  {
    v25 = *(v20 + 8);
    goto LABEL_30;
  }
  if ( off_14000D008 != &off_14000D008 )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x13u, &WPP3TraceGuidRelated);
  v5 = -1073740951;
LABEL_37:
  _mm_lfence();
  result = (*(WdfFunctions_01015[0] + 263))(WdfDriverGlobals, a2, v5);
LABEL_38:
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x18u, &WPP3TraceGuidRelated);
  }
  return result;
}
// 1400076EF: variable 'v12' is possibly undefined
// 14000784B: variable 'v18' is possibly undefined
// 140007A04: variable 'v24' is possibly undefined
// 140009A88: using guessed type __int64 __fastcall WPP3Related7(_DWORD, _DWORD, _DWORD, _DWORD, __int64, __int64, __int64, char, char, __int64, char);
// 140009CB4: using guessed type __int64 __fastcall WPP3Related8(_DWORD, _DWORD, _DWORD, _DWORD, __int64, __int64, char, char);
// 14000A8C0: using guessed type wchar_t aPdevicecontext[39];
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;
// 14000D050: using guessed type _UNKNOWN *off_14000D050;

//----- (0000000140007B20) ----------------------------------------------------
LONG __fastcall EvtIoRead(__int64 a1, __int64 a2, char a3)
{
  __int64 v4; // rbx
  __int64 v6; // rax
  __int64 v7; // rdi
  int v8; // esi
  LONG result; // eax
  __int64 v10; // [rsp+28h] [rbp-30h]

  v4 = a2;
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xDu, &WPP3TraceGuidRelated);
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LOBYTE(a2) = 5;
      WPP3Related6(WPP_GLOBAL_Control->DeviceExtension, a2, 5, 14, &WPP3TraceGuidRelated, a1, v4, a3);
    }
  }
  v6 = (*(WdfFunctions_01015[0] + 157))(WdfDriverGlobals, a1);
  v7 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, v6, DeviceContextTypeInfo);
  if ( !*(v7 + 152) )
    WPP2RelatedMacro(0, "EvtIoRead", 132, L"pDeviceContext->hIncomingQueue != NULL");
  (*(WdfFunctions_01015[0] + 316))(WdfDriverGlobals, *(v7 + 168));
  v8 = (*(WdfFunctions_01015[0] + 281))(WdfDriverGlobals, v4, *(v7 + 152));
  (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v7 + 168));
  if ( v8 >= 0 )
  {
    result = KeSetEvent((v7 + 176), 0, 0);
  }
  else
  {
    _mm_lfence();
    if ( off_14000D008 != &off_14000D008 )
    {
      LODWORD(v10) = v8;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0xFu, &WPP3TraceGuidRelated, v10);
    }
    result = (*(WdfFunctions_01015[0] + 263))(WdfDriverGlobals, v4, v8);
  }
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x10u, &WPP3TraceGuidRelated);
  }
  return result;
}
// 140007BBE: variable 'a2' is possibly undefined
// 140007CC8: variable 'v10' is possibly undefined
// 140009940: using guessed type __int64 __fastcall WPP3Related6(_DWORD, _DWORD, _DWORD, _DWORD, __int64, __int64, __int64, char);
// 14000A8C0: using guessed type wchar_t aPdevicecontext[39];
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140007D50) ----------------------------------------------------
const char *__fastcall GetHIDIoControlCodeString(unsigned int a1)
{
  int v1; // ecx
  int v2; // ecx
  int v3; // ecx
  int v4; // ecx
  int v5; // ecx
  int v6; // ecx
  int v8; // ecx
  int v9; // ecx
  int v10; // ecx
  int v11; // ecx
  int v12; // ecx
  int v13; // ecx
  int v14; // ecx
  int v15; // ecx
  int v16; // ecx
  int v17; // ecx
  int v18; // ecx

  if ( a1 <= 0xB01A8 )
  {
    if ( a1 == 721320 )
      return "IOCTL_HID_GET_COLLECTION_INFORMATION";
    if ( a1 > 0xB0198 )
    {
      v8 = a1 - 721306;
      if ( !v8 )
        return "IOCTL_GET_PHYSICAL_DESCRIPTOR";
      v9 = v8 - 2;
      if ( !v9 )
        return "IOCTL_HID_SET_POLL_FREQUENCY_MSEC";
      v10 = v9 - 2;
      if ( !v10 )
        return "IOCTL_HID_GET_HARDWARE_ID";
      v11 = v10 - 2;
      if ( !v11 )
        return "IOCTL_GET_NUM_DEVICE_INPUT_BUFFERS";
      v12 = v11 - 2;
      if ( !v12 )
        return "IOCTL_HID_GET_INPUT_REPORT";
      if ( v12 == 2 )
        return "IOCTL_SET_NUM_DEVICE_INPUT_BUFFERS";
    }
    else
    {
      if ( a1 == 721304 )
        return "IOCTL_HID_GET_POLL_FREQUENCY_MSEC";
      v1 = a1 - 721296;
      if ( !v1 )
        return "IOCTL_HID_GET_DRIVER_CONFIG";
      v2 = v1 - 1;
      if ( !v2 )
        return "IOCTL_HID_SET_FEATURE";
      v3 = v2 - 1;
      if ( !v3 )
        return "IOCTL_HID_GET_FEATURE";
      v4 = v3 - 1;
      if ( !v4 )
        return "IOCTL_HID_GET_COLLECTION_DESCRIPTOR";
      v5 = v4 - 1;
      if ( !v5 )
        return "IOCTL_HID_SET_DRIVER_CONFIG";
      v6 = v5 - 1;
      if ( !v6 )
        return "IOCTL_HID_SET_OUTPUT_REPORT";
      if ( v6 == 2 )
        return "IOCTL_HID_FLUSH_QUEUE";
    }
    return "Unknown";
  }
  v13 = a1 - 721338;
  if ( !v13 )
    return "IOCTL_HID_GET_MANUFACTURER_STRING";
  v14 = v13 - 4;
  if ( !v14 )
    return "IOCTL_HID_GET_PRODUCT_STRING";
  v15 = v14 - 4;
  if ( !v15 )
    return "IOCTL_HID_GET_SERIALNUMBER_STRING";
  v16 = v15 - 32;
  if ( !v16 )
    return "IOCTL_HID_GET_INDEXED_STRING";
  v17 = v16 - 4;
  if ( !v17 )
    return "IOCTL_HID_GET_MS_GENRE_DESCRIPTOR";
  v18 = v17 - 37;
  if ( !v18 )
    return "IOCTL_HID_ENABLE_SECURE_READ";
  if ( v18 != 4 )
    return "Unknown";
  return "IOCTL_HID_DISABLE_SECURE_READ";
}

//----- (0000000140007E98) ----------------------------------------------------
__int64 __fastcall PsCreateSystemThreadStartRoutine1_sub_140007E98(unsigned __int8 *a1, __int64 a2)
{
  unsigned int v3; // edi
  __int64 v5; // rdx
  int v6; // eax
  unsigned __int16 v7; // r9
  signed __int32 v8; // eax
  __int64 v10; // [rsp+28h] [rbp-70h]
  __int64 v11; // [rsp+50h] [rbp-48h] BYREF
  int v12; // [rsp+58h] [rbp-40h]
  __int64 v13; // [rsp+5Ch] [rbp-3Ch]
  int v14; // [rsp+64h] [rbp-34h]

  v3 = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x37u, &WPP3TraceGuidRelated);
  KeClearEvent((a1 + 112));
  if ( !*a1 || !*(a1 + 1) || (v5 = *(a1 + 18)) == 0 || !*(a1 + 19) )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP3Related4(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        5u,
        0x38u,
        &WPP3TraceGuidRelated,
        *a1,
        *(a1 + 1),
        *(a1 + 18),
        *(a1 + 19));
    goto LABEL_25;
  }
  v13 = 0LL;
  v14 = 0;
  v11 = 24LL;
  v12 = 0;
  v6 = (*(WdfFunctions_01015[0] + 249))(WdfDriverGlobals, v5, &v11);
  v3 = v6;
  if ( v6 < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    v7 = 57;
    goto LABEL_11;
  }
  v6 = (*(WdfFunctions_01015[0] + 183))(WdfDriverGlobals, *(a1 + 1), *(a1 + 18), *(a1 + 19), 0LL, 0LL);
  v3 = v6;
  if ( v6 < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v3;
    v7 = 58;
LABEL_11:
    _mm_lfence();
    goto LABEL_12;
  }
  (*(WdfFunctions_01015[0] + 260))(WdfDriverGlobals, *(a1 + 18), a2, 0LL);
  v8 = _InterlockedIncrement(a1 + 34);
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v8;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Bu, &WPP3TraceGuidRelated, v10);
  }
  if ( (*(WdfFunctions_01015[0] + 253))(WdfDriverGlobals, *(a1 + 18), *(a1 + 1), 0LL) )
    goto LABEL_25;
  v6 = (*(WdfFunctions_01015[0] + 254))(WdfDriverGlobals, *(a1 + 18));
  v3 = v6;
  if ( off_14000D008 == &off_14000D008 )
    return v3;
  v7 = 60;
LABEL_12:
  LODWORD(v10) = v6;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v7, &WPP3TraceGuidRelated, v10);
LABEL_25:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Du, &WPP3TraceGuidRelated, v10);
  }
  return v3;
}
// 140007FAE: variable 'v10' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (000000014000819C) ----------------------------------------------------
__int64 __fastcall HidSetSomeDataHmm(
        __int64 a1,
        unsigned __int8 *a2,
        _WORD *a3,
        struct _HIDP_PREPARSED_DATA *a4,
        __int64 a5)
{
  NTSTATUS v9; // ebx
  unsigned __int16 v10; // r9
  ULONG v11; // ecx
  ULONG v12; // ecx
  CHAR *v13; // rax
  PHIDP_PREPARSED_DATA PreparsedData; // [rsp+28h] [rbp-69h]
  int PreparsedDataa; // [rsp+28h] [rbp-69h]
  int Report; // [rsp+30h] [rbp-61h]
  CHAR *Reporta; // [rsp+30h] [rbp-61h]
  ULONG ReportLength; // [rsp+38h] [rbp-59h]
  ULONG ReportLengtha; // [rsp+38h] [rbp-59h]
  ULONG ReportLengthb; // [rsp+38h] [rbp-59h]
  int v22; // [rsp+40h] [rbp-51h]
  int v23; // [rsp+48h] [rbp-49h]
  ULONG UsageLength; // [rsp+50h] [rbp-41h] BYREF
  ULONG v25; // [rsp+54h] [rbp-3Dh] BYREF
  PCHAR v26; // [rsp+58h] [rbp-39h] BYREF
  size_t Size; // [rsp+60h] [rbp-31h] BYREF
  USHORT UsageList[8]; // [rsp+68h] [rbp-29h] BYREF
  int v29; // [rsp+78h] [rbp-19h]
  USHORT v30[8]; // [rsp+80h] [rbp-11h] BYREF
  int v31; // [rsp+90h] [rbp-1h]

  v29 = 0;
  UsageLength = 0;
  v25 = 0;
  v31 = 0;
  *UsageList = 0LL;
  *v30 = 0LL;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x68u, &WPP3TraceGuidRelated);
  v9 = (*(WdfFunctions_01015[0] + 270))(WdfDriverGlobals, a1, *(a5 + 4), &v26, &Size);
  if ( v9 >= 0 )
  {
    memset(v26, 0, Size);
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v23 = *(a2 + 2);
      v22 = *(a2 + 1);
      ReportLength = a2[1];
      Report = *a2;
      PreparsedDataa = *a3;
      WPP3Related3(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        5u,
        0x6Au,
        &WPP3TraceGuidRelated,
        PreparsedDataa,
        Report,
        ReportLength,
        v22,
        v23);
    }
    v9 = HidP_SetUsageValue(HidP_Input, 1u, 0, 0x37u, *a3, a4, v26, *(a5 + 4));
    if ( v9 >= 0 )
    {
      _mm_lfence();
      v9 = HidP_SetUsageValue(HidP_Input, 1u, 0, 0x30u, *(a2 + 1), a4, v26, *(a5 + 4));
      if ( v9 >= 0 )
      {
        _mm_lfence();
        v9 = HidP_SetUsageValue(HidP_Input, 1u, 0, 0x31u, *(a2 + 2), a4, v26, *(a5 + 4));
        if ( v9 >= 0 )
        {
          if ( *a2
            && (_mm_lfence(),
                v11 = UsageLength,
                ReportLengtha = *(a5 + 4),
                Reporta = v26,
                UsageList[UsageLength] = 1,
                UsageLength = v11 + 1,
                v9 = HidP_SetUsages(HidP_Input, 9u, 0, UsageList, &UsageLength, a4, Reporta, ReportLengtha),
                v9 < 0) )
          {
            if ( off_14000D008 == &off_14000D008 )
              return v9;
            v10 = 110;
          }
          else
          {
            v9 = 0;
            if ( !a2[1] )
              goto LABEL_29;
            _mm_lfence();
            v12 = v25;
            ReportLengthb = *(a5 + 4);
            v13 = v26;
            v30[v25] = 51;
            v25 = v12 + 1;
            v9 = HidP_SetUsages(HidP_Input, 0xDu, 0, v30, &v25, a4, v13, ReportLengthb);
            if ( v9 >= 0 )
            {
              v9 = 0;
              goto LABEL_29;
            }
            if ( off_14000D008 == &off_14000D008 )
              return v9;
            v10 = 111;
          }
        }
        else
        {
          if ( off_14000D008 == &off_14000D008 )
            return v9;
          v10 = 109;
        }
      }
      else
      {
        if ( off_14000D008 == &off_14000D008 )
          return v9;
        v10 = 108;
      }
    }
    else
    {
      if ( off_14000D008 == &off_14000D008 )
        return v9;
      v10 = 107;
    }
  }
  else
  {
    if ( off_14000D008 == &off_14000D008 )
      return v9;
    v10 = 105;
  }
  _mm_lfence();
  LODWORD(PreparsedData) = v9;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v10, &WPP3TraceGuidRelated, PreparsedData);
LABEL_29:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(PreparsedData) = v9;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x70u, &WPP3TraceGuidRelated, PreparsedData);
  }
  return v9;
}
// 1400082A7: variable 'PreparsedData' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (000000014000857C) ----------------------------------------------------
__int64 __fastcall PsCreateSystemThreadStartRoutine2_sub_14000857C(__int64 a1)
{
  unsigned int v2; // edi
  __int64 v3; // rbx
  PDEVICE_OBJECT v4; // rcx
  unsigned __int16 v5; // r9
  int v6; // eax
  int v7; // esi
  __int64 v8; // rax
  __int64 v9; // rsi
  __int64 v10; // rax
  __int64 v11; // rdx
  __int64 v12; // r14
  __int64 v13; // rax
  int v14; // eax
  __int64 v16; // [rsp+28h] [rbp-38h]
  __int64 v17; // [rsp+30h] [rbp-30h] BYREF
  __int64 v18; // [rsp+38h] [rbp-28h]
  __int64 v19; // [rsp+40h] [rbp-20h] BYREF
  int v20; // [rsp+48h] [rbp-18h] BYREF

  v2 = 0;
  v19 = 0LL;
  LOWORD(v17) = 0;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Eu, &WPP3TraceGuidRelated);
  v3 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, a1, DeviceContextTypeInfo);
  (*(WdfFunctions_01015[0] + 316))(WdfDriverGlobals, *(v3 + 168));
  (*(WdfFunctions_01015[0] + 316))(WdfDriverGlobals, *(v3 + 144));
  (*(WdfFunctions_01015[0] + 153))(WdfDriverGlobals, *(v3 + 152), &v20, 0LL);
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Fu, &WPP3TraceGuidRelated, v20, v17);
  if ( v20 )
  {
    v6 = (*(WdfFunctions_01015[0] + 14))(WdfDriverGlobals, *(v3 + 136));
    v7 = v6;
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v16) = v6;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x41u, &WPP3TraceGuidRelated, v16);
    }
    if ( v7 )
    {
      v8 = *(v3 + 160);
      v9 = *(v3 + 152);
      *(v3 + 160) = v9;
      *(v3 + 152) = v8;
      KeClearEvent((v3 + 176));
      v10 = (*(WdfFunctions_01015[0] + 19))(WdfDriverGlobals, *(v3 + 136));
      v11 = *(v3 + 136);
      v12 = v10;
      v18 = v10;
      (*(WdfFunctions_01015[0] + 17))(WdfDriverGlobals, v11, 0LL);
      if ( !(*(WdfFunctions_01015[0] + 14))(WdfDriverGlobals, *(v3 + 136)) )
        KeClearEvent((v3 + 200));
      (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v3 + 144));
      (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v3 + 168));
      v13 = (*(WdfFunctions_01015[0] + 194))(WdfDriverGlobals, v12, 0LL);
      if ( *v13 == 1 )
      {
        *(v3 + 636) = *(v13 + 4);
        *(v3 + 637) = *(v13 + 5);
        LOWORD(v17) = *(v13 + 6);
      }
      else if ( *v13 == 2 )
      {
        *(v3 + 638) = *(v13 + 4);
        *(v3 + 640) = *(v13 + 6);
      }
      else if ( off_14000D008 != &off_14000D008 )
      {
        LODWORD(v16) = *v13;
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x43u, &WPP3TraceGuidRelated, v16);
      }
      if ( v9 )
      {
        if ( !(*(WdfFunctions_01015[0] + 158))(WdfDriverGlobals, v9, &v19) )
        {
          do
          {
            v2 = HidSetSomeDataHmm(v19, (v3 + 636), &v17, *(*(v3 + 64) + 32LL), v3 + 72);
            if ( (v2 & 0x80000000) != 0 && off_14000D008 != &off_14000D008 )
            {
              _mm_lfence();
              LODWORD(v16) = v2;
              WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x44u, &WPP3TraceGuidRelated, v16);
            }
            (*(WdfFunctions_01015[0] + 265))(WdfDriverGlobals, v19, 0LL, *(v3 + 76));
            v19 = 0LL;
          }
          while ( !(*(WdfFunctions_01015[0] + 158))(WdfDriverGlobals, v9, &v19) );
          v12 = v18;
        }
        v14 = 0;
        if ( v2 != -2147483622 )
          v14 = v2;
        v2 = v14;
        if ( v14 < 0 && off_14000D008 != &off_14000D008 )
        {
          _mm_lfence();
          LODWORD(v16) = v14;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x45u, &WPP3TraceGuidRelated, v16);
        }
      }
      if ( v12 )
        (*(WdfFunctions_01015[0] + 208))(WdfDriverGlobals, v12);
      goto LABEL_41;
    }
    (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v3 + 144));
    (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v3 + 168));
    KeClearEvent((v3 + 200));
    if ( off_14000D008 == &off_14000D008 )
      return v2;
    v4 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_41;
    v5 = 66;
    goto LABEL_11;
  }
  (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v3 + 144));
  (*(WdfFunctions_01015[0] + 317))(WdfDriverGlobals, *(v3 + 168));
  KeClearEvent((v3 + 176));
  if ( off_14000D008 == &off_14000D008 )
    return v2;
  v4 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    v5 = 64;
LABEL_11:
    WPP_RECORDER_SF_(v4->DeviceExtension, 5u, 5u, v5, &WPP3TraceGuidRelated);
  }
LABEL_41:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v16) = v2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x46u, &WPP3TraceGuidRelated, v16);
  }
  return v2;
}
// 1400087A4: variable 'v16' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140008B90) ----------------------------------------------------
void __fastcall PsCreateSystemThreadStartRoutine2(__int64 StartContext)
{
  NTSTATUS v2; // ebx
  char v3; // di
  __int64 v4; // rax
  int status; // eax
  unsigned __int16 v6; // r9
  NTSTATUS v7; // eax
  BOOLEAN Alertable[8]; // [rsp+30h] [rbp-31h]
  PVOID Object[2]; // [rsp+68h] [rbp+7h] BYREF
  PVOID v10[2]; // [rsp+78h] [rbp+17h] BYREF

  v2 = 0;
  v3 = 1;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x27u, &WPP3TraceGuidRelated);
  v4 = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, StartContext, DeviceContextTypeInfo);
  Object[1] = (v4 + 176);
  v10[1] = (v4 + 200);
  Object[0] = (v4 + 224);
  v10[0] = (v4 + 224);
  while ( 1 )
  {
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x2Cu, &WPP3TraceGuidRelated);
    status = KeWaitForMultipleObjects(2u, Object, WaitAny, Executive, 0, 0, 0LL, 0LL);
    if ( !status )
    {
      if ( off_14000D008 != &off_14000D008 )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 5u, 0x2Du, &WPP3TraceGuidRelated);
      v3 = 0;
      goto LABEL_16;
    }
    if ( status != 1 )
    {
      v2 = status;
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_37;
      v6 = 47;
      goto LABEL_36;
    }
    if ( off_14000D008 != &off_14000D008 )
    {
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x2Eu, &WPP3TraceGuidRelated);
LABEL_16:
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x30u, &WPP3TraceGuidRelated);
    }
    status = KeWaitForMultipleObjects(2u, v10, WaitAny, Executive, 0, 0, 0LL, 0LL);
    if ( !status )
    {
      if ( off_14000D008 != &off_14000D008 )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 5u, 0x31u, &WPP3TraceGuidRelated);
      v3 = 0;
      goto LABEL_30;
    }
    if ( status != 1 )
      break;
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x32u, &WPP3TraceGuidRelated);
    status = PsCreateSystemThreadStartRoutine2_sub_14000857C(StartContext);
    v2 = status;
    if ( status < 0 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_37;
      _mm_lfence();
      v6 = 51;
      goto LABEL_36;
    }
LABEL_30:
    if ( !v3 )
      goto LABEL_37;
  }
  v2 = status;
  if ( off_14000D008 == &off_14000D008 )
    goto LABEL_37;
  v6 = 52;
LABEL_36:
  *Alertable = status;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v6, &WPP3TraceGuidRelated, *Alertable);
LABEL_37:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    *Alertable = v2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x35u, &WPP3TraceGuidRelated, *Alertable);
  }
  v7 = PsTerminateSystemThread(v2);
  if ( v7 < 0 && off_14000D008 != &off_14000D008 )
  {
    _mm_lfence();
    *Alertable = v7;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x36u, &WPP3TraceGuidRelated, *Alertable);
  }
}
// 140008E75: conditional instruction was optimized away because %var_60.8==0
// 140008E69: variable 'Alertable' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140008F60) ----------------------------------------------------
void __fastcall PsCreateSystemThreadStartRoutine1(PVOID StartContext)
{
  NTSTATUS SystemThreadStartRoutine1_sub_140007E98; // ebx
  char v3; // di
  unsigned __int8 *DeviceContext; // rbp
  NTSTATUS v5; // eax
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  unsigned __int16 v8; // r9
  NTSTATUS v9; // eax
  char Alertable[8]; // [rsp+28h] [rbp-70h]
  PVOID Object[3]; // [rsp+50h] [rbp-48h] BYREF

  SystemThreadStartRoutine1_sub_140007E98 = 0;
  v3 = 1;
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x19u, &WPP3TraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + 202))(WdfDriverGlobals, StartContext, DeviceContextTypeInfo);
  Object[0] = DeviceContext + 224;
  Object[1] = DeviceContext + 408;
  Object[2] = DeviceContext + 568;
  while ( 1 )
  {
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x1Cu, &WPP3TraceGuidRelated);
    v5 = KeWaitForMultipleObjects(3u, Object, WaitAny, Executive, 0, 0, 0LL, 0LL);
    if ( !v5 )
    {
      if ( off_14000D008 != &off_14000D008 )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 5u, 0x1Du, &WPP3TraceGuidRelated);
      v3 = 0;
      goto LABEL_32;
    }
    if ( v5 == 1 )
    {
      if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x1Eu, &WPP3TraceGuidRelated);
      (*(WdfFunctions_01015[0] + 310))(WdfDriverGlobals, StartContext);
      SystemThreadStartRoutine1_sub_140007E98 = PsCreateSystemThreadStartRoutine1_sub_140007E98(
                                                  DeviceContext + 296,
                                                  CompletionRoutine1_sub_1400065E0);
      (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, StartContext);
      if ( SystemThreadStartRoutine1_sub_140007E98 >= 0 )
        goto LABEL_32;
      if ( SystemThreadStartRoutine1_sub_140007E98 != -1073741436 )
      {
        if ( off_14000D008 == &off_14000D008 )
          goto LABEL_42;
        v8 = 32;
        goto LABEL_40;
      }
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_28;
      v6 = WPP_GLOBAL_Control;
      if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
        goto LABEL_28;
      v7 = 31;
      goto LABEL_27;
    }
    if ( v5 != 2 )
      break;
    if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x21u, &WPP3TraceGuidRelated);
    (*(WdfFunctions_01015[0] + 310))(WdfDriverGlobals, StartContext);
    SystemThreadStartRoutine1_sub_140007E98 = PsCreateSystemThreadStartRoutine1_sub_140007E98(
                                                DeviceContext + 456,
                                                CompletionRoutine1_sub_140006D60);
    (*(WdfFunctions_01015[0] + 311))(WdfDriverGlobals, StartContext);
    if ( SystemThreadStartRoutine1_sub_140007E98 >= 0 )
      goto LABEL_32;
    if ( SystemThreadStartRoutine1_sub_140007E98 != -1073741436 )
    {
      if ( off_14000D008 == &off_14000D008 )
        goto LABEL_42;
      v8 = 35;
LABEL_40:
      _mm_lfence();
      *Alertable = SystemThreadStartRoutine1_sub_140007E98;
      goto LABEL_41;
    }
    if ( off_14000D008 != &off_14000D008 )
    {
      v6 = WPP_GLOBAL_Control;
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        v7 = 34;
LABEL_27:
        WPP_RECORDER_SF_(v6->DeviceExtension, 5u, 5u, v7, &WPP3TraceGuidRelated);
      }
    }
LABEL_28:
    SystemThreadStartRoutine1_sub_140007E98 = 0;
LABEL_32:
    if ( !v3 )
      goto LABEL_42;
  }
  SystemThreadStartRoutine1_sub_140007E98 = v5;
  if ( off_14000D008 == &off_14000D008 )
    goto LABEL_42;
  v8 = 36;
  *Alertable = v5;
LABEL_41:
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v8, &WPP3TraceGuidRelated, *Alertable);
LABEL_42:
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    *Alertable = SystemThreadStartRoutine1_sub_140007E98;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x25u, &WPP3TraceGuidRelated, *Alertable);
  }
  v9 = PsTerminateSystemThread(SystemThreadStartRoutine1_sub_140007E98);
  if ( v9 < 0 && off_14000D008 != &off_14000D008 )
  {
    _mm_lfence();
    *Alertable = v9;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x26u, &WPP3TraceGuidRelated, *Alertable);
  }
}
// 1400092C4: conditional instruction was optimized away because %var_50.8==0
// 1400092B7: variable 'Alertable' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D028: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140009380) ----------------------------------------------------
__int64 WPP3Related(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-68h]
  __int64 v13; // [rsp+B8h] [rbp+30h] BYREF
  va_list va; // [rsp+B8h] [rbp+30h]
  va_list va1; // [rsp+C0h] [rbp+38h] BYREF

  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    (pfnWppTraceMessage)(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8), 43LL, a5, v7, va, 4LL, va1, 4LL, 0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 4LL, va1);
}
// 140009461: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140009474) ----------------------------------------------------
__int64 WPP3Related2(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-78h]
  __int64 v13; // [rsp+C8h] [rbp+30h] BYREF
  va_list va; // [rsp+C8h] [rbp+30h]
  __int64 v15; // [rsp+D0h] [rbp+38h] BYREF
  va_list va1; // [rsp+D0h] [rbp+38h]
  va_list va2; // [rsp+D8h] [rbp+40h] BYREF

  va_start(va2, a5);
  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  v15 = va_arg(va2, _QWORD);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    (pfnWppTraceMessage)(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8),
      43LL,
      a5,
      v7,
      va,
      4LL,
      va1,
      4LL,
      va2,
      4LL,
      0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 4LL, va1);
}
// 140009573: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140009588) ----------------------------------------------------
__int64 WPP3Related3(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-98h]
  __int64 v13; // [rsp+E8h] [rbp+30h] BYREF
  va_list va; // [rsp+E8h] [rbp+30h]
  __int64 v15; // [rsp+F0h] [rbp+38h] BYREF
  va_list va1; // [rsp+F0h] [rbp+38h]
  __int64 v17; // [rsp+F8h] [rbp+40h] BYREF
  va_list va2; // [rsp+F8h] [rbp+40h]
  __int64 v19; // [rsp+100h] [rbp+48h] BYREF
  va_list va3; // [rsp+100h] [rbp+48h]
  va_list va4; // [rsp+108h] [rbp+50h] BYREF

  va_start(va4, a5);
  va_start(va3, a5);
  va_start(va2, a5);
  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  v15 = va_arg(va2, _QWORD);
  va_copy(va3, va2);
  v17 = va_arg(va3, _QWORD);
  va_copy(va4, va3);
  v19 = va_arg(va4, _QWORD);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    (pfnWppTraceMessage)(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8),
      43LL,
      a5,
      v7,
      va,
      4LL,
      va1,
      4LL,
      va2,
      4LL,
      va3,
      4LL,
      va4,
      4LL,
      0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 4LL, va1);
}
// 1400096C9: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000001400096E0) ----------------------------------------------------
__int64 __fastcall WPP3Related4(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6,
        __int64 a7,
        __int64 a8,
        __int64 a9)
{
  unsigned int v11; // edi
  unsigned __int64 v12; // r9
  unsigned __int16 v13; // r8
  unsigned __int64 v14; // r9
  unsigned int v15; // ebx
  int v16; // eax
  int v18; // [rsp+28h] [rbp-69h]
  __int64 v19; // [rsp+78h] [rbp-19h] BYREF
  __int64 v20; // [rsp+80h] [rbp-11h] BYREF
  __int64 v21; // [rsp+88h] [rbp-9h] BYREF

  v21 = a7;
  v20 = a8;
  v11 = a4;
  v12 = a3;
  v13 = a3 - 1;
  v14 = v12 >> 16;
  v19 = a9;
  v15 = a2;
  v16 = *(&WPP_GLOBAL_Control->Timer + 20 * v14 + (v13 >> 5) + 1);
  if ( _bittest(&v16, v13 & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v14 + 1) >= a2 )
    (pfnWppTraceMessage)(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v14),
      43LL,
      a5,
      v11,
      &a6,
      4LL,
      &v21,
      8LL,
      &v20,
      8LL,
      &v19,
      8LL,
      0LL);
  LOWORD(v18) = v11;
  return WppAutoLogTrace(a1, v15, a3, a5, v18, &a6, 4LL, &v21);
}
// 140009829: variable 'v18' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000014000984C) ----------------------------------------------------
__int64 WPP3Related5(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, __int64 a5, ...)
{
  unsigned int v7; // edi
  unsigned __int64 v8; // r9
  unsigned int v9; // ebx
  int v10; // eax
  int v12; // [rsp+20h] [rbp-68h]
  __int64 v13; // [rsp+B8h] [rbp+30h] BYREF
  va_list va; // [rsp+B8h] [rbp+30h]
  va_list va1; // [rsp+C0h] [rbp+38h] BYREF

  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  v7 = a4;
  v8 = a3 >> 16;
  v9 = a2;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= a2 )
    (pfnWppTraceMessage)(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8), 43LL, a5, v7, va, 8LL, va1, 8LL, 0LL);
  LOWORD(v12) = v7;
  return WppAutoLogTrace(a1, v9, a3, a5, v12, va, 8LL, va1);
}
// 14000992D: variable 'v12' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140009940) ----------------------------------------------------
__int64 WPP3Related6(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6,
        __int64 a7,
        ...)
{
  unsigned int v9; // edi
  unsigned __int64 v10; // r9
  unsigned __int16 v11; // r8
  unsigned __int64 v12; // r9
  unsigned int v13; // ebx
  int v14; // eax
  int v16; // [rsp+20h] [rbp-98h]
  __int64 v17; // [rsp+60h] [rbp-58h] BYREF
  __int64 v18; // [rsp+68h] [rbp-50h] BYREF
  va_list va; // [rsp+F8h] [rbp+40h] BYREF

  va_start(va, a7);
  v18 = a6;
  v17 = a7;
  v9 = a4;
  v10 = a3;
  v11 = a3 - 1;
  v12 = v10 >> 16;
  v13 = a2;
  v14 = *(&WPP_GLOBAL_Control->Timer + 20 * v12 + (v11 >> 5) + 1);
  if ( _bittest(&v14, v11 & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v12 + 1) >= a2 )
    (pfnWppTraceMessage)(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v12),
      43LL,
      a5,
      v9,
      &v18,
      8LL,
      &v17,
      8LL,
      va,
      8LL,
      0LL);
  LOWORD(v16) = v9;
  return WppAutoLogTrace(a1, v13, a3, a5, v16, &v18, 8LL, &v17);
}
// 140009A66: variable 'v16' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140009A88) ----------------------------------------------------
__int64 WPP3Related7(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        __int64 a6,
        __int64 a7,
        ...)
{
  __int64 v7; // r11
  __int64 v8; // rbx
  const char *v9; // rdi
  unsigned int v10; // r10d
  unsigned __int16 v11; // r8
  unsigned int v12; // r12d
  unsigned int v13; // r15d
  unsigned __int64 v14; // r9
  int v15; // eax
  __int64 v16; // rcx
  __int64 v17; // rcx
  const char *v18; // rax
  int v20; // [rsp+20h] [rbp-A1h]
  unsigned int v21; // [rsp+90h] [rbp-31h]
  __int64 v23; // [rsp+A0h] [rbp-21h] BYREF
  __int64 v24; // [rsp+A8h] [rbp-19h] BYREF
  __int64 v25; // [rsp+148h] [rbp+87h] BYREF
  va_list va; // [rsp+148h] [rbp+87h]
  __int64 v27; // [rsp+150h] [rbp+8Fh] BYREF
  va_list va1; // [rsp+150h] [rbp+8Fh]
  const char *v29; // [rsp+158h] [rbp+97h]
  va_list va2; // [rsp+160h] [rbp+9Fh] BYREF

  va_start(va2, a7);
  va_start(va1, a7);
  va_start(va, a7);
  v25 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  v27 = va_arg(va2, _QWORD);
  v29 = va_arg(va2, const char *);
  v7 = a1;
  v8 = -1LL;
  v9 = v29;
  v10 = a3;
  v24 = a6;
  v11 = a3 - 1;
  v12 = a4;
  v23 = a7;
  v13 = a2;
  v21 = v10;
  v14 = v10 >> 16;
  v15 = *(&WPP_GLOBAL_Control->Timer + 20 * v14 + (v11 >> 5) + 1);
  if ( _bittest(&v15, v11 & 0x1F) )
  {
    if ( *(&WPP_GLOBAL_Control->Timer + 80 * v14 + 1) >= a2 )
    {
      if ( v29 )
      {
        v16 = -1LL;
        do
          ++v16;
        while ( v29[v16] );
        v17 = v16 + 1;
      }
      else
      {
        v17 = 5LL;
      }
      v18 = "NULL";
      if ( v29 )
        v18 = v29;
      (pfnWppTraceMessage)(
        *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v14),
        43LL,
        a5,
        v12,
        &v24,
        8LL,
        &v23,
        8LL,
        va,
        8LL,
        va1,
        8LL,
        v18,
        v17,
        va2,
        4LL,
        0LL);
      v10 = v21;
    }
    v7 = a1;
  }
  if ( v9 )
  {
    do
      ++v8;
    while ( v9[v8] );
  }
  LOWORD(v20) = v12;
  return WppAutoLogTrace(v7, v13, v10, a5, v20, &v24, 8LL, &v23);
}
// 140009C8D: variable 'v20' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140009CB4) ----------------------------------------------------
__int64 WPP3Related8(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        __int64 a5,
        const char *a6,
        ...)
{
  const char *v6; // rsi
  __int64 v8; // rbx
  unsigned int v10; // r14d
  unsigned __int64 v11; // r9
  unsigned int v12; // ebp
  int v13; // eax
  __int64 v14; // rdx
  __int64 v15; // rdx
  const char *v16; // rcx
  __int64 v17; // rbx
  int v19; // [rsp+20h] [rbp-88h]
  va_list va; // [rsp+E0h] [rbp+38h] BYREF

  va_start(va, a6);
  v6 = "NULL";
  v8 = -1LL;
  v10 = a4;
  v11 = a3 >> 16;
  v12 = a2;
  v13 = *(&WPP_GLOBAL_Control->Timer + 20 * v11 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v13, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v11 + 1) >= a2 )
  {
    if ( a6 )
    {
      v14 = -1LL;
      do
        ++v14;
      while ( a6[v14] );
      v15 = v14 + 1;
    }
    else
    {
      v15 = 5LL;
    }
    v16 = "NULL";
    if ( a6 )
      v16 = a6;
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v11), 43LL, a5, v10, v16, v15, va);
  }
  if ( a6 )
  {
    do
      ++v8;
    while ( a6[v8] );
    v17 = v8 + 1;
  }
  else
  {
    v17 = 5LL;
  }
  if ( a6 )
    v6 = a6;
  LOWORD(v19) = v10;
  return WppAutoLogTrace(a1, v12, a3, a5, v19, v6, v17, va);
}
// 140009E23: variable 'v19' is possibly undefined
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140009EA8) ----------------------------------------------------
char __fastcall _GSHandlerCheckCommon(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // rax
  char v4; // dl

  v3 = *(a2 + 8);
  v4 = *(*(*(a2 + 16) + 8LL) + v3 + 3);
  if ( (v4 & 0xF) != 0 )
    LOBYTE(v3) = v4 & 0xF0;
  return v3;
}

//----- (0000000140009F10) ----------------------------------------------------
__int64 FxStubDriverUnloadCommon()
{
  FxStubUnbindClasses(&unk_14000D070);
  return WdfVersionUnbind(&DestinationString, &unk_14000D070, WdfDriverGlobals);
}
// 14000A452: using guessed type __int64 __fastcall WdfVersionUnbind(_QWORD, _QWORD, _QWORD);

//----- (0000000140009F40) ----------------------------------------------------
NTSTATUS __stdcall FxDriverEntry(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)
{
  _security_init_cookie();
  return FxDriverEntryWorker(DriverObject, RegistryPath);
}

//----- (0000000140009F6C) ----------------------------------------------------
NTSTATUS __fastcall FxDriverEntryWorker(_DRIVER_OBJECT *DriverObject, UNICODE_STRING *RegistryPath)
{
  NTSTATUS result; // eax
  int inited; // ebx
  NTSTATUS v6; // eax
  __int64 (*DriverUnload)(void); // rax

  if ( !DriverObject )
    return DriverEntry(0LL, RegistryPath);
  qword_14000D398 = DriverObject;
  *&DestinationString.Length = 34078720;
  DestinationString.Buffer = &unk_14000D160;
  RtlCopyUnicodeString(&DestinationString, RegistryPath);
  result = WdfVersionBind(DriverObject, &DestinationString, &unk_14000D070, &WdfDriverGlobals);
  if ( result >= 0 )
  {
    WdfDriverMiniportUnloadOverride = *(WdfFunctions_01015[0] + 0xC9);
    inited = FxStubBindClasses(&unk_14000D070);
    if ( inited < 0 )
      goto LABEL_8;
    inited = FxStubInitTypes();
    if ( inited < 0 )
      goto LABEL_8;
    v6 = DriverEntry(DriverObject, RegistryPath);
    inited = v6;
    if ( v6 < 0 )
    {
      DbgPrintEx(0x4Du, 0, "DriverEntry failed 0x%x for driver %wZ\n", v6, &DestinationString);
LABEL_8:
      FxStubDriverUnloadCommon();
      return inited;
    }
    if ( WdfDriverGlobals->DisplaceDriverUnload )
    {
      DriverUnload = qword_14000D3A0;
      if ( DriverObject->DriverUnload )
        DriverUnload = DriverObject->DriverUnload;
      qword_14000D3A0 = DriverUnload;
      DriverObject->DriverUnload = FxStubDriverUnload;
    }
    else if ( (WdfDriverGlobals->DriverFlags & 2) != 0 )
    {
      WdfDriverMiniportUnloadOverride = j_FxStubDriverUnloadCommon;
    }
    return 0;
  }
  return result;
}
// 14000A44C: using guessed type __int64 __fastcall WdfVersionBind(_QWORD, _QWORD, _QWORD, _QWORD);
// 14000D368: using guessed type __int64 WdfDriverMiniportUnloadOverride;
// 14000D398: using guessed type __int64 qword_14000D398;
// 14000D3A0: using guessed type __int64 (*qword_14000D3A0)(void);

//----- (000000014000A0C0) ----------------------------------------------------
__int64 j_FxStubDriverUnloadCommon()
{
  return FxStubDriverUnloadCommon();
}

//----- (000000014000A0D0) ----------------------------------------------------
__int64 FxStubDriverUnload()
{
  if ( qword_14000D3A0 && qword_14000D3A0 != FxStubDriverUnload )
    qword_14000D3A0();
  return FxStubDriverUnloadCommon();
}
// 14000D3A0: using guessed type __int64 (*qword_14000D3A0)(void);

//----- (000000014000A100) ----------------------------------------------------
__int64 FxStubInitTypes()
{
  char *i; // rbx
  __int64 (*v2)(void); // rax

  if ( &unk_14000D0C0 <= byte_14000D0D0 )
  {
    for ( i = byte_14000D0D0; ; i += 40 )
    {
      if ( i >= byte_14000D0D0 )
        return 0LL;
      if ( *i != 40 )
        break;
      v2 = *(i + 4);
      if ( v2 )
        *(i + 3) = v2();
    }
    DbgPrintEx(
      0x4Du,
      0,
      "FxStubInitTypes: WDF_OBJECT_CONTEXT_TYPE_INFO 0x%p, size 0x%x incorrect, expected 0x%x, status 0x%x\n",
      i,
      *i,
      40,
      -1073741820);
    return 3221225476LL;
  }
  else
  {
    DbgPrintEx(
      0x4Du,
      0,
      "FxStubInitTypes: invalid driver image, the address of symbol __KMDF_TYPE_INIT_START 0x%p is greater than the addre"
      "ss of symbol __KMDF_TYPE_INIT_END 0x%p, status 0x%x\n",
      &unk_14000D0C0,
      byte_14000D0D0,
      -1073741701);
    return 3221225595LL;
  }
}

//----- (000000014000A1B8) ----------------------------------------------------
__int64 __fastcall FxStubBindClasses(__int64 a1)
{
  unsigned int v1; // edi
  char *v4; // rbx
  bool i; // cf
  char *v6; // rsi
  __int64 (__fastcall *v7)(__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD), __int64, PWDF_DRIVER_GLOBALS, char *); // rax
  int v8; // eax
  const wchar_t *v9; // rcx

  v1 = 0;
  if ( &unk_14000D0A0 <= byte_14000D0B0 )
  {
    v4 = byte_14000D0B0;
    for ( i = 0; ; i = v6 < byte_14000D0B0 )
    {
      if ( !i )
        return v1;
      if ( v4 + 4 > byte_14000D0B0 )
      {
        DbgPrintEx(
          0x4Du,
          0,
          "FxStubBindClasses: invalid driver image.\nNot enough space for WDF_CLASS_BIND_INFO.Size field.\n");
        return 3221225595LL;
      }
      if ( *v4 != 80 )
      {
        v9 = L"(null)";
        v1 = -1073741820;
        if ( *(v4 + 1) )
          v9 = *(v4 + 1);
        DbgPrintEx(
          0x4Du,
          0,
          "FxStubBindClasses: WDF_CLASS_BIND_INFO 0x%p, class %S, size 0x%x incorrect, expected 0x%Ix, status 0x%x\n",
          v4,
          v9,
          *v4,
          80LL,
          -1073741820);
        return v1;
      }
      v6 = v4 + 80;
      if ( v4 + 80 > byte_14000D0B0 )
        break;
      v7 = *(v4 + 7);
      off_14000D0B8 = v4;
      if ( v7 )
      {
        v8 = v7(WdfVersionBindClass, a1, WdfDriverGlobals, v4);
        v1 = v8;
        if ( v8 < 0 )
        {
          DbgPrintEx(
            0x4Du,
            0,
            "FxStubBindClasses: ClientBindClass %p, WDF_CLASS_BIND_INFO 0x%p, class %S, returned status 0x%x\n",
            *(v4 + 7),
            v4,
            *(v4 + 1),
            v8);
          return v1;
        }
      }
      else
      {
        v1 = WdfVersionBindClass(a1, WdfDriverGlobals, v4);
        if ( (v1 & 0x80000000) != 0 )
        {
          DbgPrintEx(
            0x4Du,
            0,
            "FxStubBindClasses: VersionBindClass WDF_CLASS_BIND_INFO 0x%p, class %S, returned status 0x%x\n",
            v4,
            *(v4 + 1),
            v1);
          return v1;
        }
      }
      v4 += 80;
    }
    DbgPrintEx(0x4Du, 0, "FxStubBindClasses: invalid driver image.\nNot enough space for WDF_CLASS_BIND_INFO.\n");
  }
  else
  {
    DbgPrintEx(
      0x4Du,
      0,
      "FxStubBindClasses: invalid driver image, the address of symbol __KMDF_CLASS_BIND_START 0x%p is greater than the ad"
      "dress of symbol __KMDF_CLASS_BIND_END 0x%p, status 0x%x\n",
      &unk_14000D0A0,
      byte_14000D0B0,
      -1073741701);
  }
  return 3221225595LL;
}
// 14000A460: using guessed type __int64 __fastcall WdfVersionBindClass(_QWORD, _QWORD, _QWORD);
// 14000B560: using guessed type wchar_t aNull_0[7];
// 14000D0B8: using guessed type _UNKNOWN *off_14000D0B8;

//----- (000000014000A388) ----------------------------------------------------
void *__fastcall FxStubUnbindClasses(__int64 a1)
{
  void *result; // rax
  char *v2; // rbx
  __int64 (__fastcall *v4)(__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD), __int64, PWDF_DRIVER_GLOBALS, char *); // rax

  result = off_14000D0B8;
  v2 = byte_14000D0B0;
  if ( off_14000D0B8 != &unk_14000D0A0 && byte_14000D0B0 <= off_14000D0B8 )
  {
    do
    {
      v4 = *(v2 + 8);
      if ( v4 )
        result = v4(WdfVersionUnbindClass, a1, WdfDriverGlobals, v2);
      else
        result = WdfVersionUnbindClass(a1, WdfDriverGlobals, v2);
      v2 += 80;
    }
    while ( v2 <= off_14000D0B8 );
  }
  return result;
}
// 14000A470: using guessed type __int64 __fastcall WdfVersionUnbindClass(_QWORD, _QWORD, _QWORD);
// 14000D0B8: using guessed type _UNKNOWN *off_14000D0B8;

//----- (000000014000A4C0) ----------------------------------------------------
void *__cdecl memset(void *Dst, int Val, size_t Size)
{
  void *result; // rax
  __int64 v4; // rdx
  size_t v5; // r9
  char *v6; // rcx
  size_t v7; // r8
  __m128 v8; // xmm0
  char *v9; // r8
  __m128 *v10; // rcx
  unsigned __int64 v11; // r8
  unsigned __int64 v12; // r9
  unsigned __int64 i; // r9
  __int64 v14; // r8

  result = Dst;
  if ( Size < 8 )
  {
    for ( ; Size; --Size )
      *(Dst + Size - 1) = Val;
  }
  else
  {
    v4 = 0x101010101010101LL * Val;
    if ( Size >= 0x4F )
    {
      v8 = _mm_movelh_ps(v4, v4);
      *Dst = v8;
      v9 = Dst + Size;
      v10 = ((Dst + 16) & 0xFFFFFFFFFFFFFFF0uLL);
      v11 = v9 - v10;
      v12 = v11 >> 7;
      if ( v11 >> 7 )
      {
        do
        {
          *v10 = v8;
          v10[1] = v8;
          v10 += 8;
          v10[-6] = v8;
          v10[-5] = v8;
          --v12;
          v10[-4] = v8;
          v10[-3] = v8;
          v10[-2] = v8;
          v10[-1] = v8;
        }
        while ( v12 );
        v11 &= 0x7Fu;
      }
      for ( i = v11 >> 4; i; --i )
        *v10++ = v8;
      v14 = v11 & 0xF;
      if ( v14 )
        *(v10 + v14 - 16) = v8;
    }
    else
    {
      v5 = Size & 0x78;
      v6 = Dst + (Size & 0xFFFFFFFFFFFFFFF8uLL);
      do
      {
        *(result + v5 - 8) = v4;
        v5 -= 8LL;
      }
      while ( v5 );
      v7 = Size & 7;
      if ( v7 )
        *&v6[v7 - 8] = v4;
    }
  }
  return result;
}
// 14000A4E3: mask 0xFFFFFFFFFFFFFFF8 is shortened because r8.8 <= 0x4E
// 14000A510: masking with 0x7 was optimized away because r8.8 <= 0x7

//----- (000000014000A5C0) ----------------------------------------------------
void *__cdecl memmove(void *Dst, const void *Src, size_t MaxCount)
{
  void *result; // rax
  __int64 v4; // r11
  __int64 v5; // rdx
  __int128 v6; // xmm1
  bool v7; // cf
  signed __int64 v8; // rdx
  char v9; // r11
  _BYTE *v10; // rcx
  char v11; // r11
  char *v12; // r11
  signed __int64 v13; // rdx
  __m128 v14; // xmm0
  unsigned __int64 v15; // rcx
  unsigned __int64 v16; // rcx
  __m128 v17; // xmm1
  unsigned __int64 v18; // r8
  unsigned __int64 v19; // r9
  __int128 v20; // xmm1
  __int128 v21; // xmm2
  __int128 v22; // xmm3
  __m128 v23; // xmm4
  unsigned __int64 j; // r9
  unsigned __int64 v25; // r8
  unsigned __int64 v26; // r9
  __m128 v27; // xmm1
  __m128 v28; // xmm2
  __m128 v29; // xmm3
  __m128 v30; // xmm4
  char *v31; // rcx
  __int128 v32; // xmm0
  unsigned __int64 v33; // rcx
  size_t v34; // r8
  _OWORD *v35; // r11
  __int128 v36; // xmm1
  size_t v37; // r9
  __int128 v38; // xmm1
  __int128 v39; // xmm2
  __int128 v40; // xmm3
  __int128 v41; // xmm4
  size_t i; // r9
  size_t v43; // r8

  result = Dst;
  if ( MaxCount < 8 )
  {
    if ( MaxCount )
    {
      v7 = Src < Dst;
      v8 = Src - Dst;
      if ( v7 )
      {
        v10 = Dst + MaxCount;
        do
        {
          v11 = v10[v8 - 1];
          --v10;
          --MaxCount;
          *v10 = v11;
        }
        while ( MaxCount );
      }
      else
      {
        do
        {
          v9 = *(Dst + v8);
          Dst = Dst + 1;
          --MaxCount;
          *(Dst - 1) = v9;
        }
        while ( MaxCount );
      }
    }
  }
  else if ( MaxCount > 0x10 )
  {
    if ( MaxCount > 0x20 )
    {
      v12 = Src + MaxCount;
      v7 = Src < Dst;
      v13 = Src - Dst;
      if ( v7 && v12 > Dst )
      {
        v31 = Dst + MaxCount;
        v32 = *&v31[v13 - 16];
        v33 = (v31 - 16);
        v34 = MaxCount - 16;
        if ( (v33 & 0xF) != 0 )
        {
          v35 = v33;
          v33 &= 0xFFFFFFFFFFFFFFF0uLL;
          v36 = *(v33 + v13);
          *v35 = v32;
          v32 = v36;
          v34 = v33 - result;
        }
        v37 = v34 >> 6;
        if ( v34 >> 6 )
        {
          v34 &= 0x3Fu;
          do
          {
            v38 = *(v33 + v13 - 16);
            v39 = *(v33 + v13 - 32);
            v40 = *(v33 + v13 - 48);
            v41 = *(v33 + v13 - 64);
            *v33 = v32;
            v33 -= 64LL;
            --v37;
            *(v33 + 48) = v38;
            *(v33 + 32) = v39;
            *(v33 + 16) = v40;
            v32 = v41;
          }
          while ( v37 );
        }
        for ( i = v34 >> 4; i; --i )
        {
          *v33 = v32;
          v32 = *(v33 + v13 - 16);
          v33 -= 16LL;
        }
        v43 = v34 & 0xF;
        if ( v43 )
          *(v33 - v43) = *(v33 - v43 + v13);
        *v33 = v32;
      }
      else
      {
        v14 = *(Dst + v13);
        v15 = Dst + 16;
        if ( (v15 & 0xF) != 0 )
        {
          v16 = v15 & 0xFFFFFFFFFFFFFFF0uLL;
          v17 = *(v16 + v13);
          *result = v14;
          v14 = v17;
          v15 = v16 + 16;
        }
        v18 = result + MaxCount - v15;
        v19 = v18 >> 6;
        if ( v18 >> 6 )
        {
          if ( v19 > 0x1000 )
          {
            v26 = v18 >> 6;
            v18 &= 0x3Fu;
            _mm_prefetch((v15 + v13 + 64), 0);
            do
            {
              v27 = *(v15 + v13);
              v28 = *(v15 + v13 + 16);
              v29 = *(v15 + v13 + 32);
              v30 = *(v15 + v13 + 48);
              _mm_stream_ps((v15 - 16), v14);
              v15 += 64LL;
              _mm_prefetch((v15 + v13 + 64), 0);
              --v26;
              _mm_stream_ps((v15 - 64), v27);
              _mm_stream_ps((v15 - 48), v28);
              _mm_stream_ps((v15 - 32), v29);
              v14 = v30;
            }
            while ( v26 );
            _mm_sfence();
          }
          else
          {
            v18 &= 0x3Fu;
            do
            {
              v20 = *(v15 + v13);
              v21 = *(v15 + v13 + 16);
              v22 = *(v15 + v13 + 32);
              v23 = *(v15 + v13 + 48);
              *(v15 - 16) = v14;
              v15 += 64LL;
              --v19;
              *(v15 - 64) = v20;
              *(v15 - 48) = v21;
              *(v15 - 32) = v22;
              v14 = v23;
            }
            while ( v19 );
          }
        }
        for ( j = v18 >> 4; j; --j )
        {
          *(v15 - 16) = v14;
          v14 = *(v15 + v13);
          v15 += 16LL;
        }
        v25 = v18 & 0xF;
        if ( v25 )
          *(v15 + v25 - 16) = *(v15 + v25 - 16 + v13);
        *(v15 - 16) = v14;
      }
    }
    else
    {
      v6 = *(Src + MaxCount - 16);
      *Dst = *Src;
      *(Dst + MaxCount - 16) = v6;
    }
  }
  else
  {
    v4 = *Src;
    v5 = *(Src + MaxCount - 8);
    *Dst = v4;
    *(Dst + MaxCount - 8) = v5;
  }
  return result;
}

//----- (000000014000F000) ----------------------------------------------------
void __fastcall EvtDriverContextCleanup(__int64 a1)
{
  __int64 v2; // rax

  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x14u, &traceGuid);
    if ( off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 4u, 0x15u, &traceGuid);
  }
  v2 = (*(WdfFunctions_01015[0] + 118))(WdfDriverGlobals, a1);
  WppCleanupKm(v2);
}
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (000000014000F0C0) ----------------------------------------------------
__int64 __fastcall EvtDeviceAdd(__int64 a1, __int64 a2)
{
  int Device; // eax
  unsigned int v4; // ebx
  __int64 v6; // [rsp+28h] [rbp-10h]
  int v7; // [rsp+28h] [rbp-10h]

  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x11u, &traceGuid);
  Device = CreateDevice(a2);
  v4 = Device;
  if ( Device < 0 )
  {
    if ( off_14000D008 == &off_14000D008 )
      return v4;
    _mm_lfence();
    v7 = Device;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 4u, 0x12u, &traceGuid, v7);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v6) = v4;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x13u, &traceGuid, v6);
  }
  return v4;
}
// 14000F183: variable 'v6' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (000000014000F1A0) ----------------------------------------------------
void __fastcall WppCleanupKm(__int64 a1)
{
  PDEVICE_OBJECT v1; // rbx

  v1 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != &WPP_GLOBAL_Control )
  {
    if ( WPPTraceSuite == 4 )
    {
      while ( v1 )
      {
        if ( v1->Vpb )
        {
          (pfnEtwUnregister)();
          v1->Vpb = 0LL;
        }
        v1 = v1->NextDevice;
      }
    }
    else if ( WPPTraceSuite == 2 )
    {
      IoWMIRegistrationControl(WPP_GLOBAL_Control, 0x80000002);
    }
    WppAutoLogStop(WPP_GLOBAL_Control, a1);
    WPP_GLOBAL_Control = &WPP_GLOBAL_Control;
    off_14000D008 = &off_14000D008;
  }
}
// 14000A440: using guessed type __int64 __fastcall WppAutoLogStop(_QWORD, _QWORD);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D0F0: using guessed type __int64 pfnEtwUnregister;
// 14000D108: using guessed type int WPPTraceSuite;

//----- (000000014000F240) ----------------------------------------------------
void __fastcall WppInitKm(__int64 a1, __int64 a2)
{
  _UNKNOWN **v4; // rbx

  if ( WPP_GLOBAL_Control != &WPP_MAIN_CB )
  {
    WPP_GLOBAL_Control = &WPP_MAIN_CB;
    if ( WPPTraceSuite == 4 )
    {
      v4 = &WPP_MAIN_CB;
      do
      {
        v4[7] = 0LL;
        (pfnEtwRegisterClassicProvider)(v4[1], 0LL, WppClassicProviderCallback, v4, v4 + 7);
        v4 = v4[2];
      }
      while ( v4 );
    }
    else if ( WPPTraceSuite == 2 )
    {
      WPP_MAIN_CB = WppTraceCallback;
      IoWMIRegistrationControl(&WPP_MAIN_CB, 0x80010001);
    }
    WppAutoLogStart(WPP_GLOBAL_Control, a1, a2);
    off_14000D008 = &WPP_MAIN_CB;
  }
}
// 14000A43A: using guessed type __int64 __fastcall WppAutoLogStart(_QWORD, _QWORD, _QWORD);
// 14000D008: using guessed type _UNKNOWN *off_14000D008;
// 14000D0F8: using guessed type __int64 pfnEtwRegisterClassicProvider;
// 14000D108: using guessed type int WPPTraceSuite;

//----- (000000014000F308) ----------------------------------------------------
PVOID WppLoadTracingSupport()
{
  PVOID result; // rax
  unsigned int v1; // [rsp+30h] [rbp-20h] BYREF
  struct _UNICODE_STRING DestinationString; // [rsp+38h] [rbp-18h] BYREF

  v1 = 0;
  RtlInitUnicodeString(&DestinationString, L"PsGetVersion");
  pfnWppGetVersion = MmGetSystemRoutineAddress(&DestinationString);
  RtlInitUnicodeString(&DestinationString, L"WmiTraceMessage");
  pfnWppTraceMessage = MmGetSystemRoutineAddress(&DestinationString);
  RtlInitUnicodeString(&DestinationString, L"WmiQueryTraceInformation");
  pfnWppQueryTraceInformation = MmGetSystemRoutineAddress(&DestinationString);
  result = pfnWppGetVersion;
  WPPTraceSuite = 2;
  if ( pfnWppGetVersion )
    result = pfnWppGetVersion(&v1, 0LL, 0LL, 0LL);
  if ( v1 >= 6 )
  {
    RtlInitUnicodeString(&DestinationString, L"EtwRegisterClassicProvider");
    result = MmGetSystemRoutineAddress(&DestinationString);
    pfnEtwRegisterClassicProvider = result;
    if ( result )
    {
      RtlInitUnicodeString(&DestinationString, L"EtwUnregister");
      result = MmGetSystemRoutineAddress(&DestinationString);
      pfnEtwUnregister = result;
      WPPTraceSuite = 4;
    }
  }
  return result;
}
// 14000D0E0: using guessed type __int64 pfnWppQueryTraceInformation;
// 14000D0E8: using guessed type __int64 (__fastcall *pfnWppTraceMessage)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 14000D0F0: using guessed type __int64 pfnEtwUnregister;
// 14000D0F8: using guessed type __int64 pfnEtwRegisterClassicProvider;
// 14000D100: using guessed type __int64 (__fastcall *pfnWppGetVersion)(_QWORD, _QWORD, _QWORD, _QWORD);
// 14000D108: using guessed type int WPPTraceSuite;

//----- (000000014000F420) ----------------------------------------------------
__int64 __fastcall WppTraceCallback(
        unsigned __int8 a1,
        __int64 a2,
        unsigned int a3,
        unsigned int *a4,
        __int64 a5,
        unsigned int *a6)
{
  unsigned int v6; // ebx
  __int64 v7; // rdi
  const void **v9; // r15
  unsigned int v10; // ebp
  __int64 v11; // rax
  unsigned int v12; // r14d
  unsigned int v13; // r12d
  _WORD *v14; // rcx
  unsigned int *v15; // rsi
  __int64 v16; // rcx
  __int128 v17; // xmm0
  _DWORD *v18; // rdx
  __int64 v19; // rax
  _BYTE v21[4]; // [rsp+38h] [rbp-50h] BYREF
  _BYTE v22[4]; // [rsp+3Ch] [rbp-4Ch] BYREF

  v6 = 0;
  v7 = a5;
  *a6 = 0;
  if ( a1 <= 3u )
    return -1073741808;
  if ( a1 > 5u )
  {
    if ( a1 <= 7u )
      return v6;
    if ( a1 == 8 )
    {
      v9 = *(a5 + 32);
      v10 = 0;
      v11 = a5;
      do
      {
        v11 = *(v11 + 16);
        ++v10;
      }
      while ( v11 );
      if ( v10 > 0x3F )
        return -1073741811;
      v12 = 32 * v10 + 24;
      if ( v9 )
      {
        v13 = 32 * v10 + 24;
        v12 += *v9 + 2;
      }
      else
      {
        v13 = 0;
      }
      if ( v12 > a3 )
      {
        v6 = -1073741789;
        if ( a3 >= 4 )
        {
          *a4 = v12;
          *a6 = 4;
        }
      }
      else
      {
        memset(a4, 0, a3);
        *a4 = v12;
        a4[2] = v13;
        a4[4] = v10;
        if ( v9 )
        {
          v14 = (a4 + v13);
          *v14 = *v9;
          memmove(v14 + 1, v9[1], *v9);
        }
        if ( v10 )
        {
          v15 = a4 + 10;
          v16 = v10;
          do
          {
            v17 = **(v7 + 8);
            *v15 = 528384;
            v15 += 8;
            *(v15 - 3) = v17;
            *(v7 + 41) = 0;
            *(v7 + 44) = 0;
            v7 = *(v7 + 16);
            --v16;
          }
          while ( v16 );
        }
        *a6 = v12;
      }
      return v6;
    }
    return -1073741808;
  }
  if ( !a5 )
    return -1073741163;
  if ( a3 < 0x30 )
    return -1073741811;
  do
  {
    v18 = *(v7 + 8);
    if ( *v18 == a4[6] && v18[1] == a4[7] && v18[2] == a4[8] && v18[3] == a4[9] )
      break;
    v7 = *(v7 + 16);
  }
  while ( v7 );
  if ( !v7 )
    return -1073741163;
  if ( a1 == 5 )
  {
    *(v7 + 44) = 0;
    *(v7 + 24) = 0LL;
    *(v7 + 41) = 0;
  }
  else
  {
    v19 = *(a4 + 1);
    *(v7 + 24) = v19;
    if ( WPPTraceSuite == 2 )
    {
      if ( !(pfnWppQueryTraceInformation)(3LL, v21, 4LL, v22, a4) )
        *(v7 + 41) = v21[0];
      return (pfnWppQueryTraceInformation)(2LL, v7 + 44, 4LL, v22, a4);
    }
    else
    {
      *(v7 + 44) = HIDWORD(v19);
      *(v7 + 41) = BYTE2(v19);
    }
  }
  return v6;
}
// 14000D0E0: using guessed type __int64 pfnWppQueryTraceInformation;
// 14000D108: using guessed type int WPPTraceSuite;

//----- (0000000140010000) ----------------------------------------------------
NTSTATUS __stdcall DriverEntry(_DRIVER_OBJECT *DriverObject, PUNICODE_STRING RegistryPath)
{
  int v4; // eax
  NTSTATUS v5; // ebx
  __int64 v7; // [rsp+28h] [rbp-41h]
  _QWORD DriverAttributes[4]; // [rsp+40h] [rbp-29h] BYREF
  __int128 v9; // [rsp+60h] [rbp-9h]
  __int64 v10; // [rsp+70h] [rbp+7h]
  _QWORD DriverConfig[2]; // [rsp+78h] [rbp+Fh] BYREF
  __int128 v12; // [rsp+88h] [rbp+1Fh]

  _KMDF_TYPE_INIT_END = 1LL;
  WPP_MAIN_CB = 0LL;
  unk_14000D118 = &WPP_ThisDir_CTLGUID_UnknownTraceGuid;
  unk_14000D120 = 0LL;
  unk_14000D130 = 0LL;
  unk_14000D150 = 0LL;
  unk_14000D158 = 0;
  WppLoadTracingSupport();
  unk_14000D130 = 0LL;
  WppInitKm(DriverObject, RegistryPath);
  if ( off_14000D008 != &off_14000D008 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0xAu, &traceGuid);
    if ( off_14000D008 != &off_14000D008 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 4u, 0xEu, &traceGuid);
  }
  DriverConfig[0] = 32LL;
  v10 = 0LL;
  DriverAttributes[0] = 56LL;
  DriverAttributes[1] = EvtDriverContextCleanup;
  DriverAttributes[2] = 0LL;
  DriverAttributes[3] = 0x100000001LL;
  DriverConfig[1] = EvtDeviceAdd;
  v9 = 0LL;
  v12 = 0LL;
  v4 = (*(WdfFunctions_01015[0] + 116))(
         WdfDriverGlobals,
         DriverObject,
         RegistryPath,
         DriverAttributes,
         DriverConfig,
         0LL);
  v5 = v4;
  if ( v4 < 0 )
  {
    _mm_lfence();
    if ( off_14000D008 != &off_14000D008 )
    {
      LODWORD(v7) = v4;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 4u, 0xFu, &traceGuid, v7);
    }
    WppCleanupKm(DriverObject);
  }
  if ( off_14000D008 != &off_14000D008 && LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v7) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x10u, &traceGuid, v7);
  }
  return v5;
}
// 140010199: variable 'v7' is possibly undefined
// 14000D008: using guessed type _UNKNOWN *off_14000D008;

//----- (0000000140010200) ----------------------------------------------------
void __cdecl _security_init_cookie()
{
  if ( !_security_cookie || _security_cookie == 0x2B992DDFA232LL )
    __fastfail(6u);
  security_cookie_complement = ~_security_cookie;
}
// 14000D068: using guessed type __int64 security_cookie_complement;

// nfuncs=95 queued=73 decompiled=73 lumina nreq=0 worse=0 better=0
// ALL OK, 73 function(s) have been successfully decompiled
