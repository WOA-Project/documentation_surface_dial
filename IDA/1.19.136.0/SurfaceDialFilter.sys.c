/* This file was generated by the Hex-Rays decompiler version 9.0.0.240807.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>



//----- (0000000140001000) ----------------------------------------------------
const wchar_t *__fastcall WPP2RelatedMacro(char a1, const char *a2, int a3, const wchar_t *a4)
{
  const wchar_t *result; // rax
  __int64 v5; // [rsp+30h] [rbp-18h]

  result = a4;
  if ( !a1 )
  {
    LODWORD(v5) = a3;
    return WPP2Related(WPP_GLOBAL_Control->DeviceExtension, 2u, 1u, 0xAu, &WPP2TraceGuidRelated, a2, v5, a4);
  }
  return result;
}
// 14000103C: variable 'v5' is possibly undefined
// 14000A150: using guessed type _GUID WPP2TraceGuidRelated;

//----- (0000000140001048) ----------------------------------------------------
__int64 __fastcall WPP2Related(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        const char *a6,
        __int64 a7,
        const wchar_t *a8)
{
  const char *v8; // r14
  const wchar_t *v10; // rdi
  unsigned int v12; // r10d
  __int64 v13; // rbx
  unsigned __int64 v14; // r9
  int v15; // eax
  __int64 v16; // rdx
  __int64 v17; // rdx
  __int64 v18; // r8
  __int64 v19; // r8
  __int64 v20; // rdx
  const wchar_t *v21; // rax
  const char *v22; // rcx
  __int64 v23; // rax
  __int64 v24; // rbx
  int v26; // [rsp+20h] [rbp-98h]

  v8 = "NULL";
  v10 = a8;
  v12 = a3;
  v13 = -1LL;
  v14 = a3 >> 16;
  v15 = *(&WPP_GLOBAL_Control->Timer + 20 * v14 + ((a3 - 1) >> 5) + 1);
  v16 = 5LL;
  if ( _bittest(&v15, (a3 - 1) & 0x1F) )
  {
    if ( *(&WPP_GLOBAL_Control->Timer + 80 * v14 + 1) >= a2 )
    {
      if ( a8 )
      {
        v17 = -1LL;
        do
          ++v17;
        while ( a8[v17] );
        v16 = v17 + 1;
      }
      if ( a6 )
      {
        v18 = -1LL;
        do
          ++v18;
        while ( a6[v18] );
        v19 = v18 + 1;
      }
      else
      {
        v19 = 5LL;
      }
      v20 = 2 * v16;
      v21 = L"NULL";
      v22 = "NULL";
      if ( a8 )
        v21 = a8;
      if ( a6 )
        v22 = a6;
      pfnWppTraceMessage(
        *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v14),
        0x2Bu,
        a5,
        a4,
        v22,
        v19,
        &a7,
        4LL,
        v21,
        v20,
        0LL);
    }
    v12 = a3;
  }
  if ( v10 )
  {
    v23 = -1LL;
    do
      ++v23;
    while ( v10[v23] );
  }
  if ( a6 )
  {
    do
      ++v13;
    while ( a6[v13] );
    v24 = v13 + 1;
  }
  else
  {
    v24 = 5LL;
  }
  if ( a6 )
    v8 = a6;
  LOWORD(v26) = a4;
  return WppAutoLogTrace(a1, a2, v12, a5, v26, v8, v24);
}
// 14000120C: variable 'v26' is possibly undefined
// 140009180: using guessed type wchar_t aNull[5];

//----- (0000000140001224) ----------------------------------------------------
void __fastcall FreeHidPDeviceDesc(struct _HIDP_DEVICE_DESC *Dst)
{
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xEu, &WPPTraceGuidRelated3);
  HidP_FreeCollectionDescription(Dst);
  memset(Dst, 0, sizeof(struct _HIDP_DEVICE_DESC));
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xFu, &WPPTraceGuidRelated3);
}

//----- (00000001400012AC) ----------------------------------------------------
__int64 __fastcall FillNewSurfaceDialHidDeviceDescriptorWithSizeData(
        __int16 XPhysicalMax,
        __int16 XLogicalMax,
        __int16 YPhysicalMax,
        __int16 YLogicalMax,
        PHIDP_DEVICE_DESC DeviceDescription)
{
  NTSTATUS status; // eax
  unsigned int status2; // ebx
  __int64 v12; // [rsp+28h] [rbp-D8h]
  UCHAR ReportDesc[277]; // [rsp+30h] [rbp-D0h] BYREF

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xAu, &WPPTraceGuidRelated3);
  *&ReportDesc[80] = XPhysicalMax;
  *&ReportDesc[83] = XLogicalMax;
  *&ReportDesc[92] = YPhysicalMax;
  *&ReportDesc[95] = YLogicalMax;
  *ReportDesc = 0xE090105;
  *&ReportDesc[4] = 0x18501A1;
  *&ReportDesc[8] = 0x21090D05;
  *&ReportDesc[12] = 0x1502A1;
  *&ReportDesc[16] = 0x1750125;
  *&ReportDesc[20] = 0xA10195;
  *&ReportDesc[24] = 0x1090905;
  *&ReportDesc[28] = 0xD050281;
  *&ReportDesc[32] = 0x2813309;
  *&ReportDesc[36] = 0x3810695;
  *&ReportDesc[40] = 0x10502A1;
  *&ReportDesc[44] = 0x1163709;
  *&ReportDesc[48] = 0x7FFF2680;
  *&ReportDesc[52] = 0x1951075;
  *&ReportDesc[56] = 0x350681;
  *&ReportDesc[60] = 0x150E1046;
  *&ReportDesc[64] = 0xE102600;
  *&ReportDesc[68] = 0x2B14809;
  *&ReportDesc[72] = 0x55C00045;
  *&ReportDesc[76] = 0x4611650E;
  ReportDesc[82] = 38;
  *&ReportDesc[85] = 0x42813009;
  qmemcpy(&ReportDesc[89], "\t1F", 3);
  ReportDesc[94] = 38;
  *&ReportDesc[97] = 218448513;
  *&ReportDesc[101] = 974473225;
  *&ReportDesc[105] = 141900325;
  *&ReportDesc[109] = 976555861;
  *&ReportDesc[113] = 58800709;
  *&ReportDesc[117] = 6619221;
  *&ReportDesc[121] = 4522037;
  *&ReportDesc[125] = 17370629;
  *&ReportDesc[129] = 1376929;
  *&ReportDesc[133] = 151060262;
  *&ReportDesc[137] = 155365668;
  *&ReportDesc[141] = 356684068;
  *&ReportDesc[145] = 151463169;
  *&ReportDesc[149] = 155365664;
  *&ReportDesc[153] = 625119521;
  *&ReportDesc[157] = 0xB128090A;
  *&ReportDesc[161] = 638612802;
  *&ReportDesc[165] = 621348816;
  *&ReportDesc[169] = 621363889;
  *&ReportDesc[173] = 42287761;
  *&ReportDesc[177] = 924262517;
  *&ReportDesc[181] = 654311680;
  *&ReportDesc[185] = 65591;
  *&ReportDesc[189] = 45163017;
  *&ReportDesc[193] = 44110089;
  *&ReportDesc[197] = 60099077;
  *&ReportDesc[201] = 67699465;
  *&ReportDesc[205] = 141886729;
  *&ReportDesc[209] = 0xFF250015;
  *&ReportDesc[213] = 96469681;
  *&ReportDesc[217] = 0xA110090E;
  *&ReportDesc[221] = 0x950A0502;
  *&ReportDesc[225] = 620958977;
  *&ReportDesc[229] = 268645891;
  *&ReportDesc[233] = 152044358;
  *&ReportDesc[237] = 352497923;
  *&ReportDesc[241] = 906241284;
  *&ReportDesc[245] = 71700484;
  *&ReportDesc[249] = 0xB1040910;
  *&ReportDesc[253] = 621090050;
  *&ReportDesc[257] = 268711429;
  *&ReportDesc[261] = 152044614;
  *&ReportDesc[265] = 889368837;
  *&ReportDesc[269] = 0xC0004500;
  *&ReportDesc[273] = 0xC0C0C0C0;
  status = HidP_GetCollectionDescription(ReportDesc, 0x115u, NonPagedPool, DeviceDescription);
  status2 = status;
  if ( status >= 0 )
  {
    if ( DeviceDescription->Dbg.ErrorCode )
    {
      WPP_SF_D(
        WPP_GLOBAL_Control->DeviceExtension,
        2u,
        2u,
        0xCu,
        &WPPTraceGuidRelated3,
        DeviceDescription->Dbg.ErrorCode);
      status2 = 0xC0000001;
      FreeHidPDeviceDesc(DeviceDescription);
    }
  }
  else
  {
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 2u, 0xBu, &WPPTraceGuidRelated3, status);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v12) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 2u, 0xDu, &WPPTraceGuidRelated3, v12);
  }
  return status2;
}
// 1400015F5: variable 'v12' is possibly undefined

//----- (000000014000161C) ----------------------------------------------------
void __fastcall WPP_RECORDER_SF_(
        void *AutoLogContext,
        unsigned __int8 level,
        unsigned int flags,
        unsigned __int16 id,
        const _GUID *traceGuid)
{
  unsigned __int64 v8; // rdi
  int v10; // eax
  int v11; // [rsp+20h] [rbp-28h]
  __int64 v12; // [rsp+30h] [rbp-18h]

  v8 = flags >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v8 + (((flags - 1) >> 5) & 0x7FF) + 1);
  if ( _bittest(&v10, (flags - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v8 + 1) >= level )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v8), 0x2Bu, traceGuid, id, 0LL);
  LOWORD(v11) = id;
  WppAutoLogTrace(AutoLogContext, level, flags, traceGuid, v11, 0LL, v12);
}
// 1400016BD: variable 'v11' is possibly undefined
// 1400016BD: variable 'v12' is possibly undefined

//----- (00000001400016DC) ----------------------------------------------------
void __fastcall sub_1400016DC(__int64 a1)
{
  PDEVICE_OBJECT v2; // rcx

  v2 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x90u, &WPPTraceGuidRelated);
    v2 = WPP_GLOBAL_Control;
  }
  if ( *(a1 + 16) )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    *(a1 + 16) = 0LL;
    *(a1 + 24) = 0LL;
    v2 = WPP_GLOBAL_Control;
  }
  if ( LOWORD(v2->DeviceType) )
    WPP_RECORDER_SF_(v2->DeviceExtension, 5u, 3u, 0x91u, &WPPTraceGuidRelated);
}

//----- (0000000140001784) ----------------------------------------------------
void __fastcall sub_140001784(__int64 a1, __int64 WdfObject)
{
  PDEVICE_OBJECT v4; // rcx
  __int64 WdfIoTarget; // rdx
  __int32 v6; // eax
  __int32 v7; // [rsp+28h] [rbp-10h]

  v4 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Bu, &WPPTraceGuidRelated);
    v4 = WPP_GLOBAL_Control;
  }
  if ( *a1 )
  {
    KeClearEvent((a1 + 112));
    WdfIoTarget = *(a1 + 8);
    if ( WdfIoTarget )
    {
      (*(WdfFunctions_01015[0] + WdfIoTargetPurge))(WdfDriverGlobals, WdfIoTarget, 1LL);
      (*(WdfFunctions_01015[0] + WdfIoTargetClose))(WdfDriverGlobals, *(a1 + 8));
    }
    (*(WdfFunctions_01015[0] + WdfObjectAcquireLock))(WdfDriverGlobals, WdfObject);
    KeClearEvent((a1 + 112));
    *a1 = 0;
    sub_1400016DC(a1 + 16);
    if ( *(a1 + 144) )
    {
      (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
      *(a1 + 144) = 0LL;
    }
    if ( *(a1 + 152) )
    {
      (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
      *(a1 + 152) = 0LL;
    }
    v6 = _InterlockedExchange((a1 + 136), 0);
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v7 = v6;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Du, &WPPTraceGuidRelated, v7);
    }
    if ( *(a1 + 8) )
    {
      (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
      *(a1 + 8) = 0LL;
    }
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, WdfObject);
  }
  else
  {
    if ( !LOWORD(v4->DeviceType) )
      return;
    WPP_RECORDER_SF_(v4->DeviceExtension, 5u, 3u, 0x6Cu, &WPPTraceGuidRelated);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Eu, &WPPTraceGuidRelated);
}

//----- (0000000140001974) ----------------------------------------------------
void __fastcall UnregisterIOCallBacksAndFreeRelatedResources(__int64 Device)
{
  NTSTATUS v2; // esi
  struct_DeviceContext *DeviceContext; // rdi
  void *pIoPlugPlayNotificationEntry; // rcx
  __int64 WdfCollection; // rdx
  __int64 v6; // rbx
  int v7; // eax
  __int64 v8; // rdx
  NTSTATUS v9; // [rsp+28h] [rbp-20h]

  v2 = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x5Fu, &WPPTraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  pIoPlugPlayNotificationEntry = *DeviceContext->IoPlugPlayNotificationEntry;
  if ( pIoPlugPlayNotificationEntry )
  {
    v2 = IoUnregisterPlugPlayNotification(pIoPlugPlayNotificationEntry);
    if ( v2 < 0 )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x60u, &WPPTraceGuidRelated);
    *DeviceContext->IoPlugPlayNotificationEntry = 0LL;
    (*(WdfFunctions_01015[0] + WdfObjectDereferenceActual))(WdfDriverGlobals, Device, 0LL, 1107LL, "Device.cpp");
  }
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x61u, &WPPTraceGuidRelated);
  sub_140001784(&DeviceContext->IoPlugPlayNotificationEntry[8], Device);
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x62u, &WPPTraceGuidRelated);
  sub_140001784(&DeviceContext->gap1B0[24], Device);
  if ( DeviceContext->hOutgoingQueue )
  {
    (*(WdfFunctions_01015[0] + WdfIoQueuePurgeSynchronously))(WdfDriverGlobals);
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, DeviceContext->hOutgoingQueue);
    DeviceContext->hOutgoingQueue = 0LL;
  }
  if ( DeviceContext->hIncomingQueue )
  {
    (*(WdfFunctions_01015[0] + WdfIoQueuePurgeSynchronously))(WdfDriverGlobals);
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, DeviceContext->hIncomingQueue);
    DeviceContext->hIncomingQueue = 0LL;
  }
  WdfCollection = DeviceContext->WdfCollection;
  if ( WdfCollection )
  {
    while ( WdfChildListGetDevice )
    {
      v7 = (*(WdfFunctions_01015[0] + WdfCollectionGetCount))(WdfDriverGlobals, WdfCollection);
      v8 = DeviceContext->WdfCollection;
      if ( !v7 )
        break;
      v6 = (*(WdfFunctions_01015[0] + WdfCollectionGetFirstItem))(WdfDriverGlobals, v8);
      (*(WdfFunctions_01015[0] + WdfCollectionRemove))(WdfDriverGlobals, DeviceContext->WdfCollection, v6);
      (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, v6);
      WdfCollection = DeviceContext->WdfCollection;
    }
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, v8);
    DeviceContext->WdfCollection = 0LL;
  }
  if ( DeviceContext->OutgoingQueueSpinLock )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    DeviceContext->OutgoingQueueSpinLock = 0LL;
  }
  if ( DeviceContext->IncomingQueueSpinLock )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    DeviceContext->IncomingQueueSpinLock = 0LL;
  }
  if ( *&DeviceContext->gap0[8] )
  {
    FreeHidPDeviceDesc(DeviceContext);
    *&DeviceContext->gap0[64] = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    v9 = v2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x63u, &WPPTraceGuidRelated, v9);
  }
}
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140001C5C) ----------------------------------------------------
__int64 __fastcall CreateDevice(__int64 DeviceInit)
{
  int v1; // eax
  unsigned int v2; // ebx
  unsigned __int16 v3; // r9
  __int64 v5; // [rsp+30h] [rbp-D8h]
  __int64 DeviceInit_; // [rsp+38h] [rbp-D0h] BYREF
  __int64 Device; // [rsp+40h] [rbp-C8h] BYREF
  _QWORD FileObjectAttributes[8]; // [rsp+48h] [rbp-C0h] BYREF
  _QWORD PnpPowerEventCallbacks[18]; // [rsp+88h] [rbp-80h] BYREF
  int FileObjectConfig; // [rsp+118h] [rbp+10h] BYREF
  __int64 (__fastcall *v11)(__int64, __int64, __int64); // [rsp+120h] [rbp+18h]
  __int64 v12; // [rsp+128h] [rbp+20h]
  void (__fastcall *v13)(__int64); // [rsp+130h] [rbp+28h]
  int v14; // [rsp+138h] [rbp+30h]
  int v15; // [rsp+13Ch] [rbp+34h]

  DeviceInit_ = DeviceInit;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xAu, &WPPTraceGuidRelated);
    DeviceInit = DeviceInit_;
  }
  (*(WdfFunctions_01015[0] + WdfFdoInitSetFilter))(WdfDriverGlobals, DeviceInit);
  (*(WdfFunctions_01015[0] + WdfDeviceInitSetIoInCallerContextCallback))(
    WdfDriverGlobals,
    DeviceInit_,
    EvtIoInCallerContext);
  memset(FileObjectAttributes, 0, 0x38uLL);
  LODWORD(FileObjectAttributes[0]) = 56;
  FileObjectAttributes[3] = 0x100000001LL;
  FileObjectAttributes[6] = DeviceContextTypeInfo;
  memset(PnpPowerEventCallbacks, 0, sizeof(PnpPowerEventCallbacks));
  PnpPowerEventCallbacks[5] = EvtDevicePrepareHardware;
  PnpPowerEventCallbacks[6] = EvtDeviceReleaseHardware;
  LODWORD(PnpPowerEventCallbacks[0]) = 144;
  (*(WdfFunctions_01015[0] + WdfDeviceInitSetPnpPowerEventCallbacks))(
    WdfDriverGlobals,
    DeviceInit_,
    PnpPowerEventCallbacks);
  v11 = sub_140002508;
  FileObjectConfig = 40;
  v13 = sub_140002A38;
  v12 = 0LL;
  v15 = 4;
  v14 = 2;
  (*(WdfFunctions_01015[0] + WdfDeviceInitSetFileObjectConfig))(
    WdfDriverGlobals,
    DeviceInit_,
    &FileObjectConfig,
    FileObjectAttributes);
  v1 = (*(WdfFunctions_01015[0] + WdfDeviceCreate))(WdfDriverGlobals, &DeviceInit_, FileObjectAttributes, &Device);
  v2 = v1;
  if ( v1 >= 0 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
    v1 = QueueInitialize(Device);
    v2 = v1;
    if ( v1 >= 0 )
      goto LABEL_8;
    v3 = 12;
  }
  else
  {
    v3 = 11;
  }
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v3, &WPPTraceGuidRelated, v1);
LABEL_8:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v5) = v2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xDu, &WPPTraceGuidRelated, v5);
  }
  return v2;
}
// 140001E6E: variable 'v5' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002428) ----------------------------------------------------
void __fastcall sub_140002428(__int64 a1)
{
  __int64 Device; // rbx
  struct_DeviceContext *DeviceContext; // rdi

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA0u, &WPPTraceGuidRelated);
  Device = (*(WdfFunctions_01015[0] + WdfIoTargetGetDevice))(WdfDriverGlobals, a1);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  sub_140001784(&DeviceContext->gap1B0[24], Device);
  DeviceContext->dword268 = 0xFFFFFFFF;
  DeviceContext->dword27E = 0xFFFFFFFF;
  DeviceContext->dword26C = 0x7FFFFFFF;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA1u, &WPPTraceGuidRelated);
}
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002508) ----------------------------------------------------
__int64 __fastcall sub_140002508(__int64 Device, __int64 WdfRequest, __int64 WdfFileObject)
{
  unsigned int Status; // ebx
  __int64 TargetFileObject; // rax
  __int64 TargetFileObject_0; // rbp
  __int64 WdfIoTarget; // rax
  int Status_0; // eax
  unsigned __int16 v11; // r9
  PDEVICE_OBJECT v12; // rcx
  unsigned __int8 v13; // dl
  __int64 result; // rax
  __int64 v15; // [rsp+28h] [rbp-90h]
  _QWORD WdfRequestParameters[5]; // [rsp+40h] [rbp-78h] BYREF
  _QWORD WdfRequestSendOptions[2]; // [rsp+68h] [rbp-50h] BYREF

  Status = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x17u, &WPPTraceGuidRelated);
  TargetFileObject = (*(WdfFunctions_01015[0] + WdfFileObjectWdmGetFileObject))(WdfDriverGlobals, WdfFileObject);
  TargetFileObject_0 = TargetFileObject;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPPRelated3(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      3u,
      0x18u,
      &WPPTraceGuidRelated,
      WdfFileObject,
      TargetFileObject);
  (*(WdfFunctions_01015[0] + WdfRequestFormatRequestUsingCurrentType))(WdfDriverGlobals, WdfRequest);
  WdfRequestSendOptions[1] = 0LL;
  WdfRequestSendOptions[0] = 0x200000010LL;
  WdfIoTarget = (*(WdfFunctions_01015[0] + WdfDeviceGetIoTarget))(WdfDriverGlobals, Device);
  if ( !(*(WdfFunctions_01015[0] + WdfRequestSend))(WdfDriverGlobals, WdfRequest, WdfIoTarget, WdfRequestSendOptions) )
  {
    Status_0 = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, WdfRequest);
    Status = Status_0;
    v11 = 25;
LABEL_15:
    v12 = WPP_GLOBAL_Control;
    v13 = 2;
LABEL_16:
    LODWORD(v15) = Status_0;
    WPP_SF_D(v12->DeviceExtension, v13, 3u, v11, &WPPTraceGuidRelated, v15);
    goto LABEL_17;
  }
  memset(WdfRequestParameters, 0, sizeof(WdfRequestParameters));
  LOWORD(WdfRequestParameters[0]) = 40;
  (*(WdfFunctions_01015[0] + WdfRequestGetParameters))(WdfDriverGlobals, WdfRequest, WdfRequestParameters);
  Status_0 = HIDWORD(WdfRequestParameters[0]);
  if ( HIDWORD(WdfRequestParameters[0]) )
  {
    v12 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_17;
    v11 = 26;
    v13 = 5;
    goto LABEL_16;
  }
  if ( (*(WdfRequestParameters[1] + 16LL) & 0x120089) != 0 )
  {
    Status_0 = sub_140003CA4(Device, TargetFileObject_0);
    Status = Status_0;
    if ( Status_0 >= 0 )
      goto LABEL_17;
    v11 = 28;
    goto LABEL_15;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v15) = *(WdfRequestParameters[1] + 16LL);
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Bu, &WPPTraceGuidRelated, v15);
  }
LABEL_17:
  result = (*(WdfFunctions_01015[0] + WdfRequestComplete))(WdfDriverGlobals, WdfRequest, Status);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v15) = Status;
    return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Du, &WPPTraceGuidRelated, v15);
  }
  return result;
}
// 1400026D2: variable 'v15' is possibly undefined

//----- (000000014000277C) ----------------------------------------------------
__int64 __fastcall EvtDevicePrepareHardware(PVOID Device)
{
  int status; // eax
  unsigned int status_0; // ebx
  unsigned __int16 v4; // r9
  __int64 v6; // [rsp+28h] [rbp-10h]
  int v7; // [rsp+28h] [rbp-10h]

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xEu, &WPPTraceGuidRelated);
  (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
  status = DoScreenSave(Device);
  status_0 = status;
  if ( status >= 0 )
  {
    status = RegisterCallBackForGuidDevInterfaceHidArrival(Device);
    status_0 = status;
    if ( status >= 0 )
    {
      status = GenerateNewSurfaceDialHidDescriptor(Device);
      status_0 = status;
      if ( status >= 0 )
        goto LABEL_10;
      v4 = 17;
    }
    else
    {
      v4 = 16;
    }
  }
  else
  {
    v4 = 15;
  }
  v7 = status;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v4, &WPPTraceGuidRelated, v7);
LABEL_10:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v6) = status_0;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x12u, &WPPTraceGuidRelated, v6);
  }
  return status_0;
}
// 14000286A: variable 'v6' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (000000014000288C) ----------------------------------------------------
__int64 __fastcall EvtDeviceReleaseHardware(__int64 Device)
{
  unsigned int v2; // ebx
  struct_DeviceContext *DeviceContext; // rdi
  __int64 WdfQueue; // rax
  PVOID pvoid110; // rcx
  NTSTATUS v6; // eax
  PVOID pvoid118; // rcx
  NTSTATUS v8; // eax
  __int64 v10; // [rsp+28h] [rbp-10h]
  NTSTATUS v11; // [rsp+28h] [rbp-10h]

  v2 = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x13u, &WPPTraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  KeSetEvent(&DeviceContext->ReleasingHardwareEvent, 0, 0);
  WdfQueue = (*(WdfFunctions_01015[0] + WdfDeviceGetDefaultQueue))(WdfDriverGlobals, Device);
  (*(WdfFunctions_01015[0] + WdfIoQueuePurgeSynchronously))(WdfDriverGlobals, WdfQueue);
  pvoid110 = DeviceContext->pvoid110;
  if ( pvoid110 )
  {
    v6 = KeWaitForSingleObject(pvoid110, Executive, 0, 0, 0LL);
    v2 = v6;
    if ( v6 < 0 )
    {
      v11 = v6;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x14u, &WPPTraceGuidRelated, v11);
    }
    ObfDereferenceObject(DeviceContext->pvoid110);
  }
  pvoid118 = DeviceContext->pvoid118;
  if ( pvoid118 )
  {
    v8 = KeWaitForSingleObject(pvoid118, Executive, 0, 0, 0LL);
    v2 = v8;
    if ( v8 < 0 )
    {
      LODWORD(v10) = v8;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x15u, &WPPTraceGuidRelated, v10);
    }
    ObfDereferenceObject(DeviceContext->pvoid118);
  }
  UnregisterIOCallBacksAndFreeRelatedResources(Device);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x16u, &WPPTraceGuidRelated, v10);
  }
  return v2;
}
// 1400029D4: variable 'v10' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002A38) ----------------------------------------------------
void __fastcall sub_140002A38(__int64 WdfFileObject)
{
  __int64 Device; // rbx
  struct_DeviceContext *DeviceContext; // rsi
  __int64 FileObject_0; // rax
  __int64 FileObject; // rbp
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  __int64 v8; // [rsp+28h] [rbp-30h]

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Eu, &WPPTraceGuidRelated);
  Device = (*(WdfFunctions_01015[0] + WdfFileObjectGetDevice))(WdfDriverGlobals, WdfFileObject);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  FileObject_0 = (*(WdfFunctions_01015[0] + WdfFileObjectWdmGetFileObject))(WdfDriverGlobals, WdfFileObject);
  FileObject = FileObject_0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPPRelated3(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x1Fu, &WPPTraceGuidRelated, WdfFileObject, FileObject_0);
  (*(WdfFunctions_01015[0] + WdfObjectAcquireLock))(WdfDriverGlobals, Device);
  if ( !DeviceContext->IoPlugPlayNotificationEntry[8] )
  {
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, Device);
    v6 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return;
    v7 = 32;
LABEL_8:
    WPP_RECORDER_SF_(v6->DeviceExtension, 5u, 3u, v7, &WPPTraceGuidRelated);
    goto LABEL_16;
  }
  if ( !*&DeviceContext->IoPlugPlayNotificationEntry[16] )
  {
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, Device);
    v6 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return;
    v7 = 33;
    goto LABEL_8;
  }
  if ( (*(WdfFunctions_01015[0] + WdfIoTargetWdmGetTargetFileObject))(WdfDriverGlobals) != FileObject )
  {
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, Device);
    v6 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return;
    v7 = 34;
    goto LABEL_8;
  }
  (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, Device);
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x23u, &WPPTraceGuidRelated);
  sub_140001784(&DeviceContext->IoPlugPlayNotificationEntry[8], Device);
LABEL_16:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v8) = 0;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x24u, &WPPTraceGuidRelated, v8);
  }
}
// 140002C3D: variable 'v8' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140002C64) ----------------------------------------------------
void __fastcall EvtIoInCallerContext(__int64 a1, __int64 a2)
{
  int v4; // eax
  int v5; // ebx
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  unsigned __int8 v8; // dl
  int v9; // eax
  unsigned __int16 v10; // r9
  _QWORD *v11; // rax
  int v12; // eax
  int v13; // eax
  __int64 v14; // [rsp+28h] [rbp-71h]
  _QWORD *v15; // [rsp+30h] [rbp-69h] BYREF
  __int64 v16; // [rsp+38h] [rbp-61h] BYREF
  __int64 v17; // [rsp+40h] [rbp-59h] BYREF
  _QWORD v18[7]; // [rsp+48h] [rbp-51h] BYREF
  __int64 v19; // [rsp+80h] [rbp-19h] BYREF
  __int64 v20; // [rsp+88h] [rbp-11h] BYREF
  _DWORD Dst[10]; // [rsp+90h] [rbp-9h] BYREF

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x25u, &WPPTraceGuidRelated);
  v4 = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, a2);
  v5 = v4;
  if ( v4 < 0 )
  {
    v6 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_41;
    v7 = 38;
    v8 = 5;
    goto LABEL_6;
  }
  if ( (*(WdfFunctions_01015[0] + WdfRequestGetRequestorMode))(WdfDriverGlobals, a2) == 1 )
  {
    memset(Dst, 0, sizeof(Dst));
    LOWORD(Dst[0]) = 40;
    (*(WdfFunctions_01015[0] + WdfRequestGetParameters))(WdfDriverGlobals, a2, Dst);
    if ( Dst[1] == 14 && (Dst[6] & 3) == 3 )
    {
      v4 = (*(WdfFunctions_01015[0] + WdfRequestRetrieveUnsafeUserInputBuffer))(WdfDriverGlobals, a2, 0LL, &v16, &v19);
      v5 = v4;
      if ( v4 >= 0 )
      {
        v4 = (*(WdfFunctions_01015[0] + WdfRequestRetrieveUnsafeUserOutputBuffer))(
               WdfDriverGlobals,
               a2,
               0LL,
               &v17,
               &v20);
        v5 = v4;
        if ( v4 >= 0 )
        {
          memset(v18, 0, sizeof(v18));
          v18[3] = 0x100000001LL;
          v18[6] = RequestContextTypeInfo;
          LODWORD(v18[0]) = 56;
          v4 = (*(WdfFunctions_01015[0] + WdfObjectAllocateContext))(WdfDriverGlobals, a2, v18, &v15);
          v5 = v4;
          if ( v4 >= 0 )
          {
            v11 = v15;
            *v15 = 0LL;
            v11[1] = 0LL;
            if ( v19
              && v16
              && (v4 = (*(WdfFunctions_01015[0] + WdfRequestProbeAndLockUserBufferForRead))(WdfDriverGlobals, a2),
                  v5 = v4,
                  v4 < 0) )
            {
              v7 = 48;
            }
            else
            {
              if ( !v20
                || !v17
                || (v4 = (*(WdfFunctions_01015[0] + WdfRequestProbeAndLockUserBufferForWrite))(WdfDriverGlobals, a2),
                    v5 = v4,
                    v4 >= 0) )
              {
                if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
                  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x32u, &WPPTraceGuidRelated);
                v12 = (*(WdfFunctions_01015[0] + WdfDeviceEnqueueRequest))(WdfDriverGlobals, a1, a2);
                v5 = v12;
                if ( v12 < 0 )
                {
                  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x33u, &WPPTraceGuidRelated, v12);
                  if ( v5 != -1071644156 )
                    goto LABEL_41;
                  v10 = 52;
                  goto LABEL_40;
                }
                goto LABEL_45;
              }
              v7 = 49;
            }
          }
          else
          {
            v7 = 47;
          }
        }
        else
        {
          v7 = 46;
        }
      }
      else
      {
        v7 = 45;
      }
      v6 = WPP_GLOBAL_Control;
      v8 = 2;
LABEL_6:
      WPP_SF_D(v6->DeviceExtension, v8, 3u, v7, &WPPTraceGuidRelated, v4);
      goto LABEL_41;
    }
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x2Au, &WPPTraceGuidRelated);
    v13 = (*(WdfFunctions_01015[0] + WdfDeviceEnqueueRequest))(WdfDriverGlobals, a1, a2);
    v5 = v13;
    if ( v13 < 0 )
    {
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x2Bu, &WPPTraceGuidRelated, v13);
      if ( v5 != -1071644156 )
        goto LABEL_41;
      v10 = 44;
LABEL_40:
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, v10, &WPPTraceGuidRelated);
      v5 = -1073741536;
LABEL_41:
      if ( v5 < 0 )
      {
        if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
        {
          LODWORD(v14) = v5;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x35u, &WPPTraceGuidRelated, v14);
        }
        (*(WdfFunctions_01015[0] + WdfRequestCompleteWithInformation))(WdfDriverGlobals, a2, v5, 0LL);
      }
    }
  }
  else
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x27u, &WPPTraceGuidRelated);
    v9 = (*(WdfFunctions_01015[0] + WdfDeviceEnqueueRequest))(WdfDriverGlobals, a1, a2);
    v5 = v9;
    if ( v9 < 0 )
    {
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x28u, &WPPTraceGuidRelated, v9);
      if ( v5 != -1071644156 )
        goto LABEL_41;
      v10 = 41;
      goto LABEL_40;
    }
  }
LABEL_45:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v14) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x36u, &WPPTraceGuidRelated, v14);
  }
}
// 1400030B9: variable 'v14' is possibly undefined
// 14000B048: using guessed type _UNKNOWN *RequestContextTypeInfo;

//----- (0000000140003130) ----------------------------------------------------
__int64 __fastcall HidGetSomethingInfoFromDevice(
        __int64 WdfIoTarget,
        unsigned int *HID_GET_COLLECTION_INFORMATIONBuffer)
{
  int status; // eax
  int status2; // ebx
  unsigned __int16 v6; // r9
  __int64 WdfMemoryBufferSize_0; // rsi
  int status3; // eax
  __int64 InputBuffer; // r8
  __int64 HID_GET_COLLECTION_DESCRIPTORWdfMemory; // rdx
  struct _HIDP_PREPARSED_DATA *HID_GET_COLLECTION_DESCRIPTORPreParsedData; // rax
  __int64 v13; // [rsp+28h] [rbp-30h]
  int v14; // [rsp+28h] [rbp-30h]
  int v15; // [rsp+28h] [rbp-30h]
  __int64 WdfMemory; // [rsp+70h] [rbp+18h] BYREF

  WdfMemory = 0LL;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x83u, &WPPTraceGuidRelated);
  memset(HID_GET_COLLECTION_INFORMATIONBuffer, 0, 96uLL);
  status = SendHIDIoctlToDevice(WdfIoTarget, 0xB01A8u, 12LL, &WdfMemory);// IOCTL_HID_GET_COLLECTION_INFORMATION
  status2 = status;
  if ( status < 0 )
  {
    v6 = 132;
LABEL_5:
    v14 = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v6, &WPPTraceGuidRelated, v14);
    goto LABEL_15;
  }
  WdfMemoryBufferSize_0 = WdfMemory;
  status3 = (*(WdfFunctions_01015[0] + WdfMemoryCopyToBuffer))(
              WdfDriverGlobals,
              WdfMemory,
              0LL,
              HID_GET_COLLECTION_INFORMATIONBuffer,
              12LL);
  status2 = status3;
  if ( status3 >= 0 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, WdfMemoryBufferSize_0);
    InputBuffer = *HID_GET_COLLECTION_INFORMATIONBuffer;
    WdfMemory = 0LL;
    status = SendHIDIoctlToDevice(WdfIoTarget, 0xB0193u, InputBuffer, &WdfMemory);// IOCTL_HID_GET_COLLECTION_DESCRIPTOR
    status2 = status;
    if ( status < 0 )
    {
      v6 = 134;
      goto LABEL_5;
    }
    HID_GET_COLLECTION_DESCRIPTORWdfMemory = WdfMemory;
    *(HID_GET_COLLECTION_INFORMATIONBuffer + 2) = WdfMemory;
    HID_GET_COLLECTION_DESCRIPTORPreParsedData = (*(WdfFunctions_01015[0] + WdfMemoryGetBuffer))(
                                                   WdfDriverGlobals,
                                                   HID_GET_COLLECTION_DESCRIPTORWdfMemory,
                                                   0LL);
    *(HID_GET_COLLECTION_INFORMATIONBuffer + 3) = HID_GET_COLLECTION_DESCRIPTORPreParsedData;
    WdfMemoryBufferSize_0 = 0LL;
    status = HidP_GetCaps(HID_GET_COLLECTION_DESCRIPTORPreParsedData, (HID_GET_COLLECTION_INFORMATIONBuffer + 8));
    status2 = status;
    if ( status < 0 )
    {
      v6 = 135;
      goto LABEL_5;
    }
    status2 = 0;
  }
  else
  {
    v15 = status3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x85u, &WPPTraceGuidRelated, v15);
  }
  if ( WdfMemoryBufferSize_0 )
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, WdfMemoryBufferSize_0);
LABEL_15:
  if ( status2 < 0 && *(HID_GET_COLLECTION_INFORMATIONBuffer + 2) )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    *(HID_GET_COLLECTION_INFORMATIONBuffer + 2) = 0LL;
    *(HID_GET_COLLECTION_INFORMATIONBuffer + 3) = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v13) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x88u, &WPPTraceGuidRelated, v13);
  }
  return status2;
}
// 140003324: variable 'v13' is possibly undefined

//----- (0000000140003344) ----------------------------------------------------
__int64 __fastcall SendHIDIoctlToDevice(
        __int64 WdfIoTarget,
        unsigned int IoControlCode,
        __int64 BufferSize,
        _QWORD *pWdfMemory)
{
  PDEVICE_OBJECT v8; // rcx
  int status2; // ebx
  int status; // eax
  unsigned __int16 v11; // r9
  __int64 v13; // [rsp+28h] [rbp-61h]
  __int64 v14; // [rsp+40h] [rbp-49h] BYREF
  __int64 WdfMemory; // [rsp+48h] [rbp-41h] BYREF
  _QWORD WdfObjectAttributes[7]; // [rsp+50h] [rbp-39h] BYREF
  _QWORD v17[2]; // [rsp+88h] [rbp-1h] BYREF

  WdfMemory = 0LL;
  v14 = 0LL;
  v8 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x89u, &WPPTraceGuidRelated);
    v8 = WPP_GLOBAL_Control;
  }
  if ( !BufferSize )
  {
    WPP_RECORDER_SF_(v8->DeviceExtension, 2u, 3u, 0x8Au, &WPPTraceGuidRelated);
    status2 = -1073741789;
    goto LABEL_16;
  }
  memset(WdfObjectAttributes, 0, sizeof(WdfObjectAttributes));
  WdfObjectAttributes[3] = 0x100000001LL;
  LODWORD(WdfObjectAttributes[0]) = 56;
  WdfObjectAttributes[4] = WdfIoTarget;
  status = (*(WdfFunctions_01015[0] + WdfMemoryCreate))(
             WdfDriverGlobals,
             WdfObjectAttributes,
             512LL,
             'DFDS',
             BufferSize,
             &WdfMemory,
             0LL);
  status2 = status;
  if ( status < 0 )
  {
    WdfMemory = 0LL;
    v11 = 139;
LABEL_7:
    LODWORD(v13) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v11, &WPPTraceGuidRelated, v13);
    goto LABEL_16;
  }
  memset(WdfObjectAttributes, 0, sizeof(WdfObjectAttributes));
  WdfObjectAttributes[3] = 0x100000001LL;
  LODWORD(WdfObjectAttributes[0]) = 56;
  WdfObjectAttributes[4] = WdfIoTarget;
  status = (*(WdfFunctions_01015[0] + WdfRequestCreate))(WdfDriverGlobals, WdfObjectAttributes, WdfIoTarget, &v14);
  status2 = status;
  if ( status < 0 )
  {
    v14 = 0LL;
    v11 = 140;
    goto LABEL_7;
  }
  status = (*(WdfFunctions_01015[0] + WdfIoTargetFormatRequestForIoctl))(
             WdfDriverGlobals,
             WdfIoTarget,
             v14,
             IoControlCode,
             0LL,
             0LL,
             WdfMemory,
             0LL);
  status2 = status;
  if ( status < 0 )
  {
    v14 = 0LL;
    v11 = 141;
    goto LABEL_7;
  }
  v17[1] = 0LL;
  v17[0] = 0x200000010LL;
  if ( (*(WdfFunctions_01015[0] + WdfRequestSend))(WdfDriverGlobals, v14, WdfIoTarget, v17) )
  {
    *pWdfMemory = WdfMemory;
    WdfMemory = 0LL;
  }
  else
  {
    status2 = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, v14);
    LODWORD(v13) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x8Eu, &WPPTraceGuidRelated, v13);
    if ( status2 >= 0 )
      status2 = -1073741823;
  }
LABEL_16:
  if ( WdfMemory )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    WdfMemory = 0LL;
  }
  if ( v14 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    v14 = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v13) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x8Fu, &WPPTraceGuidRelated, v13);
  }
  return status2;
}
// 140003468: variable 'v13' is possibly undefined

//----- (0000000140003630) ----------------------------------------------------
__int64 __fastcall HIDDeviceArrivalCallbackRoutine(
        struct_deviceInterfaceChangeNotification *deviceInterfaceChangeNotification,
        __int64 Device)
{
  int status; // ebx
  int status3; // eax
  unsigned __int16 v6; // r9
  PUNICODE_STRING DeviceSymbolicName; // rax
  struct _UNICODE_STRING DeviceSymbolicName2; // xmm0
  __int64 v9; // rcx
  __int64 v11; // [rsp+28h] [rbp-D8h]
  __int64 TargetWdfDevice; // [rsp+50h] [rbp-B0h] BYREF
  unsigned int HidSomethingInfoBuffer[24]; // [rsp+60h] [rbp-A0h] BYREF
  _OWORD v14[9]; // [rsp+C0h] [rbp-40h] BYREF

  TargetWdfDevice = 0LL;
  status = 0;
  memset(HidSomethingInfoBuffer, 0, sizeof(HidSomethingInfoBuffer));
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x78u, &WPPTraceGuidRelated);
  (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
  if ( *&deviceInterfaceChangeNotification->Event.Data1 == *&GUID_DEVICE_INTERFACE_ARRIVAL.Data1
    && *deviceInterfaceChangeNotification->Event.Data4 == *GUID_DEVICE_INTERFACE_ARRIVAL.Data4 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPPRelated4(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        3u,
        0x7Au,
        &WPPTraceGuidRelated,
        (*(&deviceInterfaceChangeNotification->SymbolicLinkName + 4))->Buffer);
    status3 = (*(WdfFunctions_01015[0] + WdfIoTargetCreate))(WdfDriverGlobals, Device, 0LL, &TargetWdfDevice);
    status = status3;
    if ( status3 < 0 )
    {
      TargetWdfDevice = 0LL;
      v6 = 123;
LABEL_9:
      LODWORD(v11) = status3;
LABEL_10:
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v6, &WPPTraceGuidRelated, v11);
      goto LABEL_30;
    }
    memset(v14, 0, 0x88uLL);
    DeviceSymbolicName = *(&deviceInterfaceChangeNotification->SymbolicLinkName + 4);
    *&v14[0] = 0x200000088LL;
    DeviceSymbolicName2 = *DeviceSymbolicName;
    *&v14[4] = 0x700000000LL;
    v14[3] = DeviceSymbolicName2;
    LODWORD(v14[5]) = 64;
    status = (*(WdfFunctions_01015[0] + WdfIoTargetOpen))(WdfDriverGlobals, TargetWdfDevice, v14);
    if ( status == 0xC0000043 )
    {
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        LODWORD(v11) = 0xC0000043;
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x7Cu, &WPPTraceGuidRelated, v11);
      }
      status = 0;
      goto LABEL_30;
    }
    if ( status < 0 )
    {
      v6 = 125;
LABEL_17:
      LODWORD(v11) = status;
      goto LABEL_10;
    }
    status = HidGetSomethingInfoFromDevice(TargetWdfDevice, HidSomethingInfoBuffer);
    if ( status < 0 )
    {
      memset(HidSomethingInfoBuffer, 0, sizeof(HidSomethingInfoBuffer));
      v6 = 126;
      goto LABEL_17;
    }
    v9 = WPP_GLOBAL_Control;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v11) = HIWORD(HidSomethingInfoBuffer[1]);
      WPPRelated5(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        3u,
        0x7Fu,
        &WPPTraceGuidRelated,
        v11,
        LOWORD(HidSomethingInfoBuffer[2]),
        HIWORD(HidSomethingInfoBuffer[8]),
        LOWORD(HidSomethingInfoBuffer[8]));
      v9 = WPP_GLOBAL_Control;
    }
    if ( HIWORD(HidSomethingInfoBuffer[1]) == 0x45E && HidSomethingInfoBuffer[8] == 0xFF090100 )// 045E: Microsoft Vendor ID
                                                // FF09: Digitizer Collection, Under IPTS, Col0A, UP:FF09, U:0100
    {
      if ( *(v9 + 72) )
        WPP_RECORDER_SF_(*(v9 + 64), 5u, 3u, 0x80u, &WPPTraceGuidRelated);
      status3 = DoSomethingWithValidatedOfInterestWdfHidDevice(
                  Device,
                  *(&deviceInterfaceChangeNotification->SymbolicLinkName + 4),
                  HidSomethingInfoBuffer);
      status = status3;
      if ( status3 < 0 )
      {
        v6 = 129;
        goto LABEL_9;
      }
    }
  }
  else if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPPRelated6(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      3u,
      0x79u,
      &WPPTraceGuidRelated,
      &deviceInterfaceChangeNotification->Event);
  }
LABEL_30:
  sub_1400016DC(HidSomethingInfoBuffer);
  if ( TargetWdfDevice )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    TargetWdfDevice = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v11) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x82u, &WPPTraceGuidRelated, v11);
  }
  return 0LL;
}
// 14000376D: variable 'v11' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (00000001400039B8) ----------------------------------------------------
__int64 __fastcall sub_1400039B8(__int64 Device)
{
  struct_DeviceContext *DeviceContext; // rdi
  int status; // eax
  unsigned int status2; // ebx
  unsigned __int16 v5; // r9
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  __int16 GetHidDeviceDescriptionArg0_XPhysicalMax; // ax
  __int16 GetHidDeviceDescriptionArg1_XLogicalMax; // cx
  __int16 GetHidDeviceDescriptionArg2_YPhysicalMax; // dx
  __int16 GetHidDeviceDescriptionArg3_YLogicalMax; // r8
  __int64 v12; // rcx
  __int64 v14; // [rsp+28h] [rbp-28h]
  int XPhysicalMax; // [rsp+30h] [rbp-20h] BYREF
  int XLogicalMax; // [rsp+34h] [rbp-1Ch] BYREF
  int YPhysicalMax; // [rsp+38h] [rbp-18h] BYREF
  int YLogicalMax; // [rsp+3Ch] [rbp-14h] BYREF
  union _LARGE_INTEGER Timeout; // [rsp+40h] [rbp-10h] BYREF

  XPhysicalMax = 0;
  XLogicalMax = 0;
  YPhysicalMax = 0;
  YLogicalMax = 0;
  Timeout.QuadPart = 0LL;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x49u, &WPPTraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  if ( DeviceContext->gap274[0] )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x4Au, &WPPTraceGuidRelated);
  }
  else
  {
    status = GetCoordinateValuesFromRegistry(&XPhysicalMax, &XLogicalMax, &YPhysicalMax, &YLogicalMax);
    status2 = status;
    if ( status >= 0 )
    {
LABEL_24:
      GetHidDeviceDescriptionArg0_XPhysicalMax = XPhysicalMax;
      GetHidDeviceDescriptionArg1_XLogicalMax = XLogicalMax;
      GetHidDeviceDescriptionArg2_YPhysicalMax = YPhysicalMax;
      GetHidDeviceDescriptionArg3_YLogicalMax = YLogicalMax;
      goto LABEL_25;
    }
    if ( status != 0xC0000034 )
    {
      v5 = 84;
      goto LABEL_13;
    }
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x4Bu, &WPPTraceGuidRelated);
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPPRelated7(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x4Cu, &WPPTraceGuidRelated, DeviceContext->dword278);
  }
  Timeout.QuadPart = -10000LL * DeviceContext->dword278;
  status = KeWaitForSingleObject(
             &DeviceContext->DigitizerSizeValuesSuccessfullyWrittenToRegistry,
             Executive,
             0,
             0,
             &Timeout);
  status2 = status;
  if ( !status )
  {
    v6 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_19;
    v7 = 78;
    goto LABEL_18;
  }
  if ( status != 258 )
  {
    v5 = 80;
LABEL_13:
    LODWORD(v14) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v5, &WPPTraceGuidRelated, v14);
    goto LABEL_30;
  }
  v6 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    v7 = 79;
LABEL_18:
    WPP_RECORDER_SF_(v6->DeviceExtension, 5u, 3u, v7, &WPPTraceGuidRelated);
  }
LABEL_19:
  status = GetCoordinateValuesFromRegistry(&XPhysicalMax, &XLogicalMax, &YPhysicalMax, &YLogicalMax);
  status2 = status;
  if ( status >= 0 )
    goto LABEL_24;
  if ( status != -1073741772 )
  {
    v5 = 83;
    goto LABEL_13;
  }
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x52u, &WPPTraceGuidRelated);
  GetHidDeviceDescriptionArg0_XPhysicalMax = 0;
  GetHidDeviceDescriptionArg1_XLogicalMax = 0;
  GetHidDeviceDescriptionArg2_YPhysicalMax = 0;
  GetHidDeviceDescriptionArg3_YLogicalMax = 0;
LABEL_25:
  status = FillNewSurfaceDialHidDeviceDescriptorWithSizeData(
             GetHidDeviceDescriptionArg0_XPhysicalMax,
             GetHidDeviceDescriptionArg1_XLogicalMax,
             GetHidDeviceDescriptionArg2_YPhysicalMax,
             GetHidDeviceDescriptionArg3_YLogicalMax,
             DeviceContext);
  status2 = status;
  if ( status < 0 )
  {
    v5 = 86;
    goto LABEL_13;
  }
  v12 = *DeviceContext->gap0;
  *&DeviceContext->gap0[64] = *DeviceContext->gap0;
  status = HidP_GetCaps(*(v12 + 32), &DeviceContext->gap0[72]);
  status2 = status;
  if ( status < 0 )
  {
    v5 = 87;
    goto LABEL_13;
  }
  status2 = 0;
LABEL_30:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v14) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x58u, &WPPTraceGuidRelated, v14);
  }
  return status2;
}
// 140003B4C: variable 'v14' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140003CA4) ----------------------------------------------------
__int64 __fastcall sub_140003CA4(__int64 Device, __int64 TargetFileObject)
{
  struct_DeviceContext *DeviceContext; // r14
  int v5; // eax
  unsigned int v6; // ebx
  unsigned __int16 v7; // r9
  __int64 TargetDeviceObject; // rbx
  __int64 v10; // [rsp+28h] [rbp-91h]
  __int64 IoTarget; // [rsp+30h] [rbp-89h] BYREF
  _QWORD OpenParams[18]; // [rsp+40h] [rbp-79h] BYREF

  IoTarget = 0LL;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Fu, &WPPTraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  v5 = (*(WdfFunctions_01015[0] + WdfIoTargetCreate))(WdfDriverGlobals, Device, 0LL, &IoTarget);
  v6 = v5;
  if ( v5 < 0 )
  {
    IoTarget = 0LL;
    v7 = 112;
LABEL_5:
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v7, &WPPTraceGuidRelated, v5);
    goto LABEL_11;
  }
  TargetDeviceObject = (*(WdfFunctions_01015[0] + WdfDeviceWdmGetAttachedDevice))(WdfDriverGlobals, Device);
  memset(OpenParams, 0, 0x88uLL);
  OpenParams[0] = 0x100000088LL;
  OpenParams[4] = TargetDeviceObject;
  OpenParams[5] = TargetFileObject;
  v5 = (*(WdfFunctions_01015[0] + WdfIoTargetOpen))(WdfDriverGlobals, IoTarget, OpenParams);
  v6 = v5;
  if ( v5 < 0 )
  {
    v7 = 113;
    goto LABEL_5;
  }
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x72u, &WPPTraceGuidRelated);
  v5 = sub_140004314(Device, IoTarget, &DeviceContext->IoPlugPlayNotificationEntry[8]);
  v6 = v5;
  if ( v5 < 0 )
  {
    v7 = 115;
    goto LABEL_5;
  }
  IoTarget = 0LL;
LABEL_11:
  if ( IoTarget )
  {
    (*(WdfFunctions_01015[0] + WdfIoTargetClose))(WdfDriverGlobals);
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, IoTarget);
    IoTarget = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v6;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x74u, &WPPTraceGuidRelated, v10);
  }
  return v6;
}
// 140003EAA: variable 'v10' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140003ED8) ----------------------------------------------------
__int64 __fastcall DoSomethingWithValidatedOfInterestWdfHidDevice(
        __int64 WdfDevice,
        PUNICODE_STRING TargetDeviceSymbolicName,
        __int64 StructContainingPreParsedData)
{
  struct_DeviceContext *DeviceContext; // r13
  int status; // eax
  NTSTATUS status2; // ebx
  unsigned __int16 v8; // r9
  LONG XPhysicalMax; // r14d
  LONG XLogicalMax; // r15d
  LONG YPhysicalMax; // edi
  LONG YLogicalMax; // esi
  struct _UNICODE_STRING v13; // xmm0
  PUSHORT unkn; // [rsp+28h] [rbp-D8h]
  PHIDP_PREPARSED_DATA PreparsedData; // [rsp+30h] [rbp-D0h]
  __int64 WdfIoTarget; // [rsp+58h] [rbp-A8h] BYREF
  _OWORD WdfIoTargetOpenParams[9]; // [rsp+60h] [rbp-A0h] BYREF
  USHORT ValueCapsLength[8]; // [rsp+F0h] [rbp-10h] BYREF
  struct _HIDP_VALUE_CAPS ValueCaps; // [rsp+100h] [rbp+0h] BYREF

  WdfIoTarget = 0LL;
  memset(&ValueCaps, 0, sizeof(ValueCaps));
  ValueCapsLength[0] = 1;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x92u, &WPPTraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    WdfDevice,
                    DeviceContextTypeInfo);
  memset(&ValueCaps, 0, sizeof(ValueCaps));
  status = HidP_GetSpecificValueCaps(
             HidP_Input,
             1u,
             0,
             0x30u,
             &ValueCaps,
             ValueCapsLength,
             *(StructContainingPreParsedData + 24));
  status2 = status;
  if ( status >= 0 )
  {
    XPhysicalMax = ValueCaps.PhysicalMax;
    XLogicalMax = ValueCaps.LogicalMax;
    memset(&ValueCaps, 0, sizeof(ValueCaps));
    status2 = HidP_GetSpecificValueCaps(
                HidP_Input,
                1u,
                0,
                0x31u,
                &ValueCaps,
                ValueCapsLength,
                *(StructContainingPreParsedData + 24));
    if ( status2 < 0 )
    {
      LODWORD(unkn) = status2;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x94u, &WPPTraceGuidRelated, unkn);
      goto LABEL_27;
    }
    YPhysicalMax = ValueCaps.PhysicalMax;
    YLogicalMax = ValueCaps.LogicalMax;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(PreparsedData) = XLogicalMax;
      LODWORD(unkn) = XPhysicalMax;
      WPPRelated5(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        3u,
        0x95u,
        &WPPTraceGuidRelated,
        unkn,
        PreparsedData,
        ValueCaps.PhysicalMax,
        ValueCaps.LogicalMax);
    }
    status = WriteDriverRegistryValue(XPhysicalMaxStruct, XPhysicalMax);
    status2 = status;
    if ( status >= 0 )
    {
      status = WriteDriverRegistryValue(XLogicalMaxStruct, XLogicalMax);
      status2 = status;
      if ( status >= 0 )
      {
        status = WriteDriverRegistryValue(YPhysicalMaxStruct, YPhysicalMax);
        status2 = status;
        if ( status >= 0 )
        {
          status = WriteDriverRegistryValue(YLogicalMaxStruct, YLogicalMax);
          status2 = status;
          if ( status >= 0 )
          {
            KeSetEvent(&DeviceContext->DigitizerSizeValuesSuccessfullyWrittenToRegistry, 0, 0);
            if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
              WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x9Au, &WPPTraceGuidRelated);
            status = (*(WdfFunctions_01015[0] + WdfIoTargetCreate))(WdfDriverGlobals, WdfDevice, 0LL, &WdfIoTarget);
            status2 = status;
            if ( status >= 0 )
            {
              memset(WdfIoTargetOpenParams, 0, 0x88uLL);
              *&WdfIoTargetOpenParams[0] = 0x200000088LL;
              v13 = *TargetDeviceSymbolicName;
              *(&WdfIoTargetOpenParams[1] + 1) = sub_140002428;
              WdfIoTargetOpenParams[3] = v13;
              *&WdfIoTargetOpenParams[4] = 0x780000000LL;
              LODWORD(WdfIoTargetOpenParams[5]) = 64;
              status = (*(WdfFunctions_01015[0] + WdfIoTargetOpen))(
                         WdfDriverGlobals,
                         WdfIoTarget,
                         WdfIoTargetOpenParams);
              status2 = status;
              if ( status >= 0 )
              {
                WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 3u, 0x9Du, &WPPTraceGuidRelated);
                status = sub_140004314(WdfDevice, WdfIoTarget, &DeviceContext->gap1B0[24]);
                status2 = status;
                if ( status >= 0 )
                {
                  WdfIoTarget = 0LL;
                  goto LABEL_27;
                }
                v8 = 158;
              }
              else
              {
                WdfIoTarget = 0LL;
                v8 = 156;
              }
            }
            else
            {
              WdfIoTarget = 0LL;
              v8 = 155;
            }
          }
          else
          {
            v8 = 153;
          }
        }
        else
        {
          v8 = 152;
        }
      }
      else
      {
        v8 = 151;
      }
    }
    else
    {
      v8 = 150;
    }
  }
  else
  {
    v8 = 147;
  }
  LODWORD(unkn) = status;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v8, &WPPTraceGuidRelated, unkn);
LABEL_27:
  if ( status2 < 0 && WdfIoTarget )
  {
    (*(WdfFunctions_01015[0] + WdfIoTargetClose))(WdfDriverGlobals);
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, WdfIoTarget);
    WdfIoTarget = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(unkn) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x9Fu, &WPPTraceGuidRelated, unkn);
  }
  return status2;
}
// 140003FE0: variable 'unkn' is possibly undefined
// 1400040AE: variable 'PreparsedData' is possibly undefined
// 14000A1D0: using guessed type unsigned __int16 XPhysicalMaxStruct[4];
// 14000A1F8: using guessed type unsigned __int16 XLogicalMaxStruct[4];
// 14000A228: using guessed type unsigned __int16 YPhysicalMaxStruct[4];
// 14000A250: using guessed type unsigned __int16 YLogicalMaxStruct[4];
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140004314) ----------------------------------------------------
__int64 __fastcall sub_140004314(__int64 WdfDevice, __int64 WdfIoTarget, __int64 a3)
{
  int status; // edi
  unsigned __int16 v7; // r9
  __int128 v8; // xmm1
  __int128 v9; // xmm0
  __int128 v10; // xmm1
  __int128 v11; // xmm0
  __int128 v12; // xmm1
  unsigned __int16 v13; // di
  __int64 v14; // rdx
  __int64 v16; // [rsp+28h] [rbp-A1h]
  _QWORD v17[8]; // [rsp+40h] [rbp-89h] BYREF
  _OWORD HidSomethingInfoBuffer[6]; // [rsp+80h] [rbp-49h] BYREF

  memset(HidSomethingInfoBuffer, 0, sizeof(HidSomethingInfoBuffer));
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x64u, &WPPTraceGuidRelated);
  status = HidGetSomethingInfoFromDevice(WdfIoTarget, HidSomethingInfoBuffer);
  if ( status < 0 )
  {
    memset(HidSomethingInfoBuffer, 0, sizeof(HidSomethingInfoBuffer));
    v7 = 101;
LABEL_5:
    LODWORD(v16) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v7, &WPPTraceGuidRelated, v16);
    goto LABEL_16;
  }
  (*(WdfFunctions_01015[0] + WdfObjectAcquireLock))(WdfDriverGlobals, WdfDevice);
  if ( *a3 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, WdfDevice);
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x66u, &WPPTraceGuidRelated);
    goto LABEL_16;
  }
  v8 = HidSomethingInfoBuffer[1];
  *(a3 + 16) = HidSomethingInfoBuffer[0];
  v9 = HidSomethingInfoBuffer[2];
  *(a3 + 32) = v8;
  *(a3 + 8) = WdfIoTarget;
  v10 = HidSomethingInfoBuffer[3];
  *(a3 + 48) = v9;
  v11 = HidSomethingInfoBuffer[4];
  *(a3 + 64) = v10;
  v12 = HidSomethingInfoBuffer[5];
  *(a3 + 80) = v11;
  *(a3 + 96) = v12;
  memset(v17, 0, 0x38uLL);
  v17[3] = 0x100000001LL;
  LODWORD(v17[0]) = 56;
  v17[4] = WdfIoTarget;
  status = (*(WdfFunctions_01015[0] + WdfRequestCreate))(WdfDriverGlobals, v17, WdfIoTarget, a3 + 144);
  if ( status < 0 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, WdfDevice);
    *(a3 + 144) = 0LL;
    v7 = 103;
    goto LABEL_5;
  }
  v13 = *(a3 + 52);
  if ( v13 )
  {
    memset(v17, 0, 0x38uLL);
    v17[4] = WdfIoTarget;
    LODWORD(v17[0]) = 56;
    v17[3] = 0x100000001LL;
    status = (*(WdfFunctions_01015[0] + WdfMemoryCreate))(WdfDriverGlobals, v17, 512LL, 'DFDS', v13, a3 + 152, 0LL);
    if ( status < 0 )
    {
      (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, WdfDevice);
      *(a3 + 152) = 0LL;
      v7 = 105;
      goto LABEL_5;
    }
    *a3 = 1;
    KeSetEvent((a3 + 112), 0, 0);
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, WdfDevice);
LABEL_16:
    if ( status >= 0 )
      goto LABEL_23;
    goto LABEL_17;
  }
  (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, WdfDevice);
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x68u, &WPPTraceGuidRelated);
  status = 0xC0000023;
LABEL_17:
  v14 = *(a3 + 144);
  *a3 = 0;
  *(a3 + 8) = 0LL;
  if ( v14 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    *(a3 + 144) = 0LL;
  }
  if ( *(a3 + 152) )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    *(a3 + 152) = 0LL;
  }
  if ( *(a3 + 32) )
  {
    (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    *(a3 + 32) = 0LL;
    *(a3 + 40) = 0LL;
  }
LABEL_23:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v16) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x6Au, &WPPTraceGuidRelated, v16);
  }
  return status;
}
// 1400043CB: variable 'v16' is possibly undefined

//----- (00000001400046D0) ----------------------------------------------------
__int64 __fastcall WriteDriverRegistryValue(unsigned __int16 *ValueName, unsigned int Value)
{
  int v4; // eax
  unsigned int v5; // ebx
  int v6; // eax
  __int64 v8; // [rsp+28h] [rbp-50h]
  int v9; // [rsp+28h] [rbp-50h]
  unsigned int v10; // [rsp+30h] [rbp-48h]
  unsigned int v11; // [rsp+30h] [rbp-48h]
  int v12; // [rsp+38h] [rbp-40h]

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA8u, &WPPTraceGuidRelated);
  v4 = (*(WdfFunctions_01015[0] + WdfDriverOpenParametersRegistryKey))(WdfDriverGlobals, WdfDriverGlobals->Driver, 2LL);
  v5 = v4;
  if ( v4 >= 0 )
  {
    v6 = (*(WdfFunctions_01015[0] + WdfRegistryAssignULong))(WdfDriverGlobals, 0LL, ValueName, Value);
    v5 = v6;
    if ( v6 >= 0 )
    {
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        v11 = Value;
        WPPRelated8(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xABu, &WPPTraceGuidRelated, ValueName, v11);
      }
    }
    else
    {
      v12 = v6;
      v10 = Value;
      WPPRelated9(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0xAAu, &WPPTraceGuidRelated, ValueName, v10, v12);
    }
  }
  else
  {
    v9 = v4;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0xA9u, &WPPTraceGuidRelated, v9);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v8) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xACu, &WPPTraceGuidRelated, v8);
  }
  return v5;
}
// 140004853: variable 'v8' is possibly undefined

//----- (000000014000487C) ----------------------------------------------------
__int64 __fastcall ReadDriverRegistryValue(unsigned __int16 *ValueName, _DWORD *Value)
{
  int v4; // eax
  int v5; // ebx
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  unsigned __int8 v8; // dl
  __int64 v10; // [rsp+28h] [rbp-50h]
  int v11; // [rsp+30h] [rbp-48h]
  __int64 Key; // [rsp+40h] [rbp-38h] BYREF

  Key = 0LL;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA2u, &WPPTraceGuidRelated);
  v4 = (*(WdfFunctions_01015[0] + WdfDriverOpenParametersRegistryKey))(
         WdfDriverGlobals,
         WdfDriverGlobals->Driver,
         0x20019LL,
         0LL,
         &Key);
  v5 = v4;
  if ( v4 < 0 )
  {
    Key = 0LL;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0xA3u, &WPPTraceGuidRelated, v4);
    goto LABEL_13;
  }
  v5 = (*(WdfFunctions_01015[0] + WdfRegistryQueryULong))(WdfDriverGlobals, Key, ValueName, Value);
  if ( v5 >= 0 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPPRelated8(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA6u, &WPPTraceGuidRelated, ValueName, *Value);
  }
  else
  {
    if ( v5 == -1073741772 )
    {
      v6 = WPP_GLOBAL_Control;
      if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
        goto LABEL_13;
      v7 = 164;
      v11 = -1073741772;
      v8 = 5;
    }
    else
    {
      v6 = WPP_GLOBAL_Control;
      v7 = 165;
      v11 = v5;
      v8 = 2;
    }
    WPPRelated8(v6->DeviceExtension, v8, 3u, v7, &WPPTraceGuidRelated, ValueName, v11);
  }
LABEL_13:
  if ( Key )
  {
    (*(WdfFunctions_01015[0] + WdfRegistryClose))(WdfDriverGlobals);
    Key = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v5;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0xA7u, &WPPTraceGuidRelated, v10);
  }
  return v5;
}
// 140004A24: variable 'v10' is possibly undefined

//----- (0000000140004A4C) ----------------------------------------------------
__int64 __fastcall GetCoordinateValuesFromRegistry(
        _DWORD *pXPhysicalMax,
        _DWORD *pXLogicalMax,
        _DWORD *pYPhysicalMax,
        _DWORD *pYLogicalMax)
{
  int status; // eax
  unsigned int status2; // ebx
  unsigned __int16 v10; // r9
  __int64 v12; // [rsp+28h] [rbp-30h]
  int v13; // [rsp+28h] [rbp-30h]
  int XPhysicalMax; // [rsp+30h] [rbp-28h] BYREF
  int XLogicalMax; // [rsp+34h] [rbp-24h] BYREF
  int YPhysicalMax; // [rsp+38h] [rbp-20h] BYREF
  int YLogicalMax; // [rsp+3Ch] [rbp-1Ch] BYREF

  XPhysicalMax = 0;
  XLogicalMax = 0;
  YPhysicalMax = 0;
  YLogicalMax = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x59u, &WPPTraceGuidRelated);
  status = ReadDriverRegistryValue(XPhysicalMaxStruct, &XPhysicalMax);
  status2 = status;
  if ( status < 0 )
  {
    v10 = 90;
LABEL_5:
    v13 = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, v10, &WPPTraceGuidRelated, v13);
    goto LABEL_13;
  }
  status = ReadDriverRegistryValue(XLogicalMaxStruct, &XLogicalMax);
  status2 = status;
  if ( status < 0 )
  {
    v10 = 91;
    goto LABEL_5;
  }
  status = ReadDriverRegistryValue(YPhysicalMaxStruct, &YPhysicalMax);
  status2 = status;
  if ( status < 0 )
  {
    v10 = 92;
    goto LABEL_5;
  }
  status = ReadDriverRegistryValue(YLogicalMaxStruct, &YLogicalMax);
  status2 = status;
  if ( status < 0 )
  {
    v10 = 93;
    goto LABEL_5;
  }
  *pXPhysicalMax = XPhysicalMax;
  *pXLogicalMax = XLogicalMax;
  *pYPhysicalMax = YPhysicalMax;
  *pYLogicalMax = YLogicalMax;
LABEL_13:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v12) = status2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x5Eu, &WPPTraceGuidRelated, v12);
  }
  return status2;
}
// 140004BA2: variable 'v12' is possibly undefined
// 14000A1D0: using guessed type unsigned __int16 XPhysicalMaxStruct[4];
// 14000A1F8: using guessed type unsigned __int16 XLogicalMaxStruct[4];
// 14000A228: using guessed type unsigned __int16 YPhysicalMaxStruct[4];
// 14000A250: using guessed type unsigned __int16 YLogicalMaxStruct[4];

//----- (0000000140004BC8) ----------------------------------------------------
__int64 __fastcall RegisterCallBackForGuidDevInterfaceHidArrival(PVOID Device)
{
  struct_DeviceContext *DeviceContext; // rsi
  __int64 DeviceObject; // rax
  NTSTATUS status; // eax
  unsigned int status_0; // ebx
  PVOID v7; // [rsp+28h] [rbp-40h]
  PVOID NotificationEntry; // [rsp+40h] [rbp-28h] BYREF

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x75u, &WPPTraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  DeviceObject = (*(WdfFunctions_01015[0] + WdfDeviceWdmGetDeviceObject))(WdfDriverGlobals, Device);
  status = IoRegisterPlugPlayNotification(
             EventCategoryDeviceInterfaceChange,
             1u,
             &GUID_DEVINTERFACE_HID,
             *(DeviceObject + 8),
             HIDDeviceArrivalCallbackRoutine,
             Device,
             &NotificationEntry);
  status_0 = status;
  if ( status >= 0 )
  {
    (*(WdfFunctions_01015[0] + WdfObjectReferenceActual))(WdfDriverGlobals, Device, 0LL, 1496LL, "Device.cpp");
    *DeviceContext->IoPlugPlayNotificationEntry = NotificationEntry;
  }
  else
  {
    LODWORD(v7) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 3u, 0x76u, &WPPTraceGuidRelated, v7);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v7) = status_0;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 3u, 0x77u, &WPPTraceGuidRelated, v7);
  }
  return status_0;
}
// 140004CB0: variable 'v7' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140004D40) ----------------------------------------------------
__int64 WPP_SF_D(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-48h]
  va_list va; // [rsp+98h] [rbp+30h] BYREF

  va_start(va, a5);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9), 0x2Bu, a5, a4, va, 4LL, 0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 4LL);
}
// 140004DFE: variable 'v12' is possibly undefined

//----- (0000000140004E10) ----------------------------------------------------
__int64 WPPRelated7(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-48h]
  va_list va; // [rsp+98h] [rbp+30h] BYREF

  va_start(va, a5);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9), 0x2Bu, a5, a4, va, 8LL, 0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 8LL);
}
// 140004ECE: variable 'v12' is possibly undefined

//----- (0000000140004EE0) ----------------------------------------------------
__int64 __fastcall WPPRelated4(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        const wchar_t *a6)
{
  const wchar_t *v6; // rbp
  unsigned __int64 v10; // rsi
  __int64 v11; // rbx
  int v12; // eax
  __int64 v13; // rcx
  __int64 v14; // rcx
  const wchar_t *v15; // rax
  __int64 v16; // rbx
  int v18; // [rsp+20h] [rbp-48h]
  __int64 v19; // [rsp+70h] [rbp+8h]

  v19 = a1;
  v6 = L"NULL";
  v10 = a3 >> 16;
  v11 = -1LL;
  v12 = *(&WPP_GLOBAL_Control->Timer + 20 * v10 + (((a3 - 1) >> 5) & 0x7FF) + 1);
  if ( _bittest(&v12, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v10 + 1) >= a2 )
  {
    if ( a6 )
    {
      v13 = -1LL;
      do
        ++v13;
      while ( a6[v13] );
      v14 = v13 + 1;
    }
    else
    {
      v14 = 5LL;
    }
    v15 = L"NULL";
    if ( a6 )
      v15 = a6;
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v10), 0x2Bu, a5, a4, v15, 2 * v14, 0LL);
    a1 = v19;
  }
  if ( a6 )
  {
    do
      ++v11;
    while ( a6[v11] );
    v16 = v11 + 1;
  }
  else
  {
    v16 = 5LL;
  }
  if ( a6 )
    v6 = a6;
  LOWORD(v18) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v18, v6, 2 * v16);
}
// 140005009: variable 'v18' is possibly undefined
// 140009180: using guessed type wchar_t aNull[5];

//----- (000000014000502C) ----------------------------------------------------
__int64 WPPRelated8(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        unsigned __int16 *a6,
        ...)
{
  __int64 *v6; // rbp
  __int64 v7; // r11
  unsigned __int64 v10; // r9
  int v12; // eax
  __int64 v13; // r8
  const wchar_t *v14; // rdx
  __int64 *v15; // rax
  int v17; // [rsp+20h] [rbp-98h]
  va_list va; // [rsp+F0h] [rbp+38h] BYREF

  va_start(va, a6);
  v6 = qword_1400091A0;
  v7 = a1;
  v10 = a3 >> 16;
  v12 = *(&WPP_GLOBAL_Control->Timer + 20 * v10 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v12, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v10 + 1) >= a2 )
  {
    if ( a6 )
      v13 = *a6;
    else
      v13 = 8LL;
    if ( a6 )
      v14 = *(a6 + 1);
    else
      v14 = L"NULL";
    v15 = qword_1400091A0;
    if ( a6 )
      v15 = a6;
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v10),
      0x2Bu,
      a5,
      a4,
      v15,
      2LL,
      v14,
      v13,
      va,
      4LL,
      0LL);
    v7 = a1;
  }
  if ( a6 )
    v6 = a6;
  LOWORD(v17) = a4;
  return WppAutoLogTrace(v7, a2, a3, a5, v17, v6, 2LL);
}
// 140005187: variable 'v17' is possibly undefined
// 140009180: using guessed type wchar_t aNull[5];
// 1400091A0: using guessed type __int64 qword_1400091A0[2];

//----- (00000001400051A0) ----------------------------------------------------
__int64 WPPRelated9(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        unsigned __int16 *a6,
        ...)
{
  __int64 *v6; // rbp
  __int64 v7; // r11
  unsigned __int64 v10; // r9
  int v12; // eax
  __int64 v13; // r8
  const wchar_t *v14; // rdx
  __int64 *v15; // rax
  int v17; // [rsp+20h] [rbp-A8h]
  __int64 v19; // [rsp+100h] [rbp+38h] BYREF
  va_list va; // [rsp+100h] [rbp+38h]
  va_list va1; // [rsp+108h] [rbp+40h] BYREF

  va_start(va1, a6);
  va_start(va, a6);
  v19 = va_arg(va1, _QWORD);
  v6 = qword_1400091A0;
  v7 = a1;
  v10 = a3 >> 16;
  v12 = *(&WPP_GLOBAL_Control->Timer + 20 * v10 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v12, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v10 + 1) >= a2 )
  {
    if ( a6 )
      v13 = *a6;
    else
      v13 = 8LL;
    if ( a6 )
      v14 = *(a6 + 1);
    else
      v14 = L"NULL";
    v15 = qword_1400091A0;
    if ( a6 )
      v15 = a6;
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v10),
      0x2Bu,
      a5,
      a4,
      v15,
      2LL,
      v14,
      v13,
      va,
      4LL,
      va1,
      4LL,
      0LL);
    v7 = a1;
  }
  if ( a6 )
    v6 = a6;
  LOWORD(v17) = a4;
  return WppAutoLogTrace(v7, a2, a3, a5, v17, v6, 2LL);
}
// 14000532B: variable 'v17' is possibly undefined
// 140009180: using guessed type wchar_t aNull[5];
// 1400091A0: using guessed type __int64 qword_1400091A0[2];

//----- (0000000140005344) ----------------------------------------------------
__int64 __fastcall WPPRelated6(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        __int64 a6)
{
  unsigned __int64 v9; // rdi
  int v11; // eax
  int v13; // [rsp+20h] [rbp-38h]

  v9 = a3 >> 16;
  v11 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + (((a3 - 1) >> 5) & 0x7FF) + 1);
  if ( _bittest(&v11, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9), 0x2Bu, a5, a4, a6, 16LL, 0LL);
  LOWORD(v13) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v13, a6, 16LL);
}
// 140005411: variable 'v13' is possibly undefined

//----- (0000000140005430) ----------------------------------------------------
__int64 __fastcall WPPRelated3(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        __int64 a6,
        __int64 a7)
{
  unsigned __int64 v11; // r9
  int v12; // eax
  int v14; // [rsp+20h] [rbp-88h]
  __int64 v15; // [rsp+50h] [rbp-58h] BYREF
  __int64 v16; // [rsp+58h] [rbp-50h] BYREF

  v16 = a6;
  v15 = a7;
  v11 = a3 >> 16;
  v12 = *(&WPP_GLOBAL_Control->Timer + 20 * v11 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v12, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v11 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v11), 0x2Bu, a5, a4, &v16, 8LL, &v15, 8LL, 0LL);
  LOWORD(v14) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v14, &v16, 8LL);
}
// 14000552D: variable 'v14' is possibly undefined

//----- (000000014000554C) ----------------------------------------------------
__int64 __fastcall WppClassicProviderCallback(__int64 a1, unsigned __int8 a2, __int64 *a3, __int64 a4)
{
  __int64 result; // rax

  if ( a2 <= 1u )
  {
    result = 0LL;
    if ( a2 )
    {
      *(a4 + 44) = *(a3 + 1);
      *(a4 + 41) = *(a3 + 2);
      *(a4 + 24) = *a3;
      return imp_WppRecorderReplay();
    }
    else
    {
      *(a4 + 41) = 0;
      *(a4 + 44) = 0;
      *(a4 + 24) = 0LL;
    }
  }
  return result;
}

//----- (0000000140005590) ----------------------------------------------------
__int64 __fastcall QueueInitialize(__int64 Device)
{
  int v2; // eax
  unsigned int v3; // ebx
  __int64 v5; // [rsp+28h] [rbp-90h]
  _BYTE v6[16]; // [rsp+30h] [rbp-88h] BYREF
  _QWORD Dst[12]; // [rsp+40h] [rbp-78h] BYREF

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xAu, &WPP3TraceGuidRelated);
  (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(WdfDriverGlobals, Device, DeviceContextTypeInfo);
  memset(Dst, 0, sizeof(Dst));
  LODWORD(Dst[10]) = 0xFFFFFFFF;
  Dst[3] = EvtIoRead;
  Dst[0] = 0x200000060LL;
  Dst[5] = EvtIoDeviceControl;
  LODWORD(Dst[1]) = 2;
  BYTE5(Dst[1]) = 1;
  v2 = (*(WdfFunctions_01015[0] + WdfIoQueueCreate))(WdfDriverGlobals, Device, Dst, 0LL, v6);
  v3 = v2;
  if ( v2 < 0 )
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0xBu, &WPP3TraceGuidRelated, v2);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v5) = v3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xCu, &WPP3TraceGuidRelated, v5);
  }
  return v3;
}
// 1400056D0: variable 'v5' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140005700) ----------------------------------------------------
int __fastcall CompletionRoutine1_sub_140005700(
        __int64 WdfRequest,
        __int64 WdfIoTarget,
        _QWORD *WdfRequestCompletionParams)
{
  __int64 Device; // r12
  struct_DeviceContext *DeviceContext; // rdi
  struct _HIDP_PREPARSED_DATA *PreparsedData_1; // r13
  __int64 v9; // r8
  int result; // eax
  int status_1; // ebx
  PDEVICE_OBJECT v12; // rcx
  unsigned __int16 v13; // r9
  unsigned __int8 v14; // dl
  __int64 WdfMemory; // r15
  __int64 ReportLength_1; // r14
  int status_2; // eax
  CHAR *Report_1; // rsi
  NTSTATUS status; // eax
  unsigned __int16 v20; // ax
  unsigned __int16 v21; // r9
  NTSTATUS Usages; // eax
  ULONG v23; // r8d
  ULONG i; // edx
  ULONG v25; // edx
  ULONG j; // ecx
  signed __int32 v27; // eax
  int v28; // eax
  PHIDP_PREPARSED_DATA PreparsedData; // [rsp+28h] [rbp-61h]
  PCHAR Report; // [rsp+30h] [rbp-59h]
  PCHAR Reporta; // [rsp+30h] [rbp-59h]
  __int64 ReportLength; // [rsp+38h] [rbp-51h]
  __int64 Buffer; // [rsp+40h] [rbp-49h] BYREF
  __int64 WdfMemory_1; // [rsp+48h] [rbp-41h] BYREF
  _QWORD WdfObjectAttributes[7]; // [rsp+50h] [rbp-39h] BYREF
  ULONG UsageLength; // [rsp+88h] [rbp-1h] BYREF
  ULONG UsageValue; // [rsp+8Ch] [rbp+3h] BYREF
  USHORT UsageList; // [rsp+90h] [rbp+7h] BYREF
  __int64 v39; // [rsp+92h] [rbp+9h]

  WdfMemory_1 = 0LL;
  v39 = 0LL;
  Buffer = 0LL;
  UsageList = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x47u, &WPP3TraceGuidRelated);
  Device = (*(WdfFunctions_01015[0] + WdfIoTargetGetDevice))(WdfDriverGlobals, WdfIoTarget);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  PreparsedData_1 = *&DeviceContext->IoPlugPlayNotificationEntry[48];
  v9 = _InterlockedDecrement(DeviceContext->gap1B0);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x48u, &WPP3TraceGuidRelated, v9);
  result = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, WdfRequest, v9);
  status_1 = result;
  if ( result < 0 )
  {
    v12 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      goto LABEL_45;
    v13 = 73;
    LODWORD(PreparsedData) = result;
    v14 = 5;
    goto LABEL_8;
  }
  WdfMemory = WdfRequestCompletionParams[3];
  ReportLength_1 = WdfRequestCompletionParams[4];
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP3Related5(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      5u,
      0x4Au,
      &WPP3TraceGuidRelated,
      ReportLength_1,
      WdfRequestCompletionParams[5]);
  memset(WdfObjectAttributes, 0, sizeof(WdfObjectAttributes));
  WdfObjectAttributes[3] = 0x100000001LL;
  LODWORD(WdfObjectAttributes[0]) = 56;
  WdfObjectAttributes[4] = Device;
  status_2 = (*(WdfFunctions_01015[0] + WdfMemoryCreate))(
               WdfDriverGlobals,
               WdfObjectAttributes,
               512LL,
               'DFDS',
               8LL,
               &WdfMemory_1,
               &Buffer);
  status_1 = status_2;
  if ( status_2 < 0 )
  {
    WdfMemory_1 = 0LL;
    Buffer = 0LL;
    v13 = 75;
    LODWORD(PreparsedData) = status_2;
LABEL_13:
    v12 = WPP_GLOBAL_Control;
    v14 = 2;
LABEL_8:
    result = WPP_SF_D(v12->DeviceExtension, v14, 5u, v13, &WPP3TraceGuidRelated, PreparsedData);
    goto LABEL_45;
  }
  *Buffer = 0LL;
  *Buffer = 1;
  Report_1 = (*(WdfFunctions_01015[0] + WdfMemoryGetBuffer))(WdfDriverGlobals, WdfMemory, 0LL);
  status = HidP_GetUsageValue(HidP_Input, 1u, 0, 0x37u, &UsageValue, PreparsedData_1, Report_1, ReportLength_1);
  status_1 = status;
  if ( status < 0 )
  {
    v13 = 76;
    LODWORD(PreparsedData) = status;
    goto LABEL_13;
  }
  *(Buffer + 6) = UsageValue;
  v20 = *&DeviceContext->IoPlugPlayNotificationEntry[102];
  if ( v20 > 5u )
  {
    v21 = 77;
LABEL_18:
    LODWORD(Report) = v20;
    LODWORD(PreparsedData) = 5;
    result = WPP3Related(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v21, &WPP3TraceGuidRelated, PreparsedData, Report);
    status_1 = -1073741789;
    goto LABEL_45;
  }
  memset(&UsageList, 0, 2LL * v20);
  UsageLength = *&DeviceContext->IoPlugPlayNotificationEntry[102];
  Usages = HidP_GetUsages(HidP_Input, 9u, 0, &UsageList, &UsageLength, PreparsedData_1, Report_1, ReportLength_1);
  status_1 = Usages;
  if ( Usages < 0 )
  {
    v13 = 78;
LABEL_21:
    LODWORD(PreparsedData) = Usages;
    goto LABEL_13;
  }
  v23 = UsageLength;
  for ( i = 0; i < v23; ++i )
  {
    if ( *(&UsageList + i) == 1 )
    {
      *(Buffer + 4) = 1;
      v23 = UsageLength;
    }
  }
  v20 = *&DeviceContext->IoPlugPlayNotificationEntry[102];
  if ( v20 > 5u )
  {
    v21 = 79;
    goto LABEL_18;
  }
  memset(&UsageList, 0, 2LL * v20);
  UsageLength = *&DeviceContext->IoPlugPlayNotificationEntry[102];
  Usages = HidP_GetUsages(HidP_Input, 0xDu, 0, &UsageList, &UsageLength, PreparsedData_1, Report_1, ReportLength_1);
  status_1 = Usages;
  if ( Usages < 0 )
  {
    v13 = 80;
    goto LABEL_21;
  }
  v25 = UsageLength;
  for ( j = 0; j < v25; ++j )
  {
    if ( *(&UsageList + j) == 51 )
    {
      *(Buffer + 5) = 1;
      v25 = UsageLength;
    }
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(ReportLength) = *(Buffer + 5);
    LODWORD(Reporta) = *(Buffer + 4);
    LODWORD(PreparsedData) = *(Buffer + 6);
    WPP3Related2(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      5u,
      0x51u,
      &WPP3TraceGuidRelated,
      PreparsedData,
      Reporta,
      ReportLength);
  }
  v27 = _InterlockedCompareExchange(&DeviceContext->dword26C, 0, 0);
  if ( v27 < DeviceContext->dword270 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(Reporta) = DeviceContext->dword270;
      LODWORD(PreparsedData) = v27;
      WPP3Related(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x52u, &WPP3TraceGuidRelated, PreparsedData, Reporta);
    }
    *(Buffer + 6) = 0;
  }
  (*(WdfFunctions_01015[0] + WdfSpinLockAcquire))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
  status_1 = (*(WdfFunctions_01015[0] + WdfCollectionAdd))(WdfDriverGlobals, DeviceContext->WdfCollection, WdfMemory_1);
  (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
  if ( status_1 < 0 )
  {
    v13 = 83;
    LODWORD(PreparsedData) = status_1;
    goto LABEL_13;
  }
  WdfMemory_1 = 0LL;
  Buffer = 0LL;
  v28 = (*(WdfFunctions_01015[0] + WdfCollectionGetCount))(WdfDriverGlobals, DeviceContext->WdfCollection);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(PreparsedData) = v28;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x54u, &WPP3TraceGuidRelated, PreparsedData);
  }
  KeSetEvent(&DeviceContext->keventC8, 0, 0);
  result = KeSetEvent(&DeviceContext->kevent198, 0, 0);
LABEL_45:
  if ( WdfMemory_1 )
  {
    result = (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    WdfMemory_1 = 0LL;
    Buffer = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(PreparsedData) = status_1;
    return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x55u, &WPP3TraceGuidRelated, PreparsedData);
  }
  return result;
}
// 140005812: variable 'v9' is possibly undefined
// 140005850: variable 'PreparsedData' is possibly undefined
// 1400059FC: variable 'Report' is possibly undefined
// 140005B7A: variable 'Reporta' is possibly undefined
// 140005B7A: variable 'ReportLength' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140005D1C) ----------------------------------------------------
int __fastcall CompletionRoutine1_sub_140005D1C(
        __int64 WdfRequest,
        __int64 WdfIoTarget,
        _QWORD *WdfRequestCompletionParams)
{
  struct_DeviceContext *DeviceContext; // rbx
  struct _HIDP_PREPARSED_DATA *PreparsedData_1; // r14
  __int64 v8; // r8
  NTSTATUS Usages; // eax
  int status_1; // edi
  unsigned __int16 v11; // r9
  int result; // eax
  __int64 WdfMemory; // rdi
  __int64 v14; // r12
  CHAR *v15; // r13
  NTSTATUS v16; // eax
  unsigned __int16 v17; // r9
  unsigned __int16 v18; // r14
  unsigned __int16 v19; // ax
  unsigned __int16 v20; // si
  unsigned __int8 v21; // r12
  unsigned __int8 v22; // r13
  USHORT *p_UsageList; // rax
  __int64 v24; // rdx
  int v25; // ecx
  PDEVICE_OBJECT v26; // rcx
  signed __int32 v27; // eax
  __int32 v28; // ecx
  __int32 v29; // ecx
  int status; // eax
  int v31; // eax
  PHIDP_PREPARSED_DATA PreparsedData; // [rsp+28h] [rbp-91h]
  PHIDP_PREPARSED_DATA PreparsedDataa; // [rsp+28h] [rbp-91h]
  PCHAR Report; // [rsp+30h] [rbp-89h]
  PCHAR Reporta; // [rsp+30h] [rbp-89h]
  __int64 ReportLength; // [rsp+38h] [rbp-81h]
  __int64 v37; // [rsp+58h] [rbp-61h]
  struct _HIDP_PREPARSED_DATA *PreparsedData_2; // [rsp+60h] [rbp-59h]
  __int64 Device; // [rsp+68h] [rbp-51h]
  __int64 WdfMemory_1; // [rsp+70h] [rbp-49h] BYREF
  _QWORD *Buffer; // [rsp+78h] [rbp-41h] BYREF
  _QWORD WdfObjectAttributes[7]; // [rsp+80h] [rbp-39h] BYREF
  ULONG UsageValue; // [rsp+B8h] [rbp-1h] BYREF
  ULONG UsageLength; // [rsp+BCh] [rbp+3h] BYREF
  USHORT UsageList; // [rsp+C0h] [rbp+7h] BYREF
  __int64 v46; // [rsp+C2h] [rbp+9h]

  WdfMemory_1 = 0LL;
  v46 = 0LL;
  Buffer = 0LL;
  UsageList = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x56u, &WPP3TraceGuidRelated);
  Device = (*(WdfFunctions_01015[0] + WdfIoTargetGetDevice))(WdfDriverGlobals, WdfIoTarget);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  PreparsedData_1 = *&DeviceContext->gap1B0[64];
  PreparsedData_2 = PreparsedData_1;
  v8 = _InterlockedDecrement(DeviceContext->gap250);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x57u, &WPP3TraceGuidRelated, v8);
  Usages = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, WdfRequest, v8);
  status_1 = Usages;
  if ( Usages < 0 )
  {
    v11 = 88;
LABEL_7:
    LODWORD(PreparsedData) = Usages;
LABEL_8:
    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v11, &WPP3TraceGuidRelated, PreparsedData);
    goto LABEL_41;
  }
  WdfMemory = WdfRequestCompletionParams[3];
  v14 = WdfRequestCompletionParams[4];
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP3Related5(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      5u,
      0x59u,
      &WPP3TraceGuidRelated,
      v14,
      WdfRequestCompletionParams[5]);
  LODWORD(v37) = 2;
  v15 = (*(WdfFunctions_01015[0] + WdfMemoryGetBuffer))(WdfDriverGlobals, WdfMemory, 0LL);
  v16 = HidP_GetUsageValue(HidP_Input, 1u, 0, 0x30u, &UsageValue, PreparsedData_1, v15, v14);
  status_1 = v16;
  if ( v16 < 0 )
  {
    v17 = 90;
LABEL_13:
    LODWORD(PreparsedDataa) = v16;
    result = WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v17, &WPP3TraceGuidRelated, PreparsedDataa);
    goto LABEL_41;
  }
  v18 = UsageValue;
  WORD2(v37) = UsageValue;
  v16 = HidP_GetUsageValue(HidP_Input, 1u, 0, 0x31u, &UsageValue, PreparsedData_2, v15, v14);
  status_1 = v16;
  if ( v16 < 0 )
  {
    v17 = 91;
    goto LABEL_13;
  }
  v19 = *&DeviceContext->gap1B0[118];
  v20 = UsageValue;
  HIWORD(v37) = UsageValue;
  if ( v19 <= 5u )
  {
    memset(&UsageList, 0, 2LL * v19);
    UsageLength = *&DeviceContext->gap1B0[118];
    Usages = HidP_GetUsages(HidP_Input, 0xDu, 0, &UsageList, &UsageLength, PreparsedData_2, v15, v14);
    status_1 = Usages;
    if ( Usages < 0 )
    {
      v11 = 93;
      goto LABEL_7;
    }
    status_1 = 0;
    v21 = 0;
    v22 = 0;
    if ( UsageLength )
    {
      p_UsageList = &UsageList;
      v24 = UsageLength;
      do
      {
        v25 = *p_UsageList;
        if ( v25 == 66 )
        {
          v21 = 1;
        }
        else if ( v25 == 71 )
        {
          v22 = 1;
        }
        ++p_UsageList;
        --v24;
      }
      while ( v24 );
    }
    v26 = WPP_GLOBAL_Control;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(ReportLength) = v21;
      LODWORD(Reporta) = v20;
      LODWORD(PreparsedData) = v18;
      WPPRelated5(
        WPP_GLOBAL_Control->DeviceExtension,
        5u,
        5u,
        0x5Eu,
        &WPP3TraceGuidRelated,
        PreparsedData,
        Reporta,
        ReportLength,
        v22);
      v26 = WPP_GLOBAL_Control;
    }
    if ( !v21 )
    {
      if ( LOWORD(v26->DeviceType) )
      {
        WPP_RECORDER_SF_(v26->DeviceExtension, 5u, 5u, 0x5Fu, &WPP3TraceGuidRelated);
        v26 = WPP_GLOBAL_Control;
      }
      HIDWORD(v37) = -1;
      v18 = -1;
      v20 = -1;
    }
    if ( v22 )
    {
      if ( LOWORD(DeviceContext->dword268) == v18 && HIWORD(DeviceContext->dword268) == v20 )
      {
        if ( LOWORD(v26->DeviceType) )
          WPP_RECORDER_SF_(v26->DeviceExtension, 5u, 5u, 0x60u, &WPP3TraceGuidRelated);
        _InterlockedExchangeAdd(&DeviceContext->dword26C, 1u);
        v27 = _InterlockedCompareExchange(&DeviceContext->dword26C, 120, 121);
        if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
        {
          LODWORD(PreparsedData) = v27;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x61u, &WPP3TraceGuidRelated, PreparsedData);
        }
      }
      else
      {
        LOWORD(DeviceContext->dword268) = v18;
        HIWORD(DeviceContext->dword268) = v20;
        if ( v18 != 0xFFFF || (v28 = 120, v20 != 0xFFFF) )
          v28 = 0;
        v29 = _InterlockedExchange(&DeviceContext->dword26C, v28);
        if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
        {
          LODWORD(PreparsedData) = v29;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x62u, &WPP3TraceGuidRelated, PreparsedData);
        }
        memset(WdfObjectAttributes, 0, sizeof(WdfObjectAttributes));
        WdfObjectAttributes[4] = Device;
        LODWORD(WdfObjectAttributes[0]) = 56;
        WdfObjectAttributes[3] = 0x100000001LL;
        status = (*(WdfFunctions_01015[0] + WdfMemoryCreate))(
                   WdfDriverGlobals,
                   WdfObjectAttributes,
                   512LL,
                   'DFDS',
                   8LL,
                   &WdfMemory_1,
                   &Buffer);
        status_1 = status;
        if ( status < 0 )
        {
          WdfMemory_1 = 0LL;
          Buffer = 0LL;
          v11 = 99;
          LODWORD(PreparsedData) = status;
          goto LABEL_8;
        }
        *Buffer = 0LL;
        *Buffer = v37;
        (*(WdfFunctions_01015[0] + WdfSpinLockAcquire))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
        status_1 = (*(WdfFunctions_01015[0] + WdfCollectionAdd))(
                     WdfDriverGlobals,
                     DeviceContext->WdfCollection,
                     WdfMemory_1);
        (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
        if ( status_1 < 0 )
        {
          v11 = 100;
          LODWORD(PreparsedData) = status_1;
          goto LABEL_8;
        }
        WdfMemory_1 = 0LL;
        Buffer = 0LL;
        v31 = (*(WdfFunctions_01015[0] + WdfCollectionGetCount))(WdfDriverGlobals, DeviceContext->WdfCollection);
        if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
        {
          LODWORD(PreparsedData) = v31;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x65u, &WPP3TraceGuidRelated, PreparsedData);
        }
        KeSetEvent(&DeviceContext->keventC8, 0, 0);
      }
    }
    else if ( LOWORD(v26->DeviceType) )
    {
      WPP_RECORDER_SF_(v26->DeviceExtension, 5u, 5u, 0x66u, &WPP3TraceGuidRelated);
    }
    result = KeSetEvent(&DeviceContext->kevent238, 0, 0);
  }
  else
  {
    LODWORD(Report) = v19;
    LODWORD(PreparsedDataa) = 5;
    result = WPP3Related(
               WPP_GLOBAL_Control->DeviceExtension,
               2u,
               5u,
               0x5Cu,
               &WPP3TraceGuidRelated,
               PreparsedDataa,
               Report);
    status_1 = -1073741789;
  }
LABEL_41:
  if ( WdfMemory_1 )
  {
    result = (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals);
    WdfMemory_1 = 0LL;
    Buffer = 0LL;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(PreparsedData) = status_1;
    return WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x67u, &WPP3TraceGuidRelated, PreparsedData);
  }
  return result;
}
// 140005E2E: variable 'v8' is possibly undefined
// 140005E59: variable 'PreparsedData' is possibly undefined
// 140005F2B: variable 'PreparsedDataa' is possibly undefined
// 140005FC6: variable 'Report' is possibly undefined
// 1400060C2: variable 'Reporta' is possibly undefined
// 1400060C2: variable 'ReportLength' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140006450) ----------------------------------------------------
void __fastcall EvtIoDeviceControl(__int64 a1, __int64 a2, __int64 a3, __int64 a4, unsigned int IoControlCode)
{
  int status; // edi
  PDEVICE_OBJECT v10; // rbx
  const char *IoControlCodeString; // rax
  __int64 Device; // rbx
  struct_DeviceContext *pDeviceContext; // rbp
  __int64 v14; // rbx
  const char *IoControlCodeString2; // rax
  unsigned __int16 v16; // r9
  __int64 v17; // rax
  __int64 v18; // rdx
  int v19; // eax
  __int64 v20; // rax
  unsigned __int16 v21; // bx
  __int64 v22; // [rsp+28h] [rbp-90h]
  __int64 v23; // [rsp+30h] [rbp-88h]
  __int64 v24; // [rsp+38h] [rbp-80h]
  _QWORD v25[2]; // [rsp+60h] [rbp-58h] BYREF

  status = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x11u, &WPP3TraceGuidRelated);
    v10 = WPP_GLOBAL_Control;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      IoControlCodeString = GetHIDIoControlCodeString(IoControlCode);
      WPP3Related7(
        v10->DeviceExtension,
        5u,
        5u,
        0x12u,
        &WPP3TraceGuidRelated,
        a1,
        a2,
        a3,
        a4,
        IoControlCodeString,
        IoControlCode);
    }
  }
  Device = (*(WdfFunctions_01015[0] + WdfIoQueueGetDevice))(WdfDriverGlobals, a1);
  pDeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                     WdfDriverGlobals,
                     Device,
                     DeviceContextTypeInfo);
  v14 = (*(WdfFunctions_01015[0] + WdfDeviceGetIoTarget))(WdfDriverGlobals, Device);
  if ( IoControlCode != 0xB0193 )
  {
    if ( IoControlCode != 0xB01A2 )
    {
      (*(WdfFunctions_01015[0] + WdfRequestFormatRequestUsingCurrentType))(WdfDriverGlobals, a2);
      v25[1] = 0LL;
      v25[0] = 0x800000010LL;
      if ( (*(WdfFunctions_01015[0] + WdfRequestSend))(WdfDriverGlobals, a2, v14, v25) )
        goto LABEL_28;
      status = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, a2);
      IoControlCodeString2 = GetHIDIoControlCodeString(IoControlCode);
      LODWORD(v24) = status;
      LODWORD(v23) = IoControlCode;
      WPP3Related8(
        WPP_GLOBAL_Control->DeviceExtension,
        2u,
        5u,
        0x17u,
        &WPP3TraceGuidRelated,
        IoControlCodeString2,
        v23,
        v24);
LABEL_26:
      if ( status >= 0 )
        goto LABEL_28;
      goto LABEL_27;
    }
    if ( !pDeviceContext->hIncomingQueue )
      WPP2RelatedMacro(0, "EvtIoDeviceControl", 253, L"pDeviceContext->hIncomingQueue != NULL");
    (*(WdfFunctions_01015[0] + WdfSpinLockAcquire))(WdfDriverGlobals, pDeviceContext->IncomingQueueSpinLock);
    status = (*(WdfFunctions_01015[0] + WdfRequestForwardToIoQueue))(
               WdfDriverGlobals,
               a2,
               pDeviceContext->hIncomingQueue);
    (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, pDeviceContext->IncomingQueueSpinLock);
    if ( status >= 0 )
    {
      KeSetEvent(&pDeviceContext->SuccessfullyForwardedRequestToIoQueue, 0, 0);
      goto LABEL_26;
    }
    v16 = 22;
    LODWORD(v22) = status;
LABEL_20:
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v16, &WPP3TraceGuidRelated, v22);
    goto LABEL_26;
  }
  v25[0] = 0LL;
  if ( (*(WdfFunctions_01015[0] + WdfRequestGetRequestorMode))(WdfDriverGlobals, a2) != 1 )
  {
    v19 = (*(WdfFunctions_01015[0] + WdfRequestRetrieveOutputMemory))(WdfDriverGlobals, a2, v25);
    status = v19;
    if ( v19 < 0 )
    {
      v16 = 20;
LABEL_19:
      LODWORD(v22) = v19;
      goto LABEL_20;
    }
    v18 = v25[0];
LABEL_22:
    v20 = *&pDeviceContext->gap0[64];
    v21 = *(v20 + 26);
    if ( !v21
      || (v19 = (*(WdfFunctions_01015[0] + WdfMemoryCopyFromBuffer))(WdfDriverGlobals, v18, 0LL, *(v20 + 32), v21),
          status = v19,
          v19 >= 0) )
    {
      (*(WdfFunctions_01015[0] + WdfRequestCompleteWithInformation))(WdfDriverGlobals, a2, status, v21);
      goto LABEL_26;
    }
    v16 = 21;
    goto LABEL_19;
  }
  v17 = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(WdfDriverGlobals, a2, RequestContextTypeInfo);
  v18 = *(v17 + 8);
  if ( v18 )
  {
    v25[0] = *(v17 + 8);
    goto LABEL_22;
  }
  WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x13u, &WPP3TraceGuidRelated);
  status = -1073740951;
LABEL_27:
  (*(WdfFunctions_01015[0] + WdfRequestComplete))(WdfDriverGlobals, a2, status);
LABEL_28:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x18u, &WPP3TraceGuidRelated);
}
// 140006635: variable 'v23' is possibly undefined
// 140006635: variable 'v24' is possibly undefined
// 140006789: variable 'v22' is possibly undefined
// 1400091C0: using guessed type wchar_t aPdevicecontext[39];
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;
// 14000B048: using guessed type _UNKNOWN *RequestContextTypeInfo;

//----- (0000000140006860) ----------------------------------------------------
void __fastcall EvtIoRead(__int64 Queue, __int64 WdfRequest, __int64 a3)
{
  __int64 Device; // rax
  struct_DeviceContext *pDeviceContext; // rbx
  int v8; // esi
  __int64 v9; // [rsp+28h] [rbp-20h]

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xDu, &WPP3TraceGuidRelated);
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP3Related6(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0xEu, &WPP3TraceGuidRelated, Queue, WdfRequest, a3);
  }
  Device = (*(WdfFunctions_01015[0] + WdfIoQueueGetDevice))(WdfDriverGlobals, Queue);
  pDeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                     WdfDriverGlobals,
                     Device,
                     DeviceContextTypeInfo);
  if ( !pDeviceContext->hIncomingQueue )
    WPP2RelatedMacro(0, "EvtIoRead", 132, L"pDeviceContext->hIncomingQueue != NULL");
  (*(WdfFunctions_01015[0] + WdfSpinLockAcquire))(WdfDriverGlobals, pDeviceContext->IncomingQueueSpinLock);
  v8 = (*(WdfFunctions_01015[0] + WdfRequestForwardToIoQueue))(
         WdfDriverGlobals,
         WdfRequest,
         pDeviceContext->hIncomingQueue);
  (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, pDeviceContext->IncomingQueueSpinLock);
  if ( v8 >= 0 )
  {
    KeSetEvent(&pDeviceContext->SuccessfullyForwardedRequestToIoQueue, 0, 0);
  }
  else
  {
    LODWORD(v9) = v8;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0xFu, &WPP3TraceGuidRelated, v9);
    (*(WdfFunctions_01015[0] + WdfRequestComplete))(WdfDriverGlobals, WdfRequest, v8);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x10u, &WPP3TraceGuidRelated);
}
// 1400069BF: variable 'v9' is possibly undefined
// 1400091C0: using guessed type wchar_t aPdevicecontext[39];
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140006A38) ----------------------------------------------------
const char *__fastcall GetHIDIoControlCodeString(unsigned int IoControlCode)
{
  int v1; // ecx
  int v2; // ecx
  int v3; // ecx
  int v4; // ecx
  int v5; // ecx
  int v6; // ecx
  int v8; // ecx
  int v9; // ecx
  int v10; // ecx
  int v11; // ecx
  int v12; // ecx
  int v13; // ecx
  int v14; // ecx
  int v15; // ecx
  int v16; // ecx
  int v17; // ecx
  int v18; // ecx

  if ( IoControlCode <= 0xB01A8 )
  {
    if ( IoControlCode == 721320 )
      return "IOCTL_HID_GET_COLLECTION_INFORMATION";
    if ( IoControlCode > 0xB0198 )
    {
      v8 = IoControlCode - 721306;
      if ( !v8 )
        return "IOCTL_GET_PHYSICAL_DESCRIPTOR";
      v9 = v8 - 2;
      if ( !v9 )
        return "IOCTL_HID_SET_POLL_FREQUENCY_MSEC";
      v10 = v9 - 2;
      if ( !v10 )
        return "IOCTL_HID_GET_HARDWARE_ID";
      v11 = v10 - 2;
      if ( !v11 )
        return "IOCTL_GET_NUM_DEVICE_INPUT_BUFFERS";
      v12 = v11 - 2;
      if ( !v12 )
        return "IOCTL_HID_GET_INPUT_REPORT";
      if ( v12 == 2 )
        return "IOCTL_SET_NUM_DEVICE_INPUT_BUFFERS";
    }
    else
    {
      if ( IoControlCode == 721304 )
        return "IOCTL_HID_GET_POLL_FREQUENCY_MSEC";
      v1 = IoControlCode - 721296;
      if ( !v1 )
        return "IOCTL_HID_GET_DRIVER_CONFIG";
      v2 = v1 - 1;
      if ( !v2 )
        return "IOCTL_HID_SET_FEATURE";
      v3 = v2 - 1;
      if ( !v3 )
        return "IOCTL_HID_GET_FEATURE";
      v4 = v3 - 1;
      if ( !v4 )
        return "IOCTL_HID_GET_COLLECTION_DESCRIPTOR";
      v5 = v4 - 1;
      if ( !v5 )
        return "IOCTL_HID_SET_DRIVER_CONFIG";
      v6 = v5 - 1;
      if ( !v6 )
        return "IOCTL_HID_SET_OUTPUT_REPORT";
      if ( v6 == 2 )
        return "IOCTL_HID_FLUSH_QUEUE";
    }
    return "Unknown";
  }
  v13 = IoControlCode - 721338;
  if ( !v13 )
    return "IOCTL_HID_GET_MANUFACTURER_STRING";
  v14 = v13 - 4;
  if ( !v14 )
    return "IOCTL_HID_GET_PRODUCT_STRING";
  v15 = v14 - 4;
  if ( !v15 )
    return "IOCTL_HID_GET_SERIALNUMBER_STRING";
  v16 = v15 - 32;
  if ( !v16 )
    return "IOCTL_HID_GET_INDEXED_STRING";
  v17 = v16 - 4;
  if ( !v17 )
    return "IOCTL_HID_GET_MS_GENRE_DESCRIPTOR";
  v18 = v17 - 37;
  if ( !v18 )
    return "IOCTL_HID_ENABLE_SECURE_READ";
  if ( v18 != 4 )
    return "Unknown";
  return "IOCTL_HID_DISABLE_SECURE_READ";
}

//----- (0000000140006B80) ----------------------------------------------------
__int64 __fastcall PsCreateSystemThreadStartRoutine1_sub_140006B80(unsigned __int8 *a1, __int64 CompletionRoutine)
{
  unsigned int v3; // edi
  __int64 v5; // rdx
  int v6; // eax
  unsigned __int16 v7; // r9
  signed __int32 v8; // eax
  __int64 v10; // [rsp+28h] [rbp-70h]
  _QWORD v11[3]; // [rsp+50h] [rbp-48h] BYREF

  v3 = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x37u, &WPP3TraceGuidRelated);
  KeClearEvent((a1 + 112));
  if ( *a1 && *(a1 + 1) && (v5 = *(a1 + 18)) != 0 && *(a1 + 19) )
  {
    v11[0] = 24LL;
    v11[2] = 0LL;
    v11[1] = 0LL;
    v6 = (*(WdfFunctions_01015[0] + WdfRequestReuse))(WdfDriverGlobals, v5, v11);
    v3 = v6;
    if ( v6 < 0 )
    {
      v7 = 57;
LABEL_9:
      LODWORD(v10) = v6;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v7, &WPP3TraceGuidRelated, v10);
      goto LABEL_18;
    }
    v6 = (*(WdfFunctions_01015[0] + WdfIoTargetFormatRequestForRead))(
           WdfDriverGlobals,
           *(a1 + 1),
           *(a1 + 18),
           *(a1 + 19),
           0LL,
           0LL);
    v3 = v6;
    if ( v6 < 0 )
    {
      v7 = 58;
      goto LABEL_9;
    }
    (*(WdfFunctions_01015[0] + WdfRequestSetCompletionRoutine))(WdfDriverGlobals, *(a1 + 18), CompletionRoutine, 0LL);
    v8 = _InterlockedIncrement(a1 + 34);
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v10) = v8;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Bu, &WPP3TraceGuidRelated, v10);
    }
    if ( !(*(WdfFunctions_01015[0] + WdfRequestSend))(WdfDriverGlobals, *(a1 + 18), *(a1 + 1), 0LL) )
    {
      v6 = (*(WdfFunctions_01015[0] + WdfRequestGetStatus))(WdfDriverGlobals, *(a1 + 18));
      v3 = v6;
      v7 = 60;
      goto LABEL_9;
    }
  }
  else if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = *a1;
    WPP3Related4(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      5u,
      0x38u,
      &WPP3TraceGuidRelated,
      v10,
      *(a1 + 1),
      *(a1 + 18),
      *(a1 + 19));
  }
LABEL_18:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v10) = v3;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Du, &WPP3TraceGuidRelated, v10);
  }
  return v3;
}
// 140006C6B: variable 'v10' is possibly undefined

//----- (0000000140006DFC) ----------------------------------------------------
__int64 __fastcall HidSetSomeDataHmm(
        __int64 WdfRequest,
        unsigned __int8 *a2,
        unsigned __int16 *UsageValue,
        struct _HIDP_PREPARSED_DATA *PreParsedData,
        __int64 a5)
{
  NTSTATUS status; // eax
  unsigned int status_0; // ebx
  unsigned __int16 v11; // r9
  ULONG v12; // ecx
  ULONG v13; // ecx
  CHAR *v14; // rax
  PHIDP_PREPARSED_DATA v16; // [rsp+28h] [rbp-69h]
  int PreparsedData; // [rsp+28h] [rbp-69h]
  int Report; // [rsp+30h] [rbp-61h]
  CHAR *Reporta; // [rsp+30h] [rbp-61h]
  ULONG ReportLength; // [rsp+38h] [rbp-59h]
  ULONG ReportLengtha; // [rsp+38h] [rbp-59h]
  ULONG ReportLengthb; // [rsp+38h] [rbp-59h]
  int v23; // [rsp+40h] [rbp-51h]
  int v24; // [rsp+48h] [rbp-49h]
  ULONG UsageLength; // [rsp+50h] [rbp-41h] BYREF
  ULONG v26; // [rsp+54h] [rbp-3Dh] BYREF
  PCHAR ReportBuffer; // [rsp+58h] [rbp-39h] BYREF
  size_t Length; // [rsp+60h] [rbp-31h] BYREF
  USHORT UsageList; // [rsp+68h] [rbp-29h] BYREF
  __int64 v30; // [rsp+6Ah] [rbp-27h]
  __int64 v31; // [rsp+72h] [rbp-1Fh]
  __int16 v32; // [rsp+7Ah] [rbp-17h]
  USHORT v33; // [rsp+80h] [rbp-11h] BYREF
  __int64 v34; // [rsp+82h] [rbp-Fh]
  __int64 v35; // [rsp+8Ah] [rbp-7h]
  __int16 v36; // [rsp+92h] [rbp+1h]

  UsageList = 0;
  v30 = 0LL;
  v31 = 0LL;
  v32 = 0;
  v34 = 0LL;
  v35 = 0LL;
  v36 = 0;
  UsageLength = 0;
  v33 = 0;
  v26 = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x68u, &WPP3TraceGuidRelated);
  status = (*(WdfFunctions_01015[0] + WdfRequestRetrieveOutputBuffer))(
             WdfDriverGlobals,
             WdfRequest,
             *(a5 + 4),
             &ReportBuffer,
             &Length);
  status_0 = status;
  if ( status < 0 )
  {
    v11 = 105;
LABEL_5:
    LODWORD(v16) = status;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v11, &WPP3TraceGuidRelated, v16);
    goto LABEL_21;
  }
  memset(ReportBuffer, 0, Length);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    v24 = *(a2 + 2);
    v23 = *(a2 + 1);
    ReportLength = a2[1];
    Report = *a2;
    PreparsedData = *UsageValue;
    WPP3Related3(
      WPP_GLOBAL_Control->DeviceExtension,
      5u,
      5u,
      0x6Au,
      &WPP3TraceGuidRelated,
      PreparsedData,
      Report,
      ReportLength,
      v23,
      v24);
  }
  status = HidP_SetUsageValue(HidP_Input, 1u, 0, 0x37u, *UsageValue, PreParsedData, ReportBuffer, *(a5 + 4));
  status_0 = status;
  if ( status < 0 )
  {
    v11 = 107;
    goto LABEL_5;
  }
  status = HidP_SetUsageValue(HidP_Input, 1u, 0, 0x30u, *(a2 + 1), PreParsedData, ReportBuffer, *(a5 + 4));
  status_0 = status;
  if ( status < 0 )
  {
    v11 = 108;
    goto LABEL_5;
  }
  status = HidP_SetUsageValue(HidP_Input, 1u, 0, 0x31u, *(a2 + 2), PreParsedData, ReportBuffer, *(a5 + 4));
  status_0 = status;
  if ( status < 0 )
  {
    v11 = 109;
    goto LABEL_5;
  }
  if ( *a2 )
  {
    v12 = UsageLength;
    ReportLengtha = *(a5 + 4);
    Reporta = ReportBuffer;
    *(&UsageList + UsageLength) = 1;
    UsageLength = v12 + 1;
    status = HidP_SetUsages(HidP_Input, 9u, 0, &UsageList, &UsageLength, PreParsedData, Reporta, ReportLengtha);
    status_0 = status;
    if ( status < 0 )
    {
      v11 = 110;
      goto LABEL_5;
    }
  }
  status_0 = 0;
  if ( a2[1] )
  {
    v13 = v26;
    ReportLengthb = *(a5 + 4);
    v14 = ReportBuffer;
    *(&v33 + v26) = 51;
    v26 = v13 + 1;
    status = HidP_SetUsages(HidP_Input, 0xDu, 0, &v33, &v26, PreParsedData, v14, ReportLengthb);
    status_0 = status;
    if ( status < 0 )
    {
      v11 = 111;
      goto LABEL_5;
    }
    status_0 = 0;
  }
LABEL_21:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v16) = status_0;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x70u, &WPP3TraceGuidRelated, v16);
  }
  return status_0;
}
// 140006EEA: variable 'v16' is possibly undefined

//----- (0000000140007134) ----------------------------------------------------
__int64 __fastcall PsCreateSystemThreadStartRoutine2_sub_140007134(__int64 Device)
{
  unsigned int status_0; // edi
  struct_DeviceContext *DeviceContext; // rbx
  PDEVICE_OBJECT v4; // rcx
  unsigned __int16 v5; // r9
  int WdfCollectionCount; // eax
  int WdfCollectionCount_0; // esi
  __int64 OriginalWdfIoQueue2; // rax
  __int64 OriginalWdfIoQueue1; // rsi
  __int64 WdfMemory_0; // rax
  __int64 WdfCollection; // rdx
  __int64 WdfMemory; // r14
  PVOID MemoryBuffer; // rax
  int status; // eax
  int status_1; // eax
  __int64 v17; // [rsp+28h] [rbp-38h]
  __int64 v18; // [rsp+30h] [rbp-30h] BYREF
  __int64 v19; // [rsp+38h] [rbp-28h]
  __int64 WdfRequest; // [rsp+40h] [rbp-20h] BYREF
  int QueueRequests; // [rsp+48h] [rbp-18h] BYREF

  status_0 = 0;
  WdfRequest = 0LL;
  LOWORD(v18) = 0;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Eu, &WPP3TraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  (*(WdfFunctions_01015[0] + WdfSpinLockAcquire))(WdfDriverGlobals, DeviceContext->IncomingQueueSpinLock);
  (*(WdfFunctions_01015[0] + WdfSpinLockAcquire))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
  (*(WdfFunctions_01015[0] + WdfIoQueueGetState))(WdfDriverGlobals, DeviceContext->hIncomingQueue, &QueueRequests, 0LL);
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x3Fu, &WPP3TraceGuidRelated, QueueRequests, v18);
  if ( QueueRequests )
  {
    WdfCollectionCount = (*(WdfFunctions_01015[0] + WdfCollectionGetCount))(
                           WdfDriverGlobals,
                           DeviceContext->WdfCollection);
    WdfCollectionCount_0 = WdfCollectionCount;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      LODWORD(v17) = WdfCollectionCount;
      WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x41u, &WPP3TraceGuidRelated, v17);
    }
    if ( WdfCollectionCount_0 )
    {
      OriginalWdfIoQueue2 = DeviceContext->hOutgoingQueue;
      OriginalWdfIoQueue1 = DeviceContext->hIncomingQueue;
      DeviceContext->hOutgoingQueue = OriginalWdfIoQueue1;
      DeviceContext->hIncomingQueue = OriginalWdfIoQueue2;
      KeClearEvent(&DeviceContext->SuccessfullyForwardedRequestToIoQueue);
      WdfMemory_0 = (*(WdfFunctions_01015[0] + WdfCollectionGetFirstItem))(
                      WdfDriverGlobals,
                      DeviceContext->WdfCollection);
      WdfCollection = DeviceContext->WdfCollection;
      WdfMemory = WdfMemory_0;
      v19 = WdfMemory_0;
      (*(WdfFunctions_01015[0] + WdfCollectionRemoveItem))(WdfDriverGlobals, WdfCollection, 0LL);
      if ( !(*(WdfFunctions_01015[0] + WdfCollectionGetCount))(WdfDriverGlobals, DeviceContext->WdfCollection) )
        KeClearEvent(&DeviceContext->keventC8);
      (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
      (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->IncomingQueueSpinLock);
      MemoryBuffer = (*(WdfFunctions_01015[0] + WdfMemoryGetBuffer))(WdfDriverGlobals, WdfMemory, 0LL);
      if ( *MemoryBuffer == 1 )
      {
        *DeviceContext->gap27C = *(MemoryBuffer + 2);
        LOWORD(v18) = *(MemoryBuffer + 3);
      }
      else if ( *MemoryBuffer == 2 )
      {
        DeviceContext->dword27E = *(MemoryBuffer + 1);
      }
      else
      {
        LODWORD(v17) = *MemoryBuffer;
        WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x43u, &WPP3TraceGuidRelated, v17);
      }
      if ( OriginalWdfIoQueue1 )
      {
        if ( !(*(WdfFunctions_01015[0] + WdfIoQueueRetrieveNextRequest))(
                WdfDriverGlobals,
                OriginalWdfIoQueue1,
                &WdfRequest) )
        {
          do
          {
            status = HidSetSomeDataHmm(
                       WdfRequest,
                       DeviceContext->gap27C,
                       &v18,
                       *(*&DeviceContext->gap0[64] + 32LL),
                       &DeviceContext->gap0[72]);
            status_0 = status;
            if ( status < 0 )
            {
              LODWORD(v17) = status;
              WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x44u, &WPP3TraceGuidRelated, v17);
            }
            (*(WdfFunctions_01015[0] + WdfRequestCompleteWithInformation))(
              WdfDriverGlobals,
              WdfRequest,
              0LL,
              *&DeviceContext->gap0[76]);
            WdfRequest = 0LL;
          }
          while ( !(*(WdfFunctions_01015[0] + WdfIoQueueRetrieveNextRequest))(
                     WdfDriverGlobals,
                     OriginalWdfIoQueue1,
                     &WdfRequest) );
          WdfMemory = v19;
        }
        status_1 = 0;
        if ( status_0 != 0x8000001A )
          status_1 = status_0;
        status_0 = status_1;
        if ( status_1 < 0 )
        {
          LODWORD(v17) = status_1;
          WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x45u, &WPP3TraceGuidRelated, v17);
        }
      }
      if ( WdfMemory )
        (*(WdfFunctions_01015[0] + WdfObjectDelete))(WdfDriverGlobals, WdfMemory);
      goto LABEL_33;
    }
    (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
    (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->IncomingQueueSpinLock);
    KeClearEvent(&DeviceContext->keventC8);
    v4 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return status_0;
    v5 = 66;
  }
  else
  {
    (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->OutgoingQueueSpinLock);
    (*(WdfFunctions_01015[0] + WdfSpinLockRelease))(WdfDriverGlobals, DeviceContext->IncomingQueueSpinLock);
    KeClearEvent(&DeviceContext->SuccessfullyForwardedRequestToIoQueue);
    v4 = WPP_GLOBAL_Control;
    if ( !LOWORD(WPP_GLOBAL_Control->DeviceType) )
      return status_0;
    v5 = 64;
  }
  WPP_RECORDER_SF_(v4->DeviceExtension, 5u, 5u, v5, &WPP3TraceGuidRelated);
LABEL_33:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v17) = status_0;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x46u, &WPP3TraceGuidRelated, v17);
  }
  return status_0;
}
// 1400072F8: variable 'v17' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140007634) ----------------------------------------------------
void __fastcall PsCreateSystemThreadStartRoutine2(__int64 Device)
{
  NTSTATUS v1; // ebx
  char v3; // di
  struct_DeviceContext *DeviceContext; // rax
  int status; // eax
  unsigned __int16 v6; // r9
  NTSTATUS v7; // eax
  __int64 Alertable; // [rsp+28h] [rbp-31h]
  PVOID EventArrayForSuccessfullyForwardedRequestsToIoQueue[2]; // [rsp+60h] [rbp+7h] BYREF
  PVOID EventArray2[2]; // [rsp+70h] [rbp+17h] BYREF

  v1 = 0;
  *EventArrayForSuccessfullyForwardedRequestsToIoQueue = 0LL;
  *EventArray2 = 0LL;
  v3 = 1;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x27u, &WPP3TraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  EventArrayForSuccessfullyForwardedRequestsToIoQueue[1] = &DeviceContext->SuccessfullyForwardedRequestToIoQueue;
  EventArray2[1] = &DeviceContext->keventC8;
  EventArrayForSuccessfullyForwardedRequestsToIoQueue[0] = &DeviceContext->ReleasingHardwareEvent;
  EventArray2[0] = &DeviceContext->ReleasingHardwareEvent;
  while ( 1 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x2Cu, &WPP3TraceGuidRelated);
    status = KeWaitForMultipleObjects(
               2u,
               EventArrayForSuccessfullyForwardedRequestsToIoQueue,
               WaitAny,
               Executive,
               0,
               0,
               0LL,
               0LL);
    if ( !status )
    {
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 5u, 0x2Du, &WPP3TraceGuidRelated);
      v3 = 0;
LABEL_11:
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
        WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x30u, &WPP3TraceGuidRelated);
      goto LABEL_13;
    }
    if ( status != 1 )
    {
      v1 = status;
      v6 = 47;
      goto LABEL_24;
    }
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x2Eu, &WPP3TraceGuidRelated);
      goto LABEL_11;
    }
LABEL_13:
    status = KeWaitForMultipleObjects(2u, EventArray2, WaitAny, Executive, 0, 0, 0LL, 0LL);
    if ( !status )
    {
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 5u, 0x31u, &WPP3TraceGuidRelated);
      v3 = 0;
      goto LABEL_20;
    }
    if ( status != 1 )
      break;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x32u, &WPP3TraceGuidRelated);
    status = PsCreateSystemThreadStartRoutine2_sub_140007134(Device);
    v1 = status;
    if ( status < 0 )
    {
      v6 = 51;
      goto LABEL_24;
    }
LABEL_20:
    if ( !v3 )
      goto LABEL_25;
  }
  v1 = status;
  v6 = 52;
LABEL_24:
  LODWORD(Alertable) = status;
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v6, &WPP3TraceGuidRelated, Alertable);
LABEL_25:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(Alertable) = v1;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x35u, &WPP3TraceGuidRelated, Alertable);
  }
  v7 = PsTerminateSystemThread(v1);
  if ( v7 < 0 )
  {
    LODWORD(Alertable) = v7;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x36u, &WPP3TraceGuidRelated, Alertable);
  }
}
// 1400078AA: conditional instruction was optimized away because %var_70.8==0
// 1400078CF: conditional instruction was optimized away because %var_60.8==0
// 14000789E: variable 'Alertable' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140007974) ----------------------------------------------------
void __fastcall PsCreateSystemThreadStartRoutine1(PVOID Device)
{
  NTSTATUS SystemThreadStartRoutine1_sub_140006B80; // ebx
  char v3; // r14
  struct_DeviceContext *DeviceContext; // rsi
  NTSTATUS v5; // eax
  PDEVICE_OBJECT v6; // rcx
  unsigned __int16 v7; // r9
  unsigned __int16 v8; // r9
  NTSTATUS v9; // eax
  char Alertable[8]; // [rsp+28h] [rbp-48h]
  PVOID Object; // [rsp+50h] [rbp-20h] BYREF
  struct _KEVENT *v12; // [rsp+58h] [rbp-18h]
  struct _KEVENT *v13; // [rsp+60h] [rbp-10h]

  Object = 0LL;
  v12 = 0LL;
  SystemThreadStartRoutine1_sub_140006B80 = 0;
  v13 = 0LL;
  v3 = 1;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x19u, &WPP3TraceGuidRelated);
  DeviceContext = (*(WdfFunctions_01015[0] + WdfObjectGetTypedContextWorker))(
                    WdfDriverGlobals,
                    Device,
                    DeviceContextTypeInfo);
  Object = &DeviceContext->ReleasingHardwareEvent;
  v12 = &DeviceContext->kevent198;
  v13 = &DeviceContext->kevent238;
  while ( 1 )
  {
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x1Cu, &WPP3TraceGuidRelated);
    v5 = KeWaitForMultipleObjects(3u, &Object, WaitAny, Executive, 0, 0, 0LL, 0LL);
    if ( !v5 )
    {
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 4u, 5u, 0x1Du, &WPP3TraceGuidRelated);
      v3 = 0;
      goto LABEL_24;
    }
    if ( v5 == 1 )
      break;
    if ( v5 != 2 )
    {
      SystemThreadStartRoutine1_sub_140006B80 = v5;
      v8 = 36;
      *Alertable = v5;
      goto LABEL_30;
    }
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x21u, &WPP3TraceGuidRelated);
    (*(WdfFunctions_01015[0] + WdfObjectAcquireLock))(WdfDriverGlobals, Device);
    SystemThreadStartRoutine1_sub_140006B80 = PsCreateSystemThreadStartRoutine1_sub_140006B80(
                                                &DeviceContext->gap1B0[24],
                                                CompletionRoutine1_sub_140005D1C);
    (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, Device);
    if ( SystemThreadStartRoutine1_sub_140006B80 < 0 )
    {
      if ( SystemThreadStartRoutine1_sub_140006B80 != 0xC0000184 )
      {
        v8 = 35;
        goto LABEL_29;
      }
      v6 = WPP_GLOBAL_Control;
      if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
      {
        v7 = 34;
        goto LABEL_21;
      }
      goto LABEL_22;
    }
LABEL_24:
    if ( !v3 )
      goto LABEL_31;
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x1Eu, &WPP3TraceGuidRelated);
  (*(WdfFunctions_01015[0] + WdfObjectAcquireLock))(WdfDriverGlobals, Device);
  SystemThreadStartRoutine1_sub_140006B80 = PsCreateSystemThreadStartRoutine1_sub_140006B80(
                                              &DeviceContext->IoPlugPlayNotificationEntry[8],
                                              CompletionRoutine1_sub_140005700);
  (*(WdfFunctions_01015[0] + WdfObjectReleaseLock))(WdfDriverGlobals, Device);
  if ( SystemThreadStartRoutine1_sub_140006B80 >= 0 )
    goto LABEL_24;
  if ( SystemThreadStartRoutine1_sub_140006B80 == 0xC0000184 )
  {
    v6 = WPP_GLOBAL_Control;
    if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    {
      v7 = 31;
LABEL_21:
      WPP_RECORDER_SF_(v6->DeviceExtension, 5u, 5u, v7, &WPP3TraceGuidRelated);
    }
LABEL_22:
    SystemThreadStartRoutine1_sub_140006B80 = 0;
    goto LABEL_24;
  }
  v8 = 32;
LABEL_29:
  *Alertable = SystemThreadStartRoutine1_sub_140006B80;
LABEL_30:
  WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, v8, &WPP3TraceGuidRelated, *Alertable);
LABEL_31:
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    *Alertable = SystemThreadStartRoutine1_sub_140006B80;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 5u, 0x25u, &WPP3TraceGuidRelated, *Alertable);
  }
  v9 = PsTerminateSystemThread(SystemThreadStartRoutine1_sub_140006B80);
  if ( v9 < 0 )
  {
    *Alertable = v9;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 5u, 0x26u, &WPP3TraceGuidRelated, *Alertable);
  }
}
// 140007C54: conditional instruction was optimized away because %var_30.8==0
// 140007C48: variable 'Alertable' is possibly undefined
// 14000B020: using guessed type _UNKNOWN *DeviceContextTypeInfo;

//----- (0000000140007CF8) ----------------------------------------------------
__int64 WPP3Related(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-68h]
  __int64 v13; // [rsp+B8h] [rbp+30h] BYREF
  va_list va; // [rsp+B8h] [rbp+30h]
  va_list va1; // [rsp+C0h] [rbp+38h] BYREF

  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9), 0x2Bu, a5, a4, va, 4LL, va1, 4LL, 0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 4LL);
}
// 140007DD3: variable 'v12' is possibly undefined

//----- (0000000140007DE8) ----------------------------------------------------
__int64 WPP3Related2(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-78h]
  __int64 v13; // [rsp+C8h] [rbp+30h] BYREF
  va_list va; // [rsp+C8h] [rbp+30h]
  char v15[8]; // [rsp+D0h] [rbp+38h] BYREF
  va_list va1; // [rsp+D0h] [rbp+38h]
  va_list va2; // [rsp+D8h] [rbp+40h] BYREF

  va_start(va2, a5);
  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  *v15 = va_arg(va2, _QWORD);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9),
      0x2Bu,
      a5,
      a4,
      va,
      4LL,
      va1,
      4LL,
      va2,
      4LL,
      0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 4LL);
}
// 140007EE1: variable 'v12' is possibly undefined

//----- (0000000140007EF4) ----------------------------------------------------
__int64 WPPRelated5(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-88h]
  __int64 v13; // [rsp+D8h] [rbp+30h] BYREF
  va_list va; // [rsp+D8h] [rbp+30h]
  char v15[8]; // [rsp+E0h] [rbp+38h] BYREF
  va_list va1; // [rsp+E0h] [rbp+38h]
  __int64 v17; // [rsp+E8h] [rbp+40h] BYREF
  va_list va2; // [rsp+E8h] [rbp+40h]
  va_list va3; // [rsp+F0h] [rbp+48h] BYREF

  va_start(va3, a5);
  va_start(va2, a5);
  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  *v15 = va_arg(va2, _QWORD);
  va_copy(va3, va2);
  v17 = va_arg(va3, _QWORD);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9),
      0x2Bu,
      a5,
      a4,
      va,
      4LL,
      va1,
      4LL,
      va2,
      4LL,
      va3,
      4LL,
      0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 4LL);
}
// 14000800C: variable 'v12' is possibly undefined

//----- (0000000140008020) ----------------------------------------------------
__int64 WPP3Related3(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-98h]
  __int64 v13; // [rsp+E8h] [rbp+30h] BYREF
  va_list va; // [rsp+E8h] [rbp+30h]
  char v15[8]; // [rsp+F0h] [rbp+38h] BYREF
  va_list va1; // [rsp+F0h] [rbp+38h]
  __int64 v17; // [rsp+F8h] [rbp+40h] BYREF
  va_list va2; // [rsp+F8h] [rbp+40h]
  __int64 v19; // [rsp+100h] [rbp+48h] BYREF
  va_list va3; // [rsp+100h] [rbp+48h]
  va_list va4; // [rsp+108h] [rbp+50h] BYREF

  va_start(va4, a5);
  va_start(va3, a5);
  va_start(va2, a5);
  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  va_copy(va2, va1);
  *v15 = va_arg(va2, _QWORD);
  va_copy(va3, va2);
  v17 = va_arg(va3, _QWORD);
  va_copy(va4, va3);
  v19 = va_arg(va4, _QWORD);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9),
      0x2Bu,
      a5,
      a4,
      va,
      4LL,
      va1,
      4LL,
      va2,
      4LL,
      va3,
      4LL,
      va4,
      4LL,
      0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 4LL);
}
// 14000815B: variable 'v12' is possibly undefined

//----- (0000000140008170) ----------------------------------------------------
__int64 __fastcall WPP3Related4(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        __int64 a6,
        __int64 a7,
        __int64 a8,
        __int64 a9)
{
  unsigned __int64 v13; // r9
  int v14; // eax
  int v16; // [rsp+28h] [rbp-69h]
  __int64 v17; // [rsp+78h] [rbp-19h] BYREF
  __int64 v18; // [rsp+80h] [rbp-11h] BYREF
  __int64 v19; // [rsp+88h] [rbp-9h] BYREF

  v19 = a7;
  v18 = a8;
  v13 = a3 >> 16;
  v17 = a9;
  v14 = *(&WPP_GLOBAL_Control->Timer + 20 * v13 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v14, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v13 + 1) >= a2 )
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v13),
      0x2Bu,
      a5,
      a4,
      &a6,
      4LL,
      &v19,
      8LL,
      &v18,
      8LL,
      &v17,
      8LL,
      0LL);
  LOWORD(v16) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v16, &a6, 4LL);
}
// 1400082B3: variable 'v16' is possibly undefined

//----- (00000001400082D8) ----------------------------------------------------
__int64 WPP3Related5(__int64 a1, unsigned __int8 a2, unsigned int a3, unsigned __int16 a4, const _GUID *a5, ...)
{
  unsigned __int64 v9; // r9
  int v10; // eax
  int v12; // [rsp+20h] [rbp-68h]
  __int64 v13; // [rsp+B8h] [rbp+30h] BYREF
  va_list va; // [rsp+B8h] [rbp+30h]
  va_list va1; // [rsp+C0h] [rbp+38h] BYREF

  va_start(va1, a5);
  va_start(va, a5);
  v13 = va_arg(va1, _QWORD);
  v9 = a3 >> 16;
  v10 = *(&WPP_GLOBAL_Control->Timer + 20 * v9 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v10, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v9 + 1) >= a2 )
    pfnWppTraceMessage(*(&WPP_GLOBAL_Control->AttachedDevice + 10 * v9), 0x2Bu, a5, a4, va, 8LL, va1, 8LL, 0LL);
  LOWORD(v12) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v12, va, 8LL);
}
// 1400083B3: variable 'v12' is possibly undefined

//----- (00000001400083C8) ----------------------------------------------------
__int64 WPP3Related6(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        __int64 a6,
        __int64 a7,
        ...)
{
  unsigned __int64 v11; // r9
  int v12; // eax
  int v14; // [rsp+20h] [rbp-98h]
  __int64 v15; // [rsp+60h] [rbp-58h] BYREF
  __int64 v16; // [rsp+68h] [rbp-50h] BYREF
  va_list va; // [rsp+F8h] [rbp+40h] BYREF

  va_start(va, a7);
  v16 = a6;
  v15 = a7;
  v11 = a3 >> 16;
  v12 = *(&WPP_GLOBAL_Control->Timer + 20 * v11 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v12, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v11 + 1) >= a2 )
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v11),
      0x2Bu,
      a5,
      a4,
      &v16,
      8LL,
      &v15,
      8LL,
      va,
      8LL,
      0LL);
  LOWORD(v14) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v14, &v16, 8LL);
}
// 1400084E8: variable 'v14' is possibly undefined

//----- (000000014000850C) ----------------------------------------------------
__int64 WPP3Related7(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        __int64 a6,
        __int64 a7,
        __int64 a8,
        __int64 a9,
        const char *a10,
        ...)
{
  __int64 v10; // r10
  const char *v12; // rdi
  __int64 v13; // rbx
  unsigned __int64 v16; // r9
  unsigned __int16 v17; // r8
  unsigned __int64 v18; // r9
  int v19; // eax
  __int64 v20; // rcx
  __int64 v21; // rcx
  const char *v22; // rax
  int v24; // [rsp+20h] [rbp-91h]
  __int64 v26; // [rsp+98h] [rbp-19h] BYREF
  __int64 v27; // [rsp+A0h] [rbp-11h] BYREF
  va_list va; // [rsp+150h] [rbp+9Fh] BYREF

  va_start(va, a10);
  v10 = a1;
  v12 = a10;
  v13 = -1LL;
  v16 = a3;
  v27 = a6;
  v17 = a3 - 1;
  v18 = v16 >> 16;
  v26 = a7;
  v19 = *(&WPP_GLOBAL_Control->Timer + 20 * v18 + (v17 >> 5) + 1);
  if ( _bittest(&v19, v17 & 0x1F) )
  {
    if ( *(&WPP_GLOBAL_Control->Timer + 80 * v18 + 1) >= a2 )
    {
      if ( a10 )
      {
        v20 = -1LL;
        do
          ++v20;
        while ( a10[v20] );
        v21 = v20 + 1;
      }
      else
      {
        v21 = 5LL;
      }
      v22 = "NULL";
      if ( a10 )
        v22 = a10;
      pfnWppTraceMessage(
        *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v18),
        0x2Bu,
        a5,
        a4,
        &v27,
        8LL,
        &v26,
        8LL,
        &a8,
        8LL,
        &a9,
        8LL,
        v22,
        v21,
        va,
        4LL,
        0LL);
    }
    v10 = a1;
  }
  if ( v12 )
  {
    do
      ++v13;
    while ( v12[v13] );
  }
  LOWORD(v24) = a4;
  return WppAutoLogTrace(v10, a2, a3, a5, v24, &v27, 8LL);
}
// 140008703: variable 'v24' is possibly undefined

//----- (0000000140008728) ----------------------------------------------------
__int64 WPP3Related8(
        __int64 a1,
        unsigned __int8 a2,
        unsigned int a3,
        unsigned __int16 a4,
        const _GUID *a5,
        const char *a6,
        ...)
{
  const char *v6; // rsi
  __int64 v10; // rbx
  unsigned __int64 v12; // r9
  int v13; // eax
  __int64 v14; // rcx
  __int64 v15; // rcx
  const char *v16; // rax
  __int64 v17; // rbx
  int v19; // [rsp+20h] [rbp-88h]
  char v20[8]; // [rsp+E0h] [rbp+38h] BYREF
  va_list va; // [rsp+E0h] [rbp+38h]
  va_list va1; // [rsp+E8h] [rbp+40h] BYREF

  va_start(va1, a6);
  va_start(va, a6);
  *v20 = va_arg(va1, _QWORD);
  v6 = "NULL";
  v10 = -1LL;
  v12 = a3 >> 16;
  v13 = *(&WPP_GLOBAL_Control->Timer + 20 * v12 + ((a3 - 1) >> 5) + 1);
  if ( _bittest(&v13, (a3 - 1) & 0x1F) && *(&WPP_GLOBAL_Control->Timer + 80 * v12 + 1) >= a2 )
  {
    if ( a6 )
    {
      v14 = -1LL;
      do
        ++v14;
      while ( a6[v14] );
      v15 = v14 + 1;
    }
    else
    {
      v15 = 5LL;
    }
    v16 = "NULL";
    if ( a6 )
      v16 = a6;
    pfnWppTraceMessage(
      *(&WPP_GLOBAL_Control->AttachedDevice + 10 * v12),
      0x2Bu,
      a5,
      a4,
      v16,
      v15,
      va,
      4LL,
      va1,
      4LL,
      0LL);
  }
  if ( a6 )
  {
    do
      ++v10;
    while ( a6[v10] );
    v17 = v10 + 1;
  }
  else
  {
    v17 = 5LL;
  }
  if ( a6 )
    v6 = a6;
  LOWORD(v19) = a4;
  return WppAutoLogTrace(a1, a2, a3, a5, v19, v6, v17);
}
// 14000888B: variable 'v19' is possibly undefined

//----- (0000000140008908) ----------------------------------------------------
char __fastcall _GSHandlerCheckCommon(__int64 a1, __int64 a2)
{
  char result; // al

  result = *(*(a2 + 8) + *(*(a2 + 16) + 8LL) + 3LL);
  if ( (result & 0xF) != 0 )
    return *(*(a2 + 8) + *(*(a2 + 16) + 8LL) + 3LL) & 0xF0;
  return result;
}

//----- (0000000140008970) ----------------------------------------------------
__int64 FxStubDriverUnloadCommon()
{
  FxStubUnbindClasses(&unk_14000B070);
  return WdfVersionUnbind(&unk_14000B168, &unk_14000B070, WdfDriverGlobals);
}
// 140008CEE: using guessed type __int64 __fastcall WdfVersionUnbind(_QWORD, _QWORD, _QWORD);

//----- (00000001400089CC) ----------------------------------------------------
NTSTATUS __stdcall FxDriverEntryWorker(_DRIVER_OBJECT *DriverObject, PUNICODE_STRING RegistryPath)
{
  NTSTATUS result; // eax
  NTSTATUS inited; // ebx
  PDRIVER_UNLOAD DriverUnload; // rax

  if ( !DriverObject )
    return DriverEntry(0LL, RegistryPath);
  qword_14000B190 = DriverObject;
  qword_14000B170 = &unk_14000B1A0;
  *&unk_14000B168.Length = 34078720;
  RtlCopyUnicodeString(&unk_14000B168, RegistryPath);
  result = WdfVersionBind_0(DriverObject, &unk_14000B168, &unk_14000B070, &WdfDriverGlobals);
  if ( result >= 0 )
  {
    WdfDriverMiniportUnloadOverride = *(WdfFunctions_01015[0] + WdfDriverMiniportUnload);
    inited = FxStubBindClasses(&unk_14000B070);
    if ( inited < 0
      || (inited = FxStubInitTypes(), inited < 0)
      || (inited = DriverEntry(DriverObject, RegistryPath), inited < 0) )
    {
      FxStubDriverUnloadCommon();
      return inited;
    }
    else
    {
      if ( WdfDriverGlobals->DisplaceDriverUnload )
      {
        DriverUnload = qword_14000B178;
        if ( DriverObject->DriverUnload )
          DriverUnload = DriverObject->DriverUnload;
        qword_14000B178 = DriverUnload;
        DriverObject->DriverUnload = FxStubDriverUnload;
      }
      else if ( (WdfDriverGlobals->DriverFlags & 2) != 0 )
      {
        WdfDriverMiniportUnloadOverride = j_FxStubDriverUnloadCommon;
      }
      return 0;
    }
  }
  return result;
}
// 140008CE8: using guessed type __int64 __fastcall WdfVersionBind_0(_QWORD, _QWORD, _QWORD, _QWORD);
// 14000B170: using guessed type __int64 qword_14000B170;
// 14000B178: using guessed type __int64 (__fastcall *qword_14000B178)(_QWORD, _QWORD, _QWORD, _QWORD);
// 14000B190: using guessed type __int64 qword_14000B190;

//----- (0000000140008AFC) ----------------------------------------------------
__int64 __fastcall FxStubDriverUnload(struct _DEVICE_OBJECT *a1, __int64 a2, void *a3, void *a4)
{
  if ( qword_14000B178 && qword_14000B178 != FxStubDriverUnload )
    qword_14000B178(a1, FxStubDriverUnload, a3, a4);
  return FxStubDriverUnloadCommon();
}
// 14000B178: using guessed type __int64 (__fastcall *qword_14000B178)(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000140008B24) ----------------------------------------------------
__int64 FxStubInitTypes()
{
  if ( &unk_14000B0C0 <= &unk_14000B0D0 )
    return 0LL;
  else
    return 0xC000007BLL;
}
// 14000B0F0: using guessed type __int64 (*pfnEtwUnregister)(void);

//----- (0000000140008B90) ----------------------------------------------------
__int64 __fastcall FxStubBindClasses(__int64 a1)
{
  __int64 result; // rax
  _QWORD *i; // rbx
  __int64 (__fastcall *v4)(__int64 (__fastcall *)(__int64, __int64, __int64), __int64, PWDF_DRIVER_GLOBALS, _QWORD *); // rax

  result = 0LL;
  if ( &_KMDF_CLASS_BIND_START > &_KMDF_CLASS_BIND_END )
    return 3221225595LL;
  for ( i = &_KMDF_CLASS_BIND_END; i < &_KMDF_CLASS_BIND_END; i += 10 )
  {
    if ( *i != 80 )
      return 3221225476LL;
    v4 = i[7];
    off_14000B0B8 = i;
    if ( v4 )
      result = v4(WdfVersionBindClass, a1, WdfDriverGlobals, i);
    else
      result = WdfVersionBindClass(a1, WdfDriverGlobals, i);
    if ( result < 0 )
      return result;
  }
  return result;
}
// 14000B0B0: using guessed type _QWORD _KMDF_CLASS_BIND_END;
// 14000B0B8: using guessed type _UNKNOWN *off_14000B0B8;

//----- (0000000140008C28) ----------------------------------------------------
void *__fastcall FxStubUnbindClasses(__int64 a1)
{
  void *result; // rax
  _QWORD *v2; // rbx
  __int64 (__fastcall *v4)(__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD), __int64, PWDF_DRIVER_GLOBALS, _QWORD *); // rax

  result = off_14000B0B8;
  v2 = &_KMDF_CLASS_BIND_END;
  if ( off_14000B0B8 != &_KMDF_CLASS_BIND_START && &_KMDF_CLASS_BIND_END <= off_14000B0B8 )
  {
    do
    {
      v4 = v2[8];
      if ( v4 )
        result = v4(WdfVersionUnbindClass, a1, WdfDriverGlobals, v2);
      else
        result = WdfVersionUnbindClass(a1, WdfDriverGlobals, v2);
      v2 += 10;
    }
    while ( v2 <= off_14000B0B8 );
  }
  return result;
}
// 140008CFA: using guessed type __int64 __fastcall WdfVersionUnbindClass(_QWORD, _QWORD, _QWORD);
// 14000B0B0: using guessed type _QWORD _KMDF_CLASS_BIND_END;
// 14000B0B8: using guessed type _UNKNOWN *off_14000B0B8;

//----- (000000014000E000) ----------------------------------------------------
void __fastcall EvtDriverContextCleanup(__int64 a1)
{
  PDEVICE_OBJECT v2; // rcx
  __int64 v3; // rax

  v2 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x14u, &traceGuid);
    v2 = WPP_GLOBAL_Control;
  }
  WPP_RECORDER_SF_(v2->DeviceExtension, 4u, 4u, 0x15u, &traceGuid);
  v3 = (*(WdfFunctions_01015[0] + WdfDriverWdmGetDriverObject))(WdfDriverGlobals, a1);
  WppCleanupKm(v3);
}

//----- (000000014000E088) ----------------------------------------------------
__int64 __fastcall EvtDeviceAdd(__int64 a1, __int64 a2)
{
  int Device; // eax
  unsigned int Device_2; // ebx
  __int64 v6; // [rsp+28h] [rbp-10h]
  int v7; // [rsp+28h] [rbp-10h]

  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x11u, &traceGuid);
  Device = CreateDevice(a2);
  Device_2 = Device;
  if ( Device < 0 )
  {
    v7 = Device;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 2u, 4u, 0x12u, &traceGuid, v7);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v6) = Device_2;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x13u, &traceGuid, v6);
  }
  return Device_2;
}
// 14000E121: variable 'v6' is possibly undefined

//----- (000000014000E138) ----------------------------------------------------
void __fastcall WppCleanupKm(__int64 a1)
{
  PDEVICE_OBJECT v1; // rbx

  v1 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != &WPP_GLOBAL_Control )
  {
    if ( WPPTraceSuite == 4 )
    {
      if ( WPP_GLOBAL_Control )
      {
        do
        {
          if ( v1->Vpb )
            pfnEtwUnregister();
          v1 = v1->NextDevice;
        }
        while ( v1 );
        goto LABEL_10;
      }
    }
    else if ( WPPTraceSuite == 2 )
    {
      IoWMIRegistrationControl(WPP_GLOBAL_Control, 0x80000002);
LABEL_10:
      v1 = WPP_GLOBAL_Control;
    }
    WppAutoLogStop(v1, a1);
    WPP_GLOBAL_Control = &WPP_GLOBAL_Control;
  }
}
// 14000B0F0: using guessed type __int64 (*pfnEtwUnregister)(void);
// 14000B108: using guessed type int WPPTraceSuite;

//----- (000000014000E1C4) ----------------------------------------------------
void __fastcall WppInitKm(__int64 a1, __int64 a2)
{
  _UNKNOWN **v2; // rbx
  void *v5; // rcx

  v2 = &WPP_MAIN_CB;
  if ( WPP_GLOBAL_Control != &WPP_MAIN_CB )
  {
    WPP_GLOBAL_Control = &WPP_MAIN_CB;
    if ( WPPTraceSuite == 4 )
    {
      do
      {
        v5 = v2[1];
        v2[7] = 0LL;
        pfnEtwRegisterClassicProvider(v5, 0LL, WppClassicProviderCallback, v2, v2 + 7);
        v2 = v2[2];
      }
      while ( v2 );
    }
    else if ( WPPTraceSuite == 2 )
    {
      WPP_MAIN_CB = WppTraceCallback;
      IoWMIRegistrationControl(&WPP_MAIN_CB, 0x80010001);
    }
    WppAutoLogStart(WPP_GLOBAL_Control, a1, a2);
  }
}
// 140008CD6: using guessed type __int64 __fastcall WppAutoLogStart(_QWORD, _QWORD, _QWORD);
// 14000B0F8: using guessed type __int64 (__fastcall *pfnEtwRegisterClassicProvider)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 14000B108: using guessed type int WPPTraceSuite;

//----- (000000014000E26C) ----------------------------------------------------
void *WppLoadTracingSupport()
{
  void *result; // rax
  unsigned int v1; // [rsp+20h] [rbp-20h] BYREF
  struct _UNICODE_STRING DestinationString; // [rsp+28h] [rbp-18h] BYREF

  v1 = 0;
  RtlInitUnicodeString(&DestinationString, L"PsGetVersion");
  pfnWppGetVersion = MmGetSystemRoutineAddress(&DestinationString);
  RtlInitUnicodeString(&DestinationString, L"WmiTraceMessage");
  pfnWppTraceMessage = MmGetSystemRoutineAddress(&DestinationString);
  RtlInitUnicodeString(&DestinationString, L"WmiQueryTraceInformation");
  pfnWppQueryTraceInformation = MmGetSystemRoutineAddress(&DestinationString);
  result = pfnWppGetVersion;
  WPPTraceSuite = 2;
  if ( pfnWppGetVersion )
    result = pfnWppGetVersion(&v1, 0LL, 0LL, 0LL);
  if ( v1 >= 6 )
  {
    RtlInitUnicodeString(&DestinationString, L"EtwRegisterClassicProvider");
    result = MmGetSystemRoutineAddress(&DestinationString);
    pfnEtwRegisterClassicProvider = result;
    if ( result )
    {
      RtlInitUnicodeString(&DestinationString, L"EtwUnregister");
      result = MmGetSystemRoutineAddress(&DestinationString);
      pfnEtwUnregister = result;
      WPPTraceSuite = 4;
    }
  }
  return result;
}
// 14000B0E0: using guessed type __int64 (__fastcall *pfnWppQueryTraceInformation)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 14000B0F0: using guessed type __int64 (*pfnEtwUnregister)(void);
// 14000B0F8: using guessed type __int64 (__fastcall *pfnEtwRegisterClassicProvider)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 14000B100: using guessed type __int64 (__fastcall *pfnWppGetVersion)(_QWORD, _QWORD, _QWORD, _QWORD);
// 14000B108: using guessed type int WPPTraceSuite;

//----- (000000014000E37C) ----------------------------------------------------
__int64 __fastcall WppTraceCallback(
        unsigned __int8 a1,
        __int64 a2,
        unsigned int a3,
        unsigned int *a4,
        __int64 a5,
        unsigned int *a6)
{
  unsigned int v6; // ebx
  __int64 v7; // rdi
  const void **v10; // r12
  unsigned int v11; // ebp
  __int64 v12; // rax
  unsigned int v13; // r15d
  unsigned int v14; // r14d
  _WORD *v15; // rcx
  unsigned int *v16; // rsi
  __int64 v17; // rcx
  __int128 v18; // xmm0
  __int64 v19; // rax
  _BYTE v21[4]; // [rsp+38h] [rbp-50h] BYREF
  _BYTE v22[4]; // [rsp+3Ch] [rbp-4Ch] BYREF

  v6 = 0;
  v7 = a5;
  *a6 = 0;
  if ( a1 <= 3u )
    return -1073741808;
  if ( a1 > 5u )
  {
    if ( a1 <= 7u )
      return v6;
    if ( a1 == 8 )
    {
      v10 = *(a5 + 32);
      v11 = 0;
      v12 = a5;
      do
      {
        v12 = *(v12 + 16);
        ++v11;
      }
      while ( v12 );
      if ( v11 > 0x3F )
        return -1073741811;
      if ( v10 )
      {
        v13 = 32 * v11 + 24;
        v14 = v13 + *v10 + 2;
      }
      else
      {
        v13 = 0;
        v14 = 32 * v11 + 24;
      }
      if ( v14 > a3 )
      {
        v6 = -1073741789;
        if ( a3 >= 4 )
        {
          *a4 = v14;
          *a6 = 4;
        }
      }
      else
      {
        memset(a4, 0, a3);
        *a4 = v14;
        a4[2] = v13;
        a4[4] = v11;
        if ( v10 )
        {
          v15 = (a4 + v13);
          *v15 = *v10;
          memmove(v15 + 1, v10[1], *v10);
        }
        if ( v11 )
        {
          v16 = a4 + 10;
          v17 = v11;
          do
          {
            v18 = **(v7 + 8);
            *v16 = 528384;
            v16 += 8;
            *(v16 - 3) = v18;
            *(v7 + 41) = 0;
            *(v7 + 44) = 0;
            v7 = *(v7 + 16);
            --v17;
          }
          while ( v17 );
        }
        *a6 = v14;
      }
      return v6;
    }
    return -1073741808;
  }
  if ( !a5 )
    return -1073741163;
  if ( a3 < 0x30 )
    return -1073741811;
  do
  {
    if ( RtlCompareMemory(*(v7 + 8), a4 + 6, 0x10uLL) == 16 )
      break;
    v7 = *(v7 + 16);
  }
  while ( v7 );
  if ( !v7 )
    return -1073741163;
  if ( a1 == 5 )
  {
    *(v7 + 41) = 0;
    *(v7 + 44) = 0;
    *(v7 + 24) = 0LL;
  }
  else
  {
    v19 = *(a4 + 1);
    *(v7 + 24) = v19;
    if ( WPPTraceSuite == 2 )
    {
      if ( !pfnWppQueryTraceInformation(3LL, v21, 4LL, v22, a4) )
        *(v7 + 41) = v21[0];
      return pfnWppQueryTraceInformation(2LL, v7 + 44, 4LL, v22, a4);
    }
    else
    {
      *(v7 + 44) = HIDWORD(v19);
      *(v7 + 41) = BYTE2(v19);
    }
  }
  return v6;
}
// 14000B0E0: using guessed type __int64 (__fastcall *pfnWppQueryTraceInformation)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 14000B108: using guessed type int WPPTraceSuite;

//----- (000000014000F000) ----------------------------------------------------
NTSTATUS __stdcall DriverEntry(_DRIVER_OBJECT *DriverObject, PUNICODE_STRING RegistryPath)
{
  PDEVICE_OBJECT v4; // rcx
  int v5; // eax
  NTSTATUS v6; // ebx
  __int64 v8; // [rsp+28h] [rbp-80h]
  _QWORD DriverAttributes[7]; // [rsp+30h] [rbp-78h] BYREF
  _QWORD DriverConfig[4]; // [rsp+68h] [rbp-40h] BYREF

  __KMDF_TYPE_INIT_END = 1LL;
  WPP_MAIN_CB = 0LL;
  unk_14000B118 = &WPP_ThisDir_CTLGUID_UnknownTraceGuid;
  unk_14000B120 = 0LL;
  unk_14000B130 = 0LL;
  unk_14000B150 = 0LL;
  unk_14000B158 = 0;
  WppLoadTracingSupport();
  unk_14000B130 = 0LL;
  WppInitKm(DriverObject, RegistryPath);
  v4 = WPP_GLOBAL_Control;
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    WPP_RECORDER_SF_(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0xAu, &traceGuid);
    v4 = WPP_GLOBAL_Control;
  }
  WPP_RECORDER_SF_(v4->DeviceExtension, 4u, 4u, 0xEu, &traceGuid);
  memset(DriverAttributes, 0, sizeof(DriverAttributes));
  LODWORD(DriverAttributes[0]) = 56;
  DriverAttributes[3] = 0x100000001LL;
  DriverAttributes[1] = EvtDriverContextCleanup;
  memset(DriverConfig, 0, sizeof(DriverConfig));
  DriverConfig[1] = EvtDeviceAdd;
  LODWORD(DriverConfig[0]) = 32;
  v5 = (*(WdfFunctions_01015[0] + WdfDriverCreate))(
         WdfDriverGlobals,
         DriverObject,
         RegistryPath,
         DriverAttributes,
         DriverConfig,
         0LL);
  v6 = v5;
  if ( v5 < 0 )
  {
    LODWORD(v8) = v5;
    WPP_SF_D(
      WPP_GLOBAL_Control->DeviceExtension,
      2u,
      4u,
      0xFu,
      &traceGuid,
      v8,
      DriverAttributes[0],
      DriverAttributes[1]);
    WppCleanupKm(DriverObject);
  }
  if ( LOWORD(WPP_GLOBAL_Control->DeviceType) )
  {
    LODWORD(v8) = v6;
    WPP_SF_D(WPP_GLOBAL_Control->DeviceExtension, 5u, 4u, 0x10u, &traceGuid, v8);
  }
  return v6;
}
// 14000F176: variable 'v8' is possibly undefined

// nfuncs=94 queued=68 decompiled=68 lumina nreq=0 worse=0 better=0
// ALL OK, 68 function(s) have been successfully decompiled
